<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#667eea">
    <meta name="description" content="LEAD Bank - Modern Banking. Secure banking at your fingertips. Send money, manage accounts, and track transactions.">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api@0.0.5/dist/face-api.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            --secondary-gradient: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            --success-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --warning-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            
            --bg-primary: #f0f4f8;
            --bg-secondary: #ffffff;
            --bg-card: rgba(255, 255, 255, 0.8);
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: rgba(0, 0, 0, 0.08);
            --shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 12px 32px rgba(0, 0, 0, 0.12);
        }

        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: rgba(30, 41, 59, 0.7);
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --border-color: rgba(255, 255, 255, 0.12);
            --shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
            --shadow-hover: 0 12px 32px rgba(0, 0, 0, 0.5);
        }

        html, body {
            width: 100%;
            height: 100%;
            position: fixed;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }

        .app-container {
            width: 100%;
            height: 100%;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 80px;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .glass-card {
            background: #ffffff;
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            box-shadow: var(--shadow-hover);
            transform: translateY(-2px);
        }

        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            z-index: 1000;
        }

        .hamburger {
            font-size: 24px;
            cursor: pointer;
            color: var(--text-primary);
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .theme-toggle {
            font-size: 20px;
            cursor: pointer;
            color: var(--text-primary);
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100vh;
            background: var(--bg-secondary);
            box-shadow: var(--shadow);
            transition: left 0.3s ease;
            z-index: 1001;
            overflow-y: auto;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-header {
            padding: 20px;
            background: var(--primary-gradient);
            color: white;
        }

        .sidebar-menu {
            padding: 20px;
        }

        .sidebar-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .sidebar-item:hover {
            background: #ffffff;
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            cursor: pointer;
        }

        .overlay.active {
            display: block;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            padding: 8px;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 600;
        }

        .nav-item i {
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .nav-item.active {
            color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
        }

        .nav-item.active i {
            transform: scale(1.1);
            color: #667eea;
        }

        .nav-item:hover {
            color: #667eea;
            transform: scale(1.05);
        }

        .content {
            margin-top: 80px;
            padding: 20px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            zoom: 0.95;
            transform-origin: top center;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        .btn-primary {
            background: #d8b4fe;
            color: #6b21a8;
            box-shadow: 0 5px 15px rgba(216, 180, 254, 0.4);
        }

        .btn-primary:hover {
            background: #c084fc;
            color: #6b21a8;
            box-shadow: 0 8px 25px rgba(192, 132, 252, 0.6);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #ffffff;
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            background: #ffffff;
            color: var(--text-primary);
            font-size: 16px;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }

        [data-theme="dark"] .input-group input,
        [data-theme="dark"] .input-group select,
        [data-theme="dark"] .input-group textarea {
            background: #2d3748;
            border-color: #4a5568;
        }

        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        select {
            background-color: #ffffff !important;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E") !important;
            background-repeat: no-repeat !important;
            background-position: right 10px center !important;
            background-size: 12px !important;
            appearance: none !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            border: 1px solid #e2e8f0 !important;
            border-radius: 8px !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08) !important;
            cursor: pointer !important;
            padding-right: 30px !important;
        }

        select:hover {
            border-color: #cbd5e1 !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12) !important;
        }

        select:focus {
            outline: none !important;
            border-color: #667eea !important;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1) !important;
        }

        .balance-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 32px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .balance-card::before {
            content: '';
            position: absolute;
            top: -100%;
            right: -100%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        .balance-card::after {
            content: '';
            position: absolute;
            bottom: -50%;
            left: -50%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.05) 0%, transparent 70%);
            animation: float 8s ease-in-out infinite reverse;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(30px, 30px); }
        }

        .balance-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 8px;
            font-weight: 600;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            position: relative;
            z-index: 1;
        }

        .balance-amount {
            font-size: 52px;
            font-weight: 900;
            margin-bottom: 28px;
            letter-spacing: -2px;
            position: relative;
            z-index: 1;
            color: white;
        }

        .sub-balances {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            position: relative;
            z-index: 1;
        }

        .sub-balance {
            background: linear-gradient(135deg, rgba(0, 217, 255, 0.1) 0%, rgba(0, 255, 136, 0.05) 100%);
            padding: 16px;
            border-radius: 8px;
            border: 2px solid rgba(0, 217, 255, 0.3);
        }

        .sub-balance-label {
            font-size: 11px;
            color: rgba(0, 217, 255, 0.8);
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .sub-balance-amount {
            font-size: 22px;
            font-weight: 800;
            margin-top: 8px;
            letter-spacing: -1px;
            color: #00ff88;
        }

        .account-number-section {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 2px solid rgba(0, 217, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            position: relative;
            z-index: 1;
        }

        .account-number-display {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .account-number-label {
            font-size: 10px;
            color: #00d9ff;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 700;
        }

        .account-number-value {
            font-size: 16px;
            font-weight: 800;
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
            background: rgba(0, 217, 255, 0.15);
            padding: 10px 14px;
            border-radius: 6px;
            border: 1px solid #00d9ff;
            color: #00ff88;
        }

        .copy-account-btn {
            background: linear-gradient(135deg, #00d9ff, #00ff88);
            border: none;
            color: #1a1f2e;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 18px;
            font-weight: 700;
        }

        .copy-account-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 217, 255, 0.4);
        }

        .copy-account-btn:active {
            transform: scale(0.95);
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin-bottom: 30px;
        }

        .action-btn {
            background: linear-gradient(135deg, #faf5ff 0%, #f5f3ff 100%);
            backdrop-filter: blur(8px);
            padding: 12px 8px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.25s ease;
            border: 1.5px solid rgba(168, 85, 247, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.08) 0%, rgba(147, 112, 219, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.25s ease;
        }

        .action-btn:hover::before {
            opacity: 1;
        }

        .action-btn:hover {
            background: linear-gradient(135deg, #f3e8ff 0%, #ede9fe 100%);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(168, 85, 247, 0.2);
            border-color: rgba(168, 85, 247, 0.4);
        }

        .action-btn i {
            font-size: 18px;
            color: #1e293b;
            transition: all 0.25s ease;
            position: relative;
            z-index: 1;
        }

        .action-btn:hover i {
            color: #000000;
            transform: scale(1.15);
        }

        .action-btn span {
            display: block;
            font-size: 9px;
            font-weight: 700;
            color: #1e293b;
            transition: color 0.25s ease;
            position: relative;
            z-index: 1;
            letter-spacing: 0.3px;
            text-transform: uppercase;
        }

        .action-btn:hover span {
            color: #000000;
        }

        [data-theme="dark"] .action-btn {
            background: linear-gradient(135deg, #2a1f3d 0%, #1f1a2e 100%);
            border-color: rgba(168, 85, 247, 0.3);
        }

        [data-theme="dark"] .action-btn:hover {
            background: linear-gradient(135deg, #3d2a52 0%, #2d2240 100%);
            border-color: rgba(168, 85, 247, 0.5);
        }

        [data-theme="dark"] .action-btn i {
            color: #ffffff;
        }

        [data-theme="dark"] .action-btn:hover i {
            color: #e0e7ff;
        }

        [data-theme="dark"] .action-btn span {
            color: #ffffff;
        }

        [data-theme="dark"] .action-btn:hover span {
            color: #e0e7ff;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
        }

        .modal-close {
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .loading-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--bg-primary);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .loading-screen.active {
            display: flex;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid var(--border-color);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            margin-top: 20px;
            font-size: 18px;
            color: var(--text-secondary);
        }

        .greeting {
            margin-bottom: 30px;
            padding: 28px;
            background: white;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 16px;
            backdrop-filter: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            color: #1e293b;
            position: relative;
            overflow: hidden;
        }

        .greeting::before {
            content: '';
            position: absolute;
            top: -100%;
            right: -100%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            animation: glow 4s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(40px, 40px); }
        }

        .greeting-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        .greeting-text {
            flex: 1;
        }

        .greeting-message {
            font-size: 36px;
            font-weight: 900;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 14px;
            letter-spacing: -1.5px;
        }

        .greeting-date-time {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            background: #fce7f3;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid rgba(236, 72, 153, 0.2);
        }

        .greeting-date, .greeting-time {
            display: flex;
            align-items: center;
            gap: 7px;
            font-size: 12px;
            color: #831843;
            background: transparent;
            padding: 0;
            border-radius: 0;
            border: none;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .greeting-date i, .greeting-time i {
            color: #ec4899;
            font-size: 16px;
        }

        .greeting-emoji {
            font-size: 64px;
            animation: spin-emoji 3s ease-in-out infinite;
        }

        @keyframes spin-emoji {
            0%, 100% {
                transform: rotate(0deg) scale(1);
            }
            50% {
                transform: rotate(15deg) scale(1.1);
            }
        }

        .crypto-list {
            display: grid;
            gap: 15px;
        }

        .crypto-item {
            background: #ffffff;
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .crypto-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .crypto-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .crypto-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: var(--primary-gradient);
            color: white;
        }

        .crypto-details h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .crypto-details p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .crypto-price {
            text-align: right;
        }

        .crypto-price .price {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .crypto-price .change {
            font-size: 14px;
            padding: 5px 10px;
            border-radius: 8px;
        }

        .crypto-price .change.positive {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .crypto-price .change.negative {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .chart-container {
            margin: 30px 0;
            background: #ffffff;
            padding: 20px;
            border-radius: 15px;
        }

        .chart-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .chart-tab {
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .chart-tab.active {
            background: var(--primary-gradient);
            color: white;
            border-color: transparent;
        }

        .transaction-summary {
            background: #ffffff;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .summary-row:last-child {
            border-bottom: none;
            font-weight: 700;
            font-size: 18px;
        }

        .pin-input-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }

        .pin-digit {
            width: 60px;
            height: 60px;
            text-align: center;
            font-size: 24px;
            font-weight: 700;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .receipt {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
            color: #000;
            padding: 35px;
            border-radius: 16px;
            max-width: 420px;
            width: 100%;
            margin: 20px auto;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.15);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .receipt-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.2);
        }

        .receipt-logo {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            letter-spacing: 2px;
        }

        .receipt-status {
            display: inline-block;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            margin: 15px 0;
            font-size: 14px;
            animation: slideInUp 0.5s ease;
        }

        .receipt-status.success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.05));
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .receipt-status.failed {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.05));
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .receipt-details {
            margin: 20px 0;
        }

        .receipt-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .receipt-row:last-child {
            border-bottom: none;
        }

        .receipt-label {
            color: #666;
            font-size: 13px;
            font-weight: 500;
        }

        .receipt-value {
            font-weight: 600;
            color: #1f2937;
            text-align: right;
            font-size: 14px;
        }

        .receipt-amount-section {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            padding: 18px;
            border-radius: 12px;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        .receipt-amount-large {
            text-align: center;
            font-size: 28px;
            font-weight: 700;
            color: #667eea;
            margin: 10px 0;
        }

        .receipt-transaction-type {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 8px;
        }

        .receipt-type-icon {
            font-size: 20px;
        }

        .receipt-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #667eea, transparent);
            margin: 15px 0;
        }

        .alert {
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .alert-info {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .crypto-action-btns {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }

        .crypto-action-btn {
            padding: 16px 12px;
            border-radius: 12px;
            border: none;
            background: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 700;
            font-size: 14px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15);
            border: 2px solid rgba(102, 126, 234, 0.25);
        }

        .crypto-action-btn i {
            font-size: 22px;
            color: #667eea;
            transition: all 0.3s ease;
        }

        .crypto-action-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.4);
        }

        .crypto-action-btn:hover i {
            color: white;
            transform: scale(1.15);
        }

        .toggle-switch {
            display: flex;
            gap: 0;
            background: #ffffff;
            padding: 5px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .toggle-option {
            flex: 1;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }

        .toggle-option.active {
            background: var(--primary-gradient);
            color: white;
        }

        @media (max-width: 768px) {
            .quick-actions {
                grid-template-columns: repeat(2, 1fr);
            }

            .sub-balances {
                grid-template-columns: 1fr;
            }

            .balance-amount {
                font-size: 28px;
            }

            .greeting {
                padding: 20px;
                margin-bottom: 20px;
            }

            .greeting-content {
                flex-direction: column;
                text-align: center;
            }

            .greeting-message {
                font-size: 22px;
            }

            .greeting-emoji {
                font-size: 36px;
                margin-top: 10px;
            }

            .crypto-action-btns {
                grid-template-columns: repeat(2, 1fr);
            }

            .receipt {
                padding: 20px;
            }
        }

        .auth-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: linear-gradient(135deg, #f5f7fa 0%, #e9ecf1 50%, #dfe7f0 100%);
            background-attachment: fixed;
            padding: 0;
            margin: 0;
            overflow-y: auto;
            position: relative;
        }
        
        .auth-container::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 15% 25%, rgba(168, 85, 247, 0.25) 0%, transparent 35%),
                radial-gradient(circle at 85% 75%, rgba(59, 130, 246, 0.25) 0%, transparent 35%),
                radial-gradient(circle at 35% 60%, rgba(139, 92, 246, 0.2) 0%, transparent 30%),
                radial-gradient(circle at 70% 15%, rgba(147, 112, 219, 0.2) 0%, transparent 30%),
                radial-gradient(circle at 10% 80%, rgba(168, 85, 247, 0.15) 0%, transparent 25%),
                radial-gradient(circle at 90% 40%, rgba(99, 102, 241, 0.15) 0%, transparent 25%);
            pointer-events: none;
            z-index: 0;
        }
        
        .auth-container::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(ellipse at 20% 80%, rgba(168, 85, 247, 0.3) 0%, transparent 40%),
                radial-gradient(ellipse at 80% 20%, rgba(59, 130, 246, 0.3) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, rgba(147, 112, 219, 0.1) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }
        
        .auth-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }


        .auth-card {
            max-width: 380px;
            width: 100%;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(30px);
            border-radius: 24px;
            padding: 40px 35px;
            box-shadow: 0 20px 60px rgba(59, 130, 246, 0.15), 0 0 1px rgba(59, 130, 246, 0.3);
            border: 2px solid rgba(59, 130, 246, 0.2);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-logo {
            font-size: 36px;
            font-weight: 900;
            background: linear-gradient(135deg, #3b82f6 0%, #6366f1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            letter-spacing: -2px;
        }

        .auth-header h1 {
            font-size: 24px;
            margin-bottom: 6px;
            color: #1e293b;
            font-weight: 700;
        }

        .auth-header p {
            color: #64748b;
            font-size: 13px;
            font-weight: 500;
        }


        .auth-toggle {
            text-align: center;
            margin-top: 24px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .auth-toggle a {
            color: #667eea;
            text-decoration: none;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auth-toggle a:hover {
            color: #764ba2;
        }

        .verification-notice {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .auth-footer {
            background: rgba(0, 0, 0, 0.8);
            color: rgba(255, 255, 255, 0.8);
            padding: 30px 20px;
            text-align: center;
            font-size: 12px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: white;
        }

        .footer-copyright {
            color: rgba(255, 255, 255, 0.6);
            font-size: 11px;
        }

        .notification-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 12px 16px;
            z-index: 3000;
            display: none;
            flex-direction: column;
            gap: 4px;
            animation: slideDownIOS 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: max(12px, env(safe-area-inset-top, 0px));
        }

        .notification-banner.show {
            display: flex;
        }

        @keyframes slideDownIOS {
            from {
                transform: translateY(calc(-100% - 40px));
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .notification-banner-app {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.7;
            margin-bottom: 2px;
        }

        .notification-banner-message {
            font-size: 15px;
            font-weight: 500;
            line-height: 1.3;
        }

        .notification-banner i {
            display: none;
        }

    </style>
</head>
<body>
    <audio id="notificationSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRiYAAABXQVZFZm10IBAAAAABAAEAQB8AAAB9AAACABAAZGF0YQIAAAAAAA==" type="audio/wav">
    </audio>
    <div class="notification-banner" id="notificationBanner">
        <div class="notification-banner-app">LEAD Bank</div>
        <div class="notification-banner-message" id="notificationText">Transaction successful!</div>
    </div>
    <div class="app-container">
        <div id="loadingScreen" class="loading-screen">
            <div class="spinner"></div>
            <div class="loading-text">Please wait...</div>
        </div>

        <div id="authPage" class="page active">
            <div class="auth-container">
                <div class="auth-content">
                    <div class="auth-card">
                        <div class="auth-header">
                            <div class="auth-logo" style="font-size: 40px; margin-bottom: 10px;">LEAD</div>
                            <h1 id="authTitle">Welcome Back</h1>
                            <p id="authSubtitle">Secure banking</p>
                        </div>

                        <div id="alertBox" class="alert"></div>

                        <form id="authForm">
                            <div class="input-group">
                                <label for="authEmail">Email Address</label>
                                <input type="email" id="authEmail" required placeholder="your@email.com" autocomplete="email">
                            </div>
                            <div class="input-group">
                                <label for="authPassword">Password</label>
                                <input type="password" id="authPassword" required placeholder="••••••••" autocomplete="current-password">
                            </div>
                            <button type="submit" class="btn btn-primary" style="width: 100%; font-size: 16px; padding: 16px;">
                                <span id="authButtonText">Sign In Securely</span>
                            </button>
                        </form>

                        <div class="auth-toggle">
                            <span id="authToggleText">Don't have an account?</span>
                            <a id="authToggleLink">Create Account</a>
                        </div>

                        <div id="verificationNotice" class="verification-notice" style="display: none;">
                            <i class="fas fa-envelope" style="margin-right: 8px;"></i>
                            <strong>Verification email sent!</strong> Check your inbox to verify.
                        </div>
                    </div>
                </div>

                <div class="auth-footer">
                    <div class="footer-links">
                        <a href="#">Security</a>
                        <a href="#">Privacy Policy</a>
                        <a href="#">Terms of Service</a>
                        <a href="#">Contact Support</a>
                        <a href="#">Careers</a>
                    </div>
                    <div class="footer-copyright">
                        © 2024 LEAD BANK. All rights reserved. | FDIC Insured | Banking License #CC-2024
                    </div>
                </div>
            </div>
        </div>

        <div id="userInfoPage" class="page">
            <div class="header">
                <div></div>
                <div class="logo">LEAD</div>
                <div></div>
            </div>
            <div class="content">
                <div class="glass-card" style="max-width: 600px; margin: 0 auto;">
                    <h2 style="margin-bottom: 30px;">Complete Your Profile</h2>
                    <div id="userInfoAlert" class="alert"></div>
                    <form id="userInfoForm">
                        <div class="input-group">
                            <label for="firstName">First Name</label>
                            <input type="text" id="firstName" required>
                        </div>
                        <div class="input-group">
                            <label for="surname">Surname</label>
                            <input type="text" id="surname" required>
                        </div>
                        <div class="input-group">
                            <label for="phoneNumber">Phone Number</label>
                            <input type="tel" id="phoneNumber" required>
                        </div>
                        <div class="input-group">
                            <label for="age">Age</label>
                            <input type="number" id="age" required min="18" max="120">
                        </div>
                        <div class="input-group">
                            <label for="country">Country</label>
                            <select id="country" required style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                                <option value="">Select Country</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="state">State/Province</label>
                            <select id="state" required style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                                <option value="">Select State</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="streetAddress">Street and Number</label>
                            <input type="text" id="streetAddress" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Continue to Dashboard</button>
                    </form>
                </div>
            </div>
        </div>

        <div id="pinSetupPage" class="page">
            <div class="header">
                <div></div>
                <div class="logo">LEAD</div>
                <div></div>
            </div>
            <div class="content">
                <div class="glass-card" style="max-width: 600px; margin: 0 auto;">
                    <h2 style="margin-bottom: 30px;">Set Your PIN</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 30px;">Create a 4-digit PIN to secure your transactions</p>
                    <div id="pinSetupAlert" class="alert"></div>
                    <div style="margin-bottom: 40px;">
                        <label style="display: block; margin-bottom: 15px; font-weight: 600;">Enter PIN</label>
                        <div class="pin-input-container" id="pinSetupFirstContainer">
                            <input class="pin-digit" type="text" maxlength="1" readonly style="cursor: pointer;">
                            <input class="pin-digit" type="text" maxlength="1" readonly style="cursor: pointer;">
                            <input class="pin-digit" type="text" maxlength="1" readonly style="cursor: pointer;">
                            <input class="pin-digit" type="text" maxlength="1" readonly style="cursor: pointer;">
                        </div>
                    </div>
                    <div style="margin-bottom: 40px;">
                        <label style="display: block; margin-bottom: 15px; font-weight: 600;">Confirm PIN</label>
                        <div class="pin-input-container" id="pinSetupSecondContainer">
                            <input class="pin-digit" type="text" maxlength="1" readonly style="cursor: pointer;">
                            <input class="pin-digit" type="text" maxlength="1" readonly style="cursor: pointer;">
                            <input class="pin-digit" type="text" maxlength="1" readonly style="cursor: pointer;">
                            <input class="pin-digit" type="text" maxlength="1" readonly style="cursor: pointer;">
                        </div>
                    </div>
                    <div id="pinSetupDialPad" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;"></div>
                    <button class="btn btn-primary" onclick="completePinSetup()" style="width: 100%; margin-bottom: 15px;">Complete Setup</button>
                </div>
            </div>
        </div>

        <div id="resetPinModalPage" class="page">
            <div class="header">
                <div onclick="navigateTo('security')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon13"></i>
                </div>
            </div>
            <div class="content">
                <div class="glass-card" style="max-width: 600px; margin: 0 auto;">
                    <h2 style="margin-bottom: 30px;">Reset Transaction PIN</h2>
                    <div id="resetPinAlert" class="alert"></div>
                    <div style="margin-bottom: 40px;">
                        <label style="display: block; margin-bottom: 15px; font-weight: 600;">Enter New PIN</label>
                        <div class="pin-input-container" id="resetPinFirstContainer">
                            <input class="pin-digit" type="text" maxlength="1" readonly style="cursor: pointer;">
                            <input class="pin-digit" type="text" maxlength="1" readonly style="cursor: pointer;">
                            <input class="pin-digit" type="text" maxlength="1" readonly style="cursor: pointer;">
                            <input class="pin-digit" type="text" maxlength="1" readonly style="cursor: pointer;">
                        </div>
                    </div>
                    <div style="margin-bottom: 40px;">
                        <label style="display: block; margin-bottom: 15px; font-weight: 600;">Confirm PIN</label>
                        <div class="pin-input-container" id="resetPinSecondContainer">
                            <input class="pin-digit" type="text" maxlength="1" readonly style="cursor: pointer;">
                            <input class="pin-digit" type="text" maxlength="1" readonly style="cursor: pointer;">
                            <input class="pin-digit" type="text" maxlength="1" readonly style="cursor: pointer;">
                            <input class="pin-digit" type="text" maxlength="1" readonly style="cursor: pointer;">
                        </div>
                    </div>
                    <div id="resetPinDialPad" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;"></div>
                    <button class="btn btn-primary" onclick="saveNewPin()" style="width: 100%;">Save PIN</button>
                </div>
            </div>
        </div>

        <div id="resetPasswordModalPage" class="page">
            <div class="header">
                <div onclick="navigateTo('security')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon14"></i>
                </div>
            </div>
            <div class="content">
                <div class="glass-card" style="max-width: 600px; margin: 0 auto;">
                    <h2 style="margin-bottom: 30px;">Reset Login Password</h2>
                    <div id="resetPasswordAlert" class="alert"></div>
                    <div class="input-group">
                        <label for="newPassword">New Password</label>
                        <input type="password" id="newPassword" placeholder="At least 6 characters" required>
                    </div>
                    <div class="input-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <input type="password" id="confirmPassword" placeholder="Re-enter password" required>
                    </div>
                    <button class="btn btn-primary" onclick="saveNewPassword()" style="width: 100%; margin-bottom: 15px;">Update Password</button>
                    <button class="btn btn-secondary" onclick="navigateTo('security')" style="width: 100%;">Cancel</button>
                </div>
            </div>
        </div>

        <div id="securityPage" class="page">
            <div class="header">
                <div onclick="navigateTo('dashboard')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon11"></i>
                </div>
            </div>
            <div class="content">
                <h2 style="margin-bottom: 30px;">Security Settings</h2>
                <div id="securityAlert" class="alert"></div>
                <div class="glass-card" style="padding: 25px; margin-bottom: 20px; cursor: pointer;" onclick="openResetPinModal()" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 24px rgba(102, 126, 234, 0.2)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 16px rgba(0, 0, 0, 0.1)';">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="margin: 0 0 8px 0;">Reset PIN</h3>
                            <p style="color: var(--text-secondary); margin: 0; font-size: 14px;">Change your transaction PIN</p>
                        </div>
                        <i class="fas fa-key" style="font-size: 24px; color: #667eea;"></i>
                    </div>
                </div>
                <div class="glass-card" style="padding: 25px; cursor: pointer;" onclick="openResetPasswordModal()" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 24px rgba(102, 126, 234, 0.2)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 16px rgba(0, 0, 0, 0.1)';">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="margin: 0 0 8px 0;">Reset Password</h3>
                            <p style="color: var(--text-secondary); margin: 0; font-size: 14px;">Change your login password</p>
                        </div>
                        <i class="fas fa-lock" style="font-size: 24px; color: #667eea;"></i>
                    </div>
                </div>
            </div>
        </div>

        <div id="dashboardPage" class="page">
            <div class="header">
                <div class="hamburger" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </div>
                <div class="logo">LEAD</div>
                <div style="display: flex; gap: 20px; align-items: center;">
                    <div style="position: relative; cursor: pointer;" onclick="navigateTo('notifications')">
                        <i class="fas fa-bell" style="font-size: 20px; color: var(--text-primary);"></i>
                        <span id="notificationBadge" style="position: absolute; top: -8px; right: -8px; background: #ef4444; color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; display: none;">0</span>
                    </div>
                    <div class="theme-toggle" onclick="toggleTheme()">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </div>
                </div>
            </div>

            <div class="content">
                <div id="greeting" class="greeting"></div>

                <div class="balance-card">
                    <div class="balance-label">Main Balance</div>
                    <div class="balance-amount" id="mainBalance">$0.00</div>
                    <div class="sub-balances">
                        <div class="sub-balance">
                            <div class="sub-balance-label">Checking</div>
                            <div class="sub-balance-amount" id="checkingBalance">$0.00</div>
                        </div>
                        <div class="sub-balance">
                            <div class="sub-balance-label">Savings</div>
                            <div class="sub-balance-amount" id="savingsBalance">$0.00</div>
                        </div>
                    </div>
                    <div class="account-number-section">
                        <div class="account-number-display">
                            <div class="account-number-label">Account</div>
                            <div class="account-number-value" id="accountNumberDisplay">••••••••••</div>
                        </div>
                        <button class="copy-account-btn" onclick="copyAccountNumber()" title="Copy Account Number">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>

                <div style="margin-bottom: 30px;">
                    <h3 style="margin-bottom: 20px; color: var(--text-primary);">Crypto Holdings</h3>
                    <div id="cryptoHoldings" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;"></div>
                </div>

                <div class="quick-actions">
                    <div class="action-btn" onclick="navigateTo('credcryptTransfer')">
                        <i class="fas fa-user-tie"></i>
                        <span>Send to User</span>
                    </div>
                    <div class="action-btn" onclick="navigateTo('internalTransfer')">
                        <i class="fas fa-arrows-alt-h"></i>
                        <span>Move Money</span>
                    </div>
                    <div class="action-btn" onclick="navigateTo('bankTransfer')">
                        <i class="fas fa-exchange-alt"></i>
                        <span>Bank Transfer</span>
                    </div>
                    <div class="action-btn" onclick="navigateTo('wireTransfer')">
                        <i class="fas fa-globe"></i>
                        <span>Wire Transfer</span>
                    </div>
                    <div class="action-btn" onclick="navigateTo('withdraw')">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Withdraw</span>
                    </div>
                    <div class="action-btn" onclick="loadTopupPage()">
                        <i class="fas fa-plus-circle"></i>
                        <span>Top Up</span>
                    </div>
                    <div class="action-btn" style="display: none;">
                        <i class="fas fa-receipt"></i>
                        <span>Bills Payment</span>
                    </div>
                    <div class="action-btn" onclick="navigateTo('creditScore')">
                        <i class="fas fa-chart-line"></i>
                        <span>Credit Score</span>
                    </div>
                    <div class="action-btn" onclick="navigateTo('loans')">
                        <i class="fas fa-hand-holding-usd"></i>
                        <span>Loan</span>
                    </div>
                    <div class="action-btn" onclick="navigateTo('cards')">
                        <i class="fas fa-credit-card"></i>
                        <span>Cards</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="cryptoPage" class="page">
            <div class="header">
                <div class="hamburger" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon2"></i>
                </div>
            </div>

            <div class="content">
                <h2 style="margin-bottom: 30px;">Cryptocurrency</h2>
                <div class="crypto-list" id="cryptoList"></div>
            </div>
        </div>

        <div id="cryptoDetailPage" class="page">
            <div class="header">
                <div onclick="navigateTo('crypto')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon3"></i>
                </div>
            </div>

            <div class="content">
                <div id="cryptoDetailContent"></div>
            </div>
        </div>

        <div id="profilePage" class="page">
            <div class="header">
                <div class="hamburger" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon4"></i>
                </div>
            </div>

            <div class="content">
                <h2 style="margin-bottom: 30px;">Profile</h2>
                <div class="glass-card" style="text-align: center; margin-bottom: 30px;">
                    <div style="position: relative; width: 120px; margin: 0 auto 20px;">
                        <img id="profilePictureDisplay" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23667eea'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E" alt="Profile" style="width: 120px; height: 120px; border-radius: 50%; background: #ffffff; padding: 10px; cursor: pointer;" onclick="document.getElementById('profilePictureInput').click()">
                        <input type="file" id="profilePictureInput" accept="image/*" style="display: none;" onchange="previewProfilePicture(event)">
                        <label style="position: absolute; bottom: 0; right: 0; background: #667eea; color: white; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 18px;" onclick="document.getElementById('profilePictureInput').click()">
                            <i class="fas fa-camera"></i>
                        </label>
                    </div>
                    <p style="color: var(--text-secondary); font-size: 14px;">Click to upload picture</p>
                    <div id="profilePictureSaveButton" style="display: none; margin-top: 15px;">
                        <button class="btn btn-primary" onclick="saveProfilePicture()" style="width: 100%;">Save Picture</button>
                    </div>
                </div>
                <div class="glass-card" id="profileContent" style="margin-bottom: 30px;"></div>
                <button class="btn btn-primary" onclick="navigateTo('profileEdit')" style="width: 100%;">
                    <i class="fas fa-edit"></i> Edit Profile
                </button>
            </div>
        </div>

        <div id="profileEditPage" class="page">
            <div class="header">
                <div onclick="navigateTo('profile')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon12"></i>
                </div>
            </div>

            <div class="content">
                <h2 style="margin-bottom: 30px;">Edit Profile</h2>
                <div class="glass-card" style="max-width: 600px; margin: 0 auto;">
                    <div id="profileEditAlert" class="alert"></div>
                    <form id="profileEditForm">
                        <div class="input-group">
                            <label for="editFirstName">First Name</label>
                            <input type="text" id="editFirstName" required>
                        </div>
                        <div class="input-group">
                            <label for="editSurname">Surname</label>
                            <input type="text" id="editSurname" required>
                        </div>
                        <div class="input-group">
                            <label for="editPhoneNumber">Phone Number</label>
                            <input type="tel" id="editPhoneNumber" required>
                        </div>
                        <div class="input-group">
                            <label for="editAge">Age</label>
                            <input type="number" id="editAge" required min="18" max="120">
                        </div>
                        <div class="input-group">
                            <label for="editCountry">Country</label>
                            <select id="editCountry" required style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                                <option value="">Select Country</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="editState">State/Province</label>
                            <select id="editState" required style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                                <option value="">Select State</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="editStreetAddress">Street Address</label>
                            <input type="text" id="editStreetAddress" required>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 15px;">Save Changes</button>
                        <button type="button" class="btn btn-secondary" onclick="navigateTo('profile')" style="width: 100%;">Cancel</button>
                    </form>
                </div>
            </div>
        </div>

        <div id="receiptPage" class="page">
            <div class="header">
                <div onclick="navigateTo('dashboard')" style="cursor: pointer; font-size: 20px;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon9"></i>
                </div>
            </div>
            <div class="content">
                <div id="receiptContent"></div>
                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button class="btn btn-primary" onclick="downloadReceipt()" style="flex: 1;">
                        <i class="fas fa-download"></i> Download Receipt
                    </button>
                    <button class="btn btn-secondary" onclick="navigateTo('dashboard')" style="flex: 1;">
                        <i class="fas fa-home"></i> Back to Dashboard
                    </button>
                </div>
            </div>
        </div>

        <div id="chatModal" style="position: fixed; bottom: 20px; right: 20px; width: 350px; height: 500px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; box-shadow: 0 5px 40px rgba(0,0,0,0.2); flex-direction: column; z-index: 10000; display: none;">
            <div style="padding: 15px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; background: #667eea; color: white; border-radius: 12px 12px 0 0;">
                <h3 style="margin: 0; font-size: 16px;">LEAD Bank Support</h3>
                <button onclick="closeLiveChat()" style="background: none; border: none; color: white; font-size: 20px; cursor: pointer; padding: 0;">&times;</button>
            </div>
            <div id="chatMessages" style="flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column;"></div>
            <div style="padding: 15px; border-top: 1px solid var(--border-color); display: flex; gap: 10px;">
                <input type="text" id="chatInput" placeholder="Type a message..." style="flex: 1; padding: 10px; border: 1px solid var(--border-color); border-radius: 6px; background: #ffffff; color: var(--text-primary);" onkeypress="if(event.key === 'Enter') sendChatMessage()">
                <button onclick="sendChatMessage()" style="padding: 10px 15px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>

        <div id="converterPage" class="page">
            <div class="header">
                <div class="hamburger" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon13"></i>
                </div>
            </div>

            <div class="content">
                <h2 style="margin-bottom: 30px;">Currency Converter</h2>
                
                <div class="glass-card" style="padding: 30px;">
                    <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                        <div style="flex: 1;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">From</label>
                            <input type="number" id="converterAmount" placeholder="0.00" value="1" step="0.01" min="0" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary); width: 100%; font-size: 16px;" oninput="convertCurrency()">
                        </div>
                        <div style="flex: 1;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Currency</label>
                            <select id="converterFromCurrency" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary); width: 100%; font-size: 16px;" onchange="convertCurrency()">
                                <option value="USD">USD - US Dollar</option>
                                <option value="EUR">EUR - Euro</option>
                                <option value="GBP">GBP - British Pound</option>
                                <option value="JPY">JPY - Japanese Yen</option>
                                <option value="AUD">AUD - Australian Dollar</option>
                                <option value="CAD">CAD - Canadian Dollar</option>
                                <option value="CHF">CHF - Swiss Franc</option>
                                <option value="CNY">CNY - Chinese Yuan</option>
                                <option value="SEK">SEK - Swedish Krona</option>
                                <option value="NZD">NZD - New Zealand Dollar</option>
                                <option value="ILS">ILS - Israeli Shekel</option>
                                <option value="INR">INR - Indian Rupee</option>
                                <option value="MXN">MXN - Mexican Peso</option>
                                <option value="SGD">SGD - Singapore Dollar</option>
                                <option value="HKD">HKD - Hong Kong Dollar</option>
                            </select>
                        </div>
                    </div>

                    <div style="text-align: center; margin: 25px 0;">
                        <button class="btn btn-primary" onclick="swapCurrencies()" style="width: 100%; margin-bottom: 15px;">
                            <i class="fas fa-exchange-alt"></i> Swap Currencies
                        </button>
                    </div>

                    <div style="display: flex; gap: 15px;">
                        <div style="flex: 1;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">To</label>
                            <input type="text" id="converterResult" placeholder="0.00" readonly style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary); width: 100%; font-size: 16px;">
                        </div>
                        <div style="flex: 1;">
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Currency</label>
                            <select id="converterToCurrency" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary); width: 100%; font-size: 16px;" onchange="convertCurrency()">
                                <option value="USD">USD - US Dollar</option>
                                <option value="EUR">EUR - Euro</option>
                                <option value="GBP">GBP - British Pound</option>
                                <option value="JPY">JPY - Japanese Yen</option>
                                <option value="AUD">AUD - Australian Dollar</option>
                                <option value="CAD">CAD - Canadian Dollar</option>
                                <option value="CHF">CHF - Swiss Franc</option>
                                <option value="CNY">CNY - Chinese Yuan</option>
                                <option value="SEK">SEK - Swedish Krona</option>
                                <option value="NZD">NZD - New Zealand Dollar</option>
                                <option value="ILS">ILS - Israeli Shekel</option>
                                <option value="INR">INR - Indian Rupee</option>
                                <option value="MXN">MXN - Mexican Peso</option>
                                <option value="SGD">SGD - Singapore Dollar</option>
                                <option value="HKD">HKD - Hong Kong Dollar</option>
                            </select>
                        </div>
                    </div>

                    <div id="converterRate" style="margin-top: 20px; padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 8px; text-align: center; color: var(--text-secondary); display: none;">
                        <p id="rateText" style="font-size: 14px;"></p>
                        <p id="lastUpdated" style="font-size: 12px; margin-top: 5px;"></p>
                    </div>
                </div>

                <div class="glass-card" style="margin-top: 20px; padding: 20px;">
                    <h3 style="margin-bottom: 15px;">Popular Exchange Rates (USD)</h3>
                    <div id="popularRates" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;"></div>
                </div>
            </div>
        </div>

        <div id="transactionHistoryPage" class="page">
            <div class="header">
                <div onclick="navigateTo('dashboard')" style="cursor: pointer; font-size: 20px;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon7"></i>
                </div>
            </div>

            <div class="content">
                <h2 style="margin-bottom: 30px;">Transaction History</h2>
                <div id="transactionHistoryContent" style="display: flex; flex-direction: column; gap: 12px;"></div>
            </div>
        </div>

        <div id="transactionDetailPage" class="page">
            <div class="header">
                <div onclick="navigateTo('transactionHistory')" style="cursor: pointer; font-size: 20px;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon8"></i>
                </div>
            </div>

            <div class="content">
                <div id="transactionDetailContent" class="glass-card"></div>
                <button class="btn btn-primary" onclick="navigateTo('transactionHistory')" style="width: 100%; margin-top: 30px;">
                    Back to History
                </button>
            </div>
        </div>

        <div id="notificationsPage" class="page">
            <div class="header">
                <div onclick="navigateTo('dashboard')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon10"></i>
                </div>
            </div>

            <div class="content">
                <h2 style="margin-bottom: 30px;">Notifications</h2>
                <div id="notificationsContent" style="display: flex; flex-direction: column; gap: 12px;"></div>
            </div>
        </div>

        <div id="supportPage" class="page">
            <div class="header">
                <div class="hamburger" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon11"></i>
                </div>
            </div>

            <div class="content">
                <h2 style="margin-bottom: 30px;">Customer Support</h2>
                
                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="glass-card" style="padding: 25px; opacity: 0.6;">
                        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                            <i class="fas fa-phone" style="font-size: 28px; color: #999;"></i>
                            <div>
                                <h3 style="margin-bottom: 8px; font-size: 18px; color: #999;">Call Us</h3>
                                <p style="color: #999; margin-bottom: 8px;">Available 24/7</p>
                                <span style="color: #999; font-weight: 600; text-decoration: line-through; cursor: not-allowed;">+1 (800) 532-3226</span>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card" style="padding: 25px;">
                        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                            <i class="fas fa-envelope" style="font-size: 28px; color: #667eea;"></i>
                            <div>
                                <h3 style="margin-bottom: 8px; font-size: 18px;">Email Us</h3>
                                <p style="color: var(--text-secondary); margin-bottom: 8px;">Response within 24 hours</p>
                                <a href="mailto:lead.bankgov@gmail.com" style="color: #667eea; font-weight: 600; text-decoration: none;">lead.bankgov@gmail.com</a>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card" style="padding: 25px; opacity: 0.6;">
                        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                            <i class="fas fa-comments" style="font-size: 28px; color: #999;"></i>
                            <div>
                                <h3 style="margin-bottom: 8px; font-size: 18px; color: #999;">Live Chat</h3>
                                <p style="color: #999; margin-bottom: 12px;">Chat with our support team</p>
                                <button class="btn btn-primary" disabled style="width: 100%; opacity: 0.5; cursor: not-allowed;">Start Chat</button>
                            </div>
                        </div>
                    </div>

                    <div class="glass-card" style="padding: 25px;">
                        <h3 style="margin-bottom: 15px; font-size: 18px;">Frequently Asked Questions</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="padding: 12px; background: #ffffff; border-radius: 8px; cursor: pointer;" onclick="toggleFAQ(this)">
                                <div style="font-weight: 600; color: #667eea;">How do I verify my identity?</div>
                                <div class="faq-answer" style="display: none; margin-top: 10px; color: var(--text-secondary); font-size: 14px;">
                                    Complete the 3-step verification process: upload your face photo and ID, verify your address, and make a minimum $150 deposit.
                                </div>
                            </div>
                            <div style="padding: 12px; background: #ffffff; border-radius: 8px; cursor: pointer;" onclick="toggleFAQ(this)">
                                <div style="font-weight: 600; color: #667eea;">How long does verification take?</div>
                                <div class="faq-answer" style="display: none; margin-top: 10px; color: var(--text-secondary); font-size: 14px;">
                                    Most verifications are completed within 24-48 hours. You'll receive notifications at each step.
                                </div>
                            </div>
                            <div style="padding: 12px; background: #ffffff; border-radius: 8px; cursor: pointer;" onclick="toggleFAQ(this)">
                                <div style="font-weight: 600; color: #667eea;">Is my data secure?</div>
                                <div class="faq-answer" style="display: none; margin-top: 10px; color: var(--text-secondary); font-size: 14px;">
                                    Yes! We use bank-level encryption and security protocols to protect all your personal and financial information.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="settingsPage" class="page">
            <div class="header">
                <div class="hamburger" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon5"></i>
                </div>
            </div>

            <div class="content">
                <h2 style="margin-bottom: 30px;">Settings</h2>
                
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div class="glass-card" style="padding: 20px; cursor: pointer; transition: all 0.3s;" onclick="navigateTo('security')" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; gap: 15px; align-items: center;">
                                <i class="fas fa-shield-alt" style="font-size: 24px; color: #667eea;"></i>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 4px;">Security</div>
                                    <div style="font-size: 13px; color: var(--text-secondary);">PIN, password, 2FA</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right" style="color: var(--text-secondary);"></i>
                        </div>
                    </div>
                    
                    <div class="glass-card" style="padding: 20px; cursor: pointer; transition: all 0.3s;" onclick="navigateTo('profile')" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; gap: 15px; align-items: center;">
                                <i class="fas fa-user" style="font-size: 24px; color: #10b981;"></i>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 4px;">Profile</div>
                                    <div style="font-size: 13px; color: var(--text-secondary);">Personal information</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right" style="color: var(--text-secondary);"></i>
                        </div>
                    </div>

                    <div class="glass-card" style="padding: 20px; cursor: pointer; transition: all 0.3s;" onclick="toggleTheme()" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; gap: 15px; align-items: center;">
                                <i class="fas fa-moon" style="font-size: 24px; color: #f59e0b;"></i>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 4px;">Appearance</div>
                                    <div style="font-size: 13px; color: var(--text-secondary);">Dark / Light mode</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right" style="color: var(--text-secondary);"></i>
                        </div>
                    </div>

                    <div class="glass-card" style="padding: 20px; cursor: pointer; transition: all 0.3s;" onclick="showAlert('Notification settings coming soon!', 'info')" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; gap: 15px; align-items: center;">
                                <i class="fas fa-bell" style="font-size: 24px; color: #ef4444;"></i>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 4px;">Notifications</div>
                                    <div style="font-size: 13px; color: var(--text-secondary);">Alerts and updates</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right" style="color: var(--text-secondary);"></i>
                        </div>
                    </div>

                    <div class="glass-card" style="padding: 20px; cursor: pointer; transition: all 0.3s;" onclick="navigateTo('privacy')" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; gap: 15px; align-items: center;">
                                <i class="fas fa-lock" style="font-size: 24px; color: #8b5cf6;"></i>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 4px;">Privacy</div>
                                    <div style="font-size: 13px; color: var(--text-secondary);">Data & privacy controls</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right" style="color: var(--text-secondary);"></i>
                        </div>
                    </div>

                    <div class="glass-card" style="padding: 20px; cursor: pointer; transition: all 0.3s; background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(16, 185, 129, 0.15) 100%); border: 2px solid rgba(102, 126, 234, 0.3);" onclick="document.getElementById('upgradeAccountModal').classList.add('active')" onmouseover="this.style.transform='translateY(-2px)'" onmouseout="this.style.transform='translateY(0)'">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; gap: 15px; align-items: center;">
                                <i class="fas fa-star" style="font-size: 24px; color: #fbbf24;"></i>
                                <div>
                                    <div style="font-weight: 600; margin-bottom: 4px; color: #667eea;">Upgrade & Verify</div>
                                    <div style="font-size: 13px; color: var(--text-secondary);">Unlock all account features</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-right" style="color: var(--text-secondary);"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="privacyPage" class="page">
            <div class="header">
                <div onclick="navigateTo('settings')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon13"></i>
                </div>
            </div>

            <div class="content">
                <h2 style="margin-bottom: 30px;">Privacy Policy</h2>
                
                <div class="glass-card" style="max-width: 800px; margin: 0 auto; line-height: 1.6;">
                    <h3 style="margin-bottom: 15px; color: #667eea;">Data Protection</h3>
                    <p style="margin-bottom: 20px;">We take your privacy seriously. Your personal information is encrypted and stored securely on our servers. We never share your data with third parties without your consent.</p>
                    
                    <h3 style="margin-bottom: 15px; color: #667eea;">Information We Collect</h3>
                    <p style="margin-bottom: 20px;">We collect information you provide during account creation, including name, email, phone number, and financial information. This information is used solely for account management and transaction processing.</p>
                    
                    <h3 style="margin-bottom: 15px; color: #667eea;">Data Usage</h3>
                    <p style="margin-bottom: 20px;">Your data is used to:</p>
                    <ul style="margin-left: 20px; margin-bottom: 20px;">
                        <li style="margin-bottom: 8px;">Process transactions and manage your account</li>
                        <li style="margin-bottom: 8px;">Comply with legal and regulatory requirements</li>
                        <li style="margin-bottom: 8px;">Improve our services and security</li>
                        <li style="margin-bottom: 8px;">Communicate important updates about your account</li>
                    </ul>
                    
                    <h3 style="margin-bottom: 15px; color: #667eea;">Your Privacy Rights</h3>
                    <p style="margin-bottom: 20px;">You have the right to:</p>
                    <ul style="margin-left: 20px; margin-bottom: 20px;">
                        <li style="margin-bottom: 8px;">Access your personal data</li>
                        <li style="margin-bottom: 8px;">Request correction of inaccurate data</li>
                        <li style="margin-bottom: 8px;">Request deletion of your data (subject to legal requirements)</li>
                        <li style="margin-bottom: 8px;">Withdraw consent at any time</li>
                    </ul>
                    
                    <h3 style="margin-bottom: 15px; color: #667eea;">Security Measures</h3>
                    <p style="margin-bottom: 20px;">We implement industry-standard encryption and security protocols to protect your information. All transactions are secured with SSL/TLS encryption.</p>
                    
                    <h3 style="margin-bottom: 15px; color: #667eea;">Changes to This Policy</h3>
                    <p style="margin-bottom: 20px;">We may update this privacy policy periodically. Changes will be posted on this page with an updated effective date.</p>
                    
                    <h3 style="margin-bottom: 15px; color: #667eea;">Contact Us</h3>
                    <p>For privacy concerns or inquiries, please contact us at <strong>lead.bankgov@gmail.com</strong></p>
                </div>
                
                <button class="btn btn-primary" onclick="navigateTo('settings')" style="width: 100%; margin-top: 30px;">Back to Settings</button>
            </div>
        </div>

        <div id="creditScorePage" class="page">
            <div class="header">
                <div onclick="navigateTo('dashboard')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon6"></i>
                </div>
            </div>

            <div class="content">
                <h2 style="margin-bottom: 30px;">Credit Score</h2>
                
                <div class="glass-card" style="text-align: center; margin-bottom: 30px;">
                    <div style="font-size: 18px; color: var(--text-secondary); margin-bottom: 20px;">Your Credit Score</div>
                    <div style="width: 200px; height: 200px; margin: 0 auto; position: relative;">
                        <canvas id="creditScoreChart"></canvas>
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                            <div id="creditScoreValue" style="font-size: 48px; font-weight: 700;">750</div>
                            <div style="font-size: 14px; color: var(--text-secondary);">Excellent</div>
                        </div>
                    </div>
                    <div style="margin-top: 30px; padding: 20px; background: var(--bg-secondary); border-radius: 12px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: left;">
                            <div>
                                <div style="color: var(--text-secondary); font-size: 14px;">Payment History</div>
                                <div style="font-weight: 600; margin-top: 5px;">Excellent</div>
                            </div>
                            <div>
                                <div style="color: var(--text-secondary); font-size: 14px;">Credit Utilization</div>
                                <div style="font-weight: 600; margin-top: 5px;">28%</div>
                            </div>
                            <div>
                                <div style="color: var(--text-secondary); font-size: 14px;">Credit Age</div>
                                <div style="font-weight: 600; margin-top: 5px;">5 years</div>
                            </div>
                            <div>
                                <div style="color: var(--text-secondary); font-size: 14px;">Total Accounts</div>
                                <div style="font-weight: 600; margin-top: 5px;">8</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass-card">
                    <h3 style="margin-bottom: 20px;">Credit Score Tips</h3>
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <div style="display: flex; gap: 15px; align-items: start;">
                            <i class="fas fa-check-circle" style="color: #10b981; font-size: 20px; margin-top: 2px;"></i>
                            <div>
                                <strong>Pay bills on time</strong>
                                <p style="color: var(--text-secondary); margin-top: 5px;">Your payment history is the most important factor.</p>
                            </div>
                        </div>
                        <div style="display: flex; gap: 15px; align-items: start;">
                            <i class="fas fa-check-circle" style="color: #10b981; font-size: 20px; margin-top: 2px;"></i>
                            <div>
                                <strong>Keep credit utilization low</strong>
                                <p style="color: var(--text-secondary); margin-top: 5px;">Try to use less than 30% of your available credit.</p>
                            </div>
                        </div>
                        <div style="display: flex; gap: 15px; align-items: start;">
                            <i class="fas fa-check-circle" style="color: #10b981; font-size: 20px; margin-top: 2px;"></i>
                            <div>
                                <strong>Maintain older accounts</strong>
                                <p style="color: var(--text-secondary); margin-top: 5px;">Length of credit history matters.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="cardsPage" class="page">
            <div class="header">
                <div onclick="navigateTo('dashboard')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="themeIcon7"></i>
                </div>
            </div>

            <div class="content">
                <h2 style="margin-bottom: 30px;">My Cards</h2>
                
                <div id="cardsContainer" style="display: grid; gap: 20px; margin-bottom: 30px;"></div>
            </div>
        </div>

        <div id="topupSelectCardPage" class="page">
            <div class="header">
                <div onclick="navigateTo('dashboard')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </div>
            </div>

            <div class="content">
                <h2 style="margin-bottom: 10px;">Top Up Account</h2>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">Select a card to fund your account</p>
                
                <div id="topupCardsContainer" style="display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px;"></div>

                <button class="btn btn-primary" onclick="navigateTo('topupAddCard')" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-plus-circle"></i> Add New Card
                </button>
            </div>
        </div>

        <div id="topupAddCardPage" class="page">
            <div class="header">
                <div onclick="navigateTo('topupSelectCard')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </div>
            </div>

            <div class="content">
                <h2 style="margin-bottom: 30px;">Add New Card</h2>
                <div id="topupAddCardAlert" class="alert"></div>
                <form id="topupAddCardForm" style="display: flex; flex-direction: column; gap: 15px;">
                    <div class="input-group">
                        <label for="topupCardType">Card Type</label>
                        <select id="topupCardType" required style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                            <option value="">Select Type</option>
                            <option value="debit">Debit Card</option>
                            <option value="credit">Credit Card</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="topupCardBrand">Card Brand</label>
                        <select id="topupCardBrand" required style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                            <option value="">Select Brand</option>
                            <option value="Visa">Visa</option>
                            <option value="Mastercard">Mastercard</option>
                            <option value="American Express">American Express</option>
                            <option value="Discover">Discover</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="topupCardName">Cardholder Name</label>
                        <input type="text" id="topupCardName" required placeholder="Name on card" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="input-group">
                        <label for="topupCardNumber">Card Number</label>
                        <input type="text" id="topupCardNumber" required placeholder="•••• •••• •••• ••••" maxlength="19" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="input-group">
                            <label for="topupCardExpiry">Expiry Date</label>
                            <input type="text" id="topupCardExpiry" required placeholder="MM/YY" maxlength="5" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                        </div>
                        <div class="input-group">
                            <label for="topupCardCVC">CVC</label>
                            <input type="text" id="topupCardCVC" required placeholder="•••" maxlength="3" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Continue</button>
                </form>
            </div>
        </div>

        <div id="topupAmountPage" class="page">
            <div class="header">
                <div onclick="navigateTo('topupSelectCard')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </div>
            </div>

            <div class="content">
                <h2 style="margin-bottom: 10px;">Top Up Amount</h2>
                <p style="color: var(--text-secondary); margin-bottom: 30px;" id="topupCardDisplay"></p>
                
                <div class="glass-card" style="margin-bottom: 30px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">$</span>
                        <input type="number" id="topupAmount" placeholder="0.00" step="0.01" min="1" style="font-size: 32px; font-weight: 700; border: none; background: transparent; width: 100%; color: var(--text-primary);" required>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 30px;">
                    <button type="button" onclick="setTopupAmount(50)" class="btn btn-secondary" style="background: #ffffff; border: 2px solid var(--border-color);">$50</button>
                    <button type="button" onclick="setTopupAmount(100)" class="btn btn-secondary" style="background: #ffffff; border: 2px solid var(--border-color);">$100</button>
                    <button type="button" onclick="setTopupAmount(200)" class="btn btn-secondary" style="background: #ffffff; border: 2px solid var(--border-color);">$200</button>
                    <button type="button" onclick="setTopupAmount(500)" class="btn btn-secondary" style="background: #ffffff; border: 2px solid var(--border-color);">$500</button>
                    <button type="button" onclick="setTopupAmount(1000)" class="btn btn-secondary" style="background: #ffffff; border: 2px solid var(--border-color);">$1,000</button>
                    <button type="button" onclick="setTopupAmount(5000)" class="btn btn-secondary" style="background: #ffffff; border: 2px solid var(--border-color);">$5,000</button>
                </div>

                <button class="btn btn-primary" onclick="proceedToTopupConfirm()" style="width: 100%;">Continue to Confirmation</button>
            </div>
        </div>

        <div id="topupConfirmPage" class="page">
            <div class="header">
                <div onclick="navigateTo('topupAmountPage')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </div>
            </div>

            <div class="content">
                <h2 style="margin-bottom: 30px; text-align: center;">Confirm Top Up</h2>
                
                <div class="glass-card" style="margin-bottom: 30px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border: 2px solid rgba(102, 126, 234, 0.3);">
                    <div style="text-align: center;">
                        <div style="color: var(--text-secondary); margin-bottom: 15px;">Top Up Amount</div>
                        <div id="topupConfirmAmount" style="font-size: 48px; font-weight: 700; color: #667eea; margin-bottom: 15px;">$0.00</div>
                        <div style="color: var(--text-secondary); font-size: 14px;">Card: <span id="topupConfirmCard">••••</span></div>
                    </div>
                </div>

                <div style="margin-bottom: 30px;">
                    <label style="display: block; margin-bottom: 15px; text-align: center; font-weight: 600;">Enter Your 4-Digit PIN</label>
                    <div class="pin-input-container">
                        <input type="text" class="pin-digit" maxlength="1" id="topupPin1" readonly style="cursor: pointer;">
                        <input type="text" class="pin-digit" maxlength="1" id="topupPin2" readonly style="cursor: pointer;">
                        <input type="text" class="pin-digit" maxlength="1" id="topupPin3" readonly style="cursor: pointer;">
                        <input type="text" class="pin-digit" maxlength="1" id="topupPin4" readonly style="cursor: pointer;">
                    </div>
                    <div id="topupDialPad" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px;"></div>
                </div>

                <button class="btn btn-primary" onclick="completeTopup()" style="width: 100%;">Complete Top Up</button>
            </div>
        </div>

        <!-- BUY CRYPTO PAGE -->
        <div id="buyCryptoPage" class="page">
            <div class="header">
                <div onclick="navigateTo('cryptoDetail')" style="cursor: pointer;"><i class="fas fa-arrow-left"></i></div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-moon"></i></div>
            </div>
            <div class="content">
                <h2 style="margin-bottom: 30px; text-align: center;">Buy <span id="buyCryptoName"></span></h2>
                <div id="buyCryptoAlert" class="alert"></div>
                
                <div class="glass-card" style="margin-bottom: 30px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border: 2px solid rgba(102, 126, 234, 0.3); padding: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 5px;">CURRENT PRICE</div>
                            <div style="font-size: 24px; font-weight: 700; color: #667eea;" id="buyCryptoPrice">$0.00</div>
                        </div>
                        <div>
                            <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 5px;">YOU GET</div>
                            <div style="font-size: 24px; font-weight: 700; color: #10b981;" id="buyCryptoAmount">0.00 BTC</div>
                        </div>
                    </div>
                </div>

                <form id="buyCryptoForm" style="display: flex; flex-direction: column; gap: 15px;">
                    <div class="input-group">
                        <label for="buyCryptoUSD">Amount (USD)</label>
                        <input type="number" id="buyCryptoUSD" placeholder="0.00" step="0.01" min="1" style="font-size: 18px; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);" oninput="updateBuyCryptoCalculation()">
                    </div>

                    <div class="glass-card" style="padding: 15px; background: #ffffff;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: var(--text-secondary);">Fee (1.5%)</span>
                            <span style="font-weight: 600;" id="buyCryptoFee">$0.00</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding-top: 10px; border-top: 1px solid var(--border-color);">
                            <span style="color: var(--text-secondary);">Total</span>
                            <span style="font-weight: 700; color: #667eea;" id="buyCryptoTotal">$0.00</span>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="buyCryptoFromAccount">From Account</label>
                        <select id="buyCryptoFromAccount" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);" onchange="updateBuyAccountDisplay()">
                            <option value="checking">Checking</option>
                            <option value="savings">Savings</option>
                        </select>
                    </div>

                    <div class="glass-card" style="padding: 15px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3);">
                        <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 5px;">AVAILABLE BALANCE</div>
                        <div style="font-size: 20px; font-weight: 700; color: #10b981;" id="buyCryptoBalance">$0.00</div>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Review Purchase</button>
                </form>
            </div>
        </div>

        <!-- SELL CRYPTO PAGE -->
        <div id="sellCryptoPage" class="page">
            <div class="header">
                <div onclick="navigateTo('cryptoDetail')" style="cursor: pointer;"><i class="fas fa-arrow-left"></i></div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-moon"></i></div>
            </div>
            <div class="content">
                <h2 style="margin-bottom: 30px; text-align: center;">Sell <span id="sellCryptoName"></span></h2>
                <div id="sellCryptoAlert" class="alert"></div>
                
                <div class="glass-card" style="margin-bottom: 30px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border: 2px solid rgba(102, 126, 234, 0.3); padding: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 5px;">CURRENT PRICE</div>
                            <div style="font-size: 24px; font-weight: 700; color: #667eea;" id="sellCryptoPrice">$0.00</div>
                        </div>
                        <div>
                            <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 5px;">YOU GET (USD)</div>
                            <div style="font-size: 24px; font-weight: 700; color: #10b981;" id="sellCryptoUSD">$0.00</div>
                        </div>
                    </div>
                </div>

                <form id="sellCryptoForm" style="display: flex; flex-direction: column; gap: 15px;">
                    <div class="input-group">
                        <label for="sellCryptoAmount">Amount (<span id="sellCryptoSymbol">BTC</span>)</label>
                        <input type="number" id="sellCryptoAmount" placeholder="0.00000000" step="0.00000001" min="0" style="font-size: 18px; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);" oninput="updateSellCryptoCalculation()">
                    </div>

                    <div class="glass-card" style="padding: 15px; background: #ffffff;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: var(--text-secondary);">Fee (1.5%)</span>
                            <span style="font-weight: 600;" id="sellCryptoFee">$0.00</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding-top: 10px; border-top: 1px solid var(--border-color);">
                            <span style="color: var(--text-secondary);">You Receive</span>
                            <span style="font-weight: 700; color: #667eea;" id="sellCryptoReceive">$0.00</span>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="sellCryptoToAccount">To Account</label>
                        <select id="sellCryptoToAccount" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                            <option value="checking">Checking</option>
                            <option value="savings">Savings</option>
                        </select>
                    </div>

                    <div class="glass-card" style="padding: 15px; background: rgba(102, 126, 234, 0.1); border: 1px solid rgba(102, 126, 234, 0.3);">
                        <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 5px;">YOUR HOLDINGS</div>
                        <div style="font-size: 20px; font-weight: 700; color: #667eea;" id="sellCryptoHoldings">0.00 BTC</div>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Review Sale</button>
                </form>
            </div>
        </div>

        <!-- INTERNAL TRANSFER PAGE -->
        <div id="internalTransferPage" class="page">
            <div class="header">
                <div onclick="navigateTo('dashboard')" style="cursor: pointer;"><i class="fas fa-arrow-left"></i></div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-moon"></i></div>
            </div>
            <div class="content">
                <h2 style="margin-bottom: 10px;">Move Money Between Accounts</h2>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">Transfer between your Checking and Savings accounts</p>
                <div id="internalTransferAlert" class="alert"></div>
                <form id="internalTransferForm" style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="input-group">
                        <label for="internalFromAccount">From Account</label>
                        <select id="internalFromAccount" required style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                            <option value="checking">Checking</option>
                            <option value="savings">Savings</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="internalToAccount">To Account</label>
                        <select id="internalToAccount" required style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                            <option value="savings">Savings</option>
                            <option value="checking">Checking</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="internalTransferAmount">Amount</label>
                        <input type="number" id="internalTransferAmount" placeholder="0.00" step="0.01" min="0.01" required style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Continue</button>
                </form>
            </div>
        </div>

        <!-- BANK TRANSFER PAGE -->
        <div id="bankTransferPage" class="page">
            <div class="header">
                <div onclick="navigateTo('dashboard')" style="cursor: pointer;"><i class="fas fa-arrow-left"></i></div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-moon"></i></div>
            </div>
            <div class="content">
                <h2 style="margin-bottom: 10px;">Bank Transfer</h2>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">Send money to another bank account</p>
                <div id="bankTransferAlert" class="alert"></div>
                <form id="bankTransferForm" style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="input-group">
                        <label for="bankTransferRecipient">Recipient Name</label>
                        <input type="text" id="bankTransferRecipient" placeholder="John Doe" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="input-group">
                        <label for="bankTransferAccount">Account Number</label>
                        <input type="text" id="bankTransferAccount" placeholder="1234567890" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="input-group">
                        <label for="bankTransferBank">Bank Name</label>
                        <input type="text" id="bankTransferBank" placeholder="Example Bank" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="input-group">
                        <label for="bankTransferAmount">Amount</label>
                        <input type="number" id="bankTransferAmount" placeholder="0.00" step="0.01" min="1" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="input-group">
                        <label for="bankTransferFromAccount">From Account</label>
                        <select id="bankTransferFromAccount" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                            <option value="checking">Checking</option>
                            <option value="savings">Savings</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Continue</button>
                </form>
            </div>
        </div>

        <!-- WIRE TRANSFER PAGE -->
        <div id="wireTransferPage" class="page">
            <div class="header">
                <div onclick="navigateTo('dashboard')" style="cursor: pointer;"><i class="fas fa-arrow-left"></i></div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-moon"></i></div>
            </div>
            <div class="content">
                <h2 style="margin-bottom: 10px;">International Wire Transfer</h2>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">Send money internationally</p>
                <div id="wireTransferAlert" class="alert"></div>
                <form id="wireTransferForm" style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="input-group">
                        <label for="wireRecipient">Recipient Name</label>
                        <input type="text" id="wireRecipient" placeholder="John Doe" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="input-group">
                        <label for="wireRecipientAddress">Recipient Address</label>
                        <input type="text" id="wireRecipientAddress" placeholder="123 Main St, City" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="input-group">
                        <label for="wireCountry">Country</label>
                        <div style="position: relative;">
                            <input type="text" id="wireCountry" placeholder="Select Country" readonly style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary); cursor: pointer;" onclick="toggleCountryDropdown()">
                            <i class="fas fa-chevron-down" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); pointer-events: none;"></i>
                            <div id="wireCountryDropdown" style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: #ffffff; border: 1px solid #e2e8f0; border-radius: 8px; max-height: 300px; overflow-y: auto; z-index: 1000; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); margin-top: 5px;">
                            </div>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="wireBank">Bank Name</label>
                        <input type="text" id="wireBank" placeholder="Bank Name" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="input-group">
                        <label for="wireBankAddress">Bank Address</label>
                        <input type="text" id="wireBankAddress" placeholder="Bank Street, City" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="input-group">
                        <label for="wireSwiftCode">SWIFT Code</label>
                        <input type="text" id="wireSwiftCode" placeholder="XXXXUSXX" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="input-group">
                        <label for="wireAccount">Account Number</label>
                        <input type="text" id="wireAccount" placeholder="International Account" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="input-group">
                        <label for="wireAmount">Amount (USD)</label>
                        <input type="number" id="wireAmount" placeholder="0.00" step="0.01" min="1" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="input-group">
                        <label for="wireFromAccount">From Account</label>
                        <select id="wireFromAccount" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                            <option value="checking">Checking</option>
                            <option value="savings">Savings</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Continue</button>
                </form>
            </div>
        </div>

        <!-- SEND TO CREDCRYPT USER PAGE -->
        <div id="credcryptTransferPage" class="page">
            <div class="header">
                <div onclick="navigateTo('dashboard')" style="cursor: pointer;"><i class="fas fa-arrow-left"></i></div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-moon"></i></div>
            </div>
            <div class="content">
                <h2 style="margin-bottom: 10px;">Send to LEAD User</h2>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">Transfer money to another LEAD account</p>
                <div id="credcryptTransferAlert" class="alert"></div>
                <form id="credcryptTransferForm" style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="input-group">
                        <label for="credcryptRecipientAccount">Recipient Account Number</label>
                        <input type="text" id="credcryptRecipientAccount" placeholder="1234567890" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);" oninput="lookupCredcryptUser()" onfocus="loadCredcryptTransferBalance()">
                    </div>
                    <div id="credcryptRecipientNameDisplay" style="display: none; padding: 15px; background: rgba(102, 126, 234, 0.1); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 8px;">
                        <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 5px;">RECIPIENT</div>
                        <div style="font-size: 18px; font-weight: 700; color: #667eea;" id="credcryptRecipientName"></div>
                    </div>
                    <div class="input-group">
                        <label for="credcryptAmount">Amount</label>
                        <input type="number" id="credcryptAmount" placeholder="0.00" step="0.01" min="0.01" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="glass-card" style="padding: 15px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3);">
                        <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 5px;">AVAILABLE BALANCE</div>
                        <div style="font-size: 20px; font-weight: 700; color: #10b981;" id="credcryptAvailableBalance">$0.00</div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Continue</button>
                </form>
            </div>
        </div>

        <!-- WITHDRAW PAGE -->
        <div id="withdrawPage" class="page">
            <div class="header">
                <div onclick="navigateTo('dashboard')" style="cursor: pointer;"><i class="fas fa-arrow-left"></i></div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-moon"></i></div>
            </div>
            <div class="content">
                <h2 style="margin-bottom: 10px;">Withdraw Funds</h2>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">Where would you like to withdraw to?</p>
                <div id="withdrawAlert" class="alert"></div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px;">
                    <div class="glass-card" onclick="selectWithdrawType('card')" style="cursor: pointer; padding: 30px; text-align: center; border: 3px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='#667eea'; this.style.transform='scale(1.05)';" onmouseout="this.style.borderColor='transparent'; this.style.transform='scale(1)';">
                        <i class="fas fa-credit-card" style="font-size: 48px; color: #667eea; margin-bottom: 15px;"></i>
                        <h3 style="margin-bottom: 10px;">Linked Card</h3>
                        <p style="color: var(--text-secondary); font-size: 14px;">Withdraw to your card</p>
                    </div>
                    <div class="glass-card" onclick="selectWithdrawType('bank')" style="cursor: pointer; padding: 30px; text-align: center; border: 3px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='#667eea'; this.style.transform='scale(1.05)';" onmouseout="this.style.borderColor='transparent'; this.style.transform='scale(1)';">
                        <i class="fas fa-university" style="font-size: 48px; color: #667eea; margin-bottom: 15px;"></i>
                        <h3 style="margin-bottom: 10px;">Bank Account</h3>
                        <p style="color: var(--text-secondary); font-size: 14px;">Withdraw to your bank</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- WITHDRAW TO CARD PAGE -->
        <div id="withdrawCardPage" class="page">
            <div class="header">
                <div onclick="navigateTo('withdraw')" style="cursor: pointer;"><i class="fas fa-arrow-left"></i></div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-moon"></i></div>
            </div>
            <div class="content">
                <h2 style="margin-bottom: 30px;">Select Card</h2>
                <div id="withdrawCardAlert" class="alert"></div>
                <div id="withdrawCardsContainer" style="display: flex; flex-direction: column; gap: 15px; margin-bottom: 30px;"></div>
                <form id="withdrawCardForm" style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="input-group">
                        <label for="withdrawCardAmount">Amount</label>
                        <input type="number" id="withdrawCardAmount" placeholder="0.00" step="0.01" min="1" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="input-group">
                        <label for="withdrawCardFromAccount">From Account</label>
                        <select id="withdrawCardFromAccount" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                            <option value="checking">Checking</option>
                            <option value="savings">Savings</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Continue</button>
                </form>
            </div>
        </div>

        <!-- WITHDRAW TO BANK PAGE -->
        <div id="withdrawBankPage" class="page">
            <div class="header">
                <div onclick="navigateTo('withdraw')" style="cursor: pointer;"><i class="fas fa-arrow-left"></i></div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-moon"></i></div>
            </div>
            <div class="content">
                <h2 style="margin-bottom: 10px;">Withdraw to Bank</h2>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">Enter your bank details</p>
                <div id="withdrawBankAlert" class="alert"></div>
                <form id="withdrawBankForm" style="display: flex; flex-direction: column; gap: 20px;">
                    <div class="input-group">
                        <label for="withdrawBankName">Bank Name</label>
                        <input type="text" id="withdrawBankName" placeholder="Your Bank" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="input-group">
                        <label for="withdrawBankAccount">Account Number</label>
                        <input type="text" id="withdrawBankAccount" placeholder="Account" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="input-group">
                        <label for="withdrawBankAmount">Amount</label>
                        <input type="number" id="withdrawBankAmount" placeholder="0.00" step="0.01" min="1" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="input-group">
                        <label for="withdrawBankFromAccount">From Account</label>
                        <select id="withdrawBankFromAccount" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                            <option value="checking">Checking</option>
                            <option value="savings">Savings</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Continue</button>
                </form>
            </div>
        </div>

        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <img id="sidebarProfilePicture" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23667eea'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E" alt="Profile" style="width: 50px; height: 50px; border-radius: 50%; margin-bottom: 15px; background: #ffffff; padding: 5px;">
                <h2>Menu</h2>
            </div>
            <div class="sidebar-menu">
                <div class="sidebar-item" onclick="navigateTo('settings'); toggleSidebar()">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
                <div class="sidebar-item" onclick="navigateTo('security'); toggleSidebar()">
                    <i class="fas fa-shield-alt"></i>
                    <span>Security</span>
                </div>
                <div class="sidebar-item" onclick="navigateTo('profile'); toggleSidebar()">
                    <i class="fas fa-user"></i>
                    <span>User Information</span>
                </div>
                <div class="sidebar-item" onclick="navigateTo('converter'); toggleSidebar()">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Currency Converter</span>
                </div>
                <div class="sidebar-item" onclick="navigateTo('support'); toggleSidebar()">
                    <i class="fas fa-headset"></i>
                    <span>Customer Support</span>
                </div>
                <div class="sidebar-item" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </div>
            </div>
        </div>

        <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>

        <div class="bottom-nav" id="bottomNav" style="display: none;">
            <div class="nav-item active" onclick="navigateTo('dashboard')">
                <i class="fas fa-home"></i>
                <span>Dashboard</span>
            </div>
            <div class="nav-item" onclick="navigateTo('crypto')">
                <i class="fab fa-bitcoin"></i>
                <span>Crypto</span>
            </div>
            <div class="nav-item" onclick="showTransactionHistory()">
                <i class="fas fa-list"></i>
                <span>Transactions</span>
            </div>
            <div class="nav-item" onclick="navigateTo('profile')">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </div>
        </div>

        <div id="transferModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title" id="transferModalTitle">Transfer</h2>
                    <span class="modal-close" onclick="closeModal('transferModal')">&times;</span>
                </div>
                <div id="transferModalAlert" class="alert"></div>
                <form id="transferForm">
                    <div id="transferFormFields"></div>
                    <div id="availableBalanceDisplay" style="font-size: 12px; color: #718096; margin-top: -15px; margin-bottom: 15px; display: none;">Available: <span id="availableBalanceAmount">$0.00</span></div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Continue</button>
                </form>
            </div>
        </div>

        <div id="confirmationModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Confirm Transaction</h2>
                    <span class="modal-close" onclick="closeModal('confirmationModal')">&times;</span>
                </div>
                <div class="transaction-summary" id="confirmationSummary"></div>
                <div style="margin: 20px 0;">
                    <label style="display: block; margin-bottom: 10px; text-align: center; font-weight: 600;">Enter PIN</label>
                    <div class="pin-input-container">
                        <input type="text" class="pin-digit" maxlength="1" id="pin1" readonly style="cursor: pointer;">
                        <input type="text" class="pin-digit" maxlength="1" id="pin2" readonly style="cursor: pointer;">
                        <input type="text" class="pin-digit" maxlength="1" id="pin3" readonly style="cursor: pointer;">
                        <input type="text" class="pin-digit" maxlength="1" id="pin4" readonly style="cursor: pointer;">
                    </div>
                    <div id="dialPad" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px;"></div>
                </div>
                <button class="btn btn-primary" onclick="processPinTransaction()" style="width: 100%;">Confirm</button>
            </div>
        </div>

        <div id="cryptoTradeModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title" id="cryptoTradeTitle">Buy Crypto</h2>
                    <span class="modal-close" onclick="closeModal('cryptoTradeModal')">&times;</span>
                </div>
                <div id="cryptoTradeAlert" class="alert"></div>
                <form id="cryptoTradeForm">
                    <div class="toggle-switch">
                        <div class="toggle-option active" onclick="toggleCryptoInput('crypto')">Crypto</div>
                        <div class="toggle-option" onclick="toggleCryptoInput('fiat')">Fiat</div>
                    </div>
                    <div class="input-group">
                        <label id="cryptoInputLabel">Amount (BTC)</label>
                        <input type="number" id="cryptoAmount" step="0.00000001" required>
                        <p id="cryptoConversion" style="margin-top: 10px; color: var(--text-secondary);"></p>
                        <div id="cryptoHoldingsDisplay" style="font-size: 12px; color: #718096; margin-top: 8px; display: none;">You have: <span id="cryptoHoldingsAmount">0 BTC</span></div>
                    </div>
                    <div class="input-group">
                        <label for="cryptoFromAccount">From Account</label>
                        <select id="cryptoFromAccount" required>
                            <option value="checking">Checking</option>
                            <option value="savings">Savings</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Continue</button>
                </form>
            </div>
        </div>

        <div id="cryptoConfirmationModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Confirm Crypto Transaction</h2>
                    <span class="modal-close" onclick="closeModal('cryptoConfirmationModal')">&times;</span>
                </div>
                <div class="transaction-summary" id="cryptoConfirmationSummary"></div>
                <button class="btn btn-primary" onclick="processCryptoTransaction()" style="width: 100%; margin-top: 20px;">Confirm</button>
            </div>
        </div>

        <div id="upgradeAccountModal" class="modal">
            <div class="modal-content" style="max-width: 400px; text-align: center;">
                <div class="modal-header">
                    <h2 class="modal-title">Account Verification Required</h2>
                    <span class="modal-close" onclick="closeModal('upgradeAccountModal')">&times;</span>
                </div>
                <div style="padding: 30px 0;">
                    <i class="fas fa-shield-alt" style="font-size: 64px; color: #667eea; margin-bottom: 20px; display: block;"></i>
                    <h3 style="margin-bottom: 15px; color: var(--text-primary);">Upgrade & Verify Your Account</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 25px; line-height: 1.6;">
                        To make transactions and withdraw funds, you need to upgrade and verify your account. This keeps your money secure and complies with banking regulations.
                    </p>
                    <div style="background: #ffffff; padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                        <div style="color: var(--text-secondary); font-size: 12px; margin-bottom: 10px;">AFTER VERIFICATION YOU GET</div>
                        <ul style="text-align: left; color: var(--text-primary);">
                            <li style="margin-bottom: 8px;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i>Unlimited transactions</li>
                            <li style="margin-bottom: 8px;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i>Higher withdrawal limits</li>
                            <li style="margin-bottom: 8px;"><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i>Access to all features</li>
                            <li><i class="fas fa-check" style="color: #10b981; margin-right: 8px;"></i>Full account security</li>
                        </ul>
                    </div>
                    <button class="btn btn-primary" onclick="closeModal('upgradeAccountModal'); navigateTo('upgrade');" style="width: 100%; margin-bottom: 10px;">Upgrade & Verify</button>
                    <button class="btn btn-secondary" onclick="closeModal('upgradeAccountModal')" style="width: 100%; background: #ffffff; border: 2px solid var(--border-color);">Remind Me Later</button>
                </div>
            </div>
        </div>

        <div id="upgradePage" class="page">
            <div class="header">
                <div onclick="navigateTo('settings')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">Account Status</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </div>
            </div>
            <div class="content" style="padding-bottom: 40px;">
                <!-- Account Verified Banner -->
                <div style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 20px; padding: 30px; margin-bottom: 25px; text-align: center; box-shadow: 0 15px 40px rgba(16, 185, 129, 0.3);">
                    <div style="width: 80px; height: 80px; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
                        <i class="fas fa-shield-check" style="font-size: 40px; color: white;"></i>
                    </div>
                    <h2 style="color: white; font-size: 28px; font-weight: 800; margin-bottom: 10px;">Account Verified</h2>
                    <p style="color: rgba(255,255,255,0.9); font-size: 16px; margin-bottom: 20px;">Your account is fully verified and active</p>
                    <div style="display: inline-flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 30px;">
                        <i class="fas fa-check-circle" style="color: white;"></i>
                        <span style="color: white; font-weight: 600;">Full Access Enabled</span>
                    </div>
                </div>

                <h3 style="margin-bottom: 20px; color: var(--text-primary);">Verification Summary</h3>
                
                <div class="glass-card" style="margin-bottom: 15px; padding: 20px; border-left: 4px solid #10b981;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="margin-bottom: 5px; font-size: 18px; color: var(--text-primary);">Step 1: Identity</h3>
                            <p style="color: #10b981; font-size: 14px; font-weight: 600;"><i class="fas fa-check-circle" style="margin-right: 5px;"></i>Verified</p>
                        </div>
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #10b981 0%, #059669 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 20px;" id="step1Badge">
                            <i class="fas fa-check" id="step1Check"></i>
                            <span id="step1Number" style="display: none;">1</span>
                        </div>
                    </div>
                </div>

                <div class="glass-card" style="margin-bottom: 15px; padding: 20px; border-left: 4px solid #10b981;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="margin-bottom: 5px; font-size: 18px; color: var(--text-primary);">Step 2: Address</h3>
                            <p style="color: #10b981; font-size: 14px; font-weight: 600;"><i class="fas fa-check-circle" style="margin-right: 5px;"></i>Verified</p>
                        </div>
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #10b981 0%, #059669 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 20px;" id="step2Badge">
                            <i class="fas fa-check" id="step2Check"></i>
                            <span id="step2Number" style="display: none;">2</span>
                        </div>
                    </div>
                </div>

                <div class="glass-card" style="padding: 20px; border-left: 4px solid #10b981;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h3 style="margin-bottom: 5px; font-size: 18px; color: var(--text-primary);">Step 3: Deposit</h3>
                            <p style="color: #10b981; font-size: 14px; font-weight: 600;"><i class="fas fa-check-circle" style="margin-right: 5px;"></i>Verified</p>
                        </div>
                        <div style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #10b981 0%, #059669 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 20px;" id="step3Badge">
                            <i class="fas fa-check" id="step3Check"></i>
                            <span id="step3Number" style="display: none;">3</span>
                        </div>
                    </div>
                </div>

                <!-- Account Benefits Section -->
                <div class="glass-card" style="margin-top: 25px; padding: 25px;">
                    <h3 style="margin-bottom: 20px; font-size: 18px; color: var(--text-primary);">Your Account Benefits</h3>
                    <div style="display: grid; gap: 15px;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-infinity" style="color: #10b981;"></i>
                            </div>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">Unlimited Transactions</div>
                                <div style="font-size: 13px; color: var(--text-secondary);">No limits on transfers and payments</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-up" style="color: #10b981;"></i>
                            </div>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">Higher Withdrawal Limits</div>
                                <div style="font-size: 13px; color: var(--text-secondary);">Up to $50,000 daily</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 40px; height: 40px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-lock" style="color: #10b981;"></i>
                            </div>
                            <div>
                                <div style="font-weight: 600; color: var(--text-primary);">Full Account Security</div>
                                <div style="font-size: 13px; color: var(--text-secondary);">Advanced protection enabled</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="loansPage" class="page">
            <div class="header">
                <div onclick="navigateTo('dashboard')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </div>
            </div>
            <div class="content">
                <h2 style="margin-bottom: 30px;">Available Loans</h2>
                <div id="loansContainer" style="display: flex; flex-direction: column; gap: 15px;"></div>
            </div>
        </div>

        <!-- STEP 1 VERIFICATION PAGE -->
        <div id="step1VerificationPage" class="page">
            <div class="header">
                <div onclick="navigateTo('upgrade')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">Step 1: Identity</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </div>
            </div>
            <div class="content" style="padding-bottom: 40px;">
                <h2 style="margin-bottom: 10px;">Identity Verification</h2>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">Upload your face photo and ID card</p>
                
                <div class="glass-card" style="padding: 20px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px; font-size: 16px;">Face Photo</h3>
                    <div style="border: 2px dashed #667eea; border-radius: 12px; padding: 30px; text-align: center; margin-bottom: 20px; cursor: pointer;" onclick="document.getElementById('step1FaceInput').click()">
                        <i class="fas fa-camera" style="font-size: 40px; color: #667eea; margin-bottom: 12px; display: block;"></i>
                        <div style="font-weight: 600; font-size: 16px; margin-bottom: 5px;">Click to upload</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">JPG or PNG</div>
                    </div>
                    <input type="file" id="step1FaceInput" accept="image/*" style="display: none;" onchange="handleStep1FaceUpload()">
                    <div id="step1FacePreview" style="display: none; border-radius: 12px; overflow: hidden;">
                        <img id="step1FaceImage" style="width: 100%; max-height: 250px; object-fit: cover; border-radius: 12px; border: 2px solid #10b981;">
                        <div style="text-align: center; color: #10b981; font-size: 13px; margin-top: 10px;"><i class="fas fa-check-circle"></i> Photo selected</div>
                    </div>
                </div>

                <div class="glass-card" style="padding: 20px;">
                    <h3 style="margin-bottom: 15px; font-size: 16px;">ID Card</h3>
                    <div style="border: 2px dashed #667eea; border-radius: 12px; padding: 30px; text-align: center; margin-bottom: 20px; cursor: pointer;" onclick="document.getElementById('step1IDInput').click()">
                        <i class="fas fa-id-card" style="font-size: 40px; color: #667eea; margin-bottom: 12px; display: block;"></i>
                        <div style="font-weight: 600; font-size: 16px; margin-bottom: 5px;">Click to upload</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">JPG or PNG</div>
                    </div>
                    <input type="file" id="step1IDInput" accept="image/*" style="display: none;" onchange="handleStep1IDUpload()">
                    <div id="step1IDPreview" style="display: none; border-radius: 12px; overflow: hidden;">
                        <img id="step1IDImage" style="width: 100%; max-height: 250px; object-fit: cover; border-radius: 12px; border: 2px solid #10b981;">
                        <div style="text-align: center; color: #10b981; font-size: 13px; margin-top: 10px;"><i class="fas fa-check-circle"></i> ID selected</div>
                    </div>
                    <button class="btn btn-primary" onclick="saveStep1Complete()" style="width: 100%; padding: 12px; margin-top: 20px; display: none;" id="step1SaveBtn">Upload & Continue</button>
                </div>
            </div>
        </div>

        <!-- ADDRESS VERIFICATION PAGE -->
        <div id="addressVerificationPage" class="page">
            <div class="header">
                <div onclick="navigateTo('upgrade')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">Address Verification</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </div>
            </div>
            <div class="content" style="padding-bottom: 40px;">
                <h2 style="margin-bottom: 10px;">Step 2: Address Verification</h2>
                <p style="color: var(--text-secondary); margin-bottom: 30px;">Upload a recent proof of your address</p>
                
                <div class="glass-card" style="padding: 20px;">
                    <div style="margin-bottom: 20px;">
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Document Type</label>
                        <select id="addressDocType" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                            <option value="">Choose type...</option>
                            <option value="electricity">Electricity Bill</option>
                            <option value="water">Water Bill</option>
                            <option value="gas">Gas Bill</option>
                            <option value="internet">Internet Bill</option>
                            <option value="bankstatement">Bank Statement</option>
                            <option value="rentagreement">Rental Agreement</option>
                            <option value="governmentletter">Government Letter</option>
                            <option value="mortgage">Mortgage Statement</option>
                        </select>
                    </div>
                    <div style="border: 2px dashed #667eea; border-radius: 12px; padding: 30px; text-align: center; margin-bottom: 20px; cursor: pointer;" onclick="document.getElementById('addressUploadInput').click()">
                        <i class="fas fa-file-upload" style="font-size: 40px; color: #667eea; margin-bottom: 12px; display: block;"></i>
                        <div style="font-weight: 600; font-size: 16px; margin-bottom: 5px;">Click to upload</div>
                        <div style="font-size: 13px; color: var(--text-secondary);">JPG, PNG or PDF</div>
                    </div>
                    <input type="file" id="addressUploadInput" accept="image/*,.pdf" style="display: none;" onchange="handleAddressUpload()">
                    <div id="addressUploadPreview" style="display: none; margin-bottom: 20px; border-radius: 12px; overflow: hidden;">
                        <img id="addressPreviewImage" style="width: 100%; max-height: 200px; object-fit: cover; border-radius: 12px; border: 2px solid #10b981;">
                        <div style="text-align: center; color: #10b981; font-size: 13px; margin-top: 10px;"><i class="fas fa-check-circle"></i> Document selected</div>
                    </div>
                    <button class="btn btn-primary" onclick="saveStep2Complete()" style="width: 100%; display: none; padding: 14px;" id="uploadAddressBtn">Upload & Continue</button>
                </div>
            </div>
        </div>

        <!-- STEP 3 VERIFICATION PAGE -->
        <div id="step3VerificationPage" class="page">
            <div class="header">
                <div onclick="navigateTo('upgrade')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">Step 3: Final Deposit</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </div>
            </div>
            <div class="content" style="padding-bottom: 40px;">
                <!-- Cool Banner with Gradient -->
                <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(16, 185, 129, 0.2) 100%); border: 2px solid rgba(102, 126, 234, 0.5); border-radius: 16px; padding: 40px 30px; margin-bottom: 30px; text-align: center; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%); border-radius: 50%;"></div>
                    <div style="position: absolute; bottom: -30px; left: -30px; width: 150px; height: 150px; background: radial-gradient(circle, rgba(16, 185, 129, 0.1) 0%, transparent 70%); border-radius: 50%;"></div>
                    
                    <div style="position: relative; z-index: 1;">
                        <i class="fas fa-piggy-bank" style="font-size: 56px; color: #667eea; margin-bottom: 20px; display: block;"></i>
                        <h2 style="margin: 0 0 20px 0; font-size: 28px; color: var(--text-primary);">Final Verification Step</h2>
                        <p style="color: var(--text-primary); font-size: 18px; margin: 0; font-weight: 500; line-height: 1.6;">
                            Deposit minimum of <span style="color: #667eea; font-weight: 700; font-size: 20px;">$150 USD</span> into your account to upgrade and verify your account
                        </p>
                        <p style="color: var(--text-secondary); font-size: 15px; margin: 20px 0 0 0; line-height: 1.5;">
                            This is the final verification process to complete your LEAD banking account setup
                        </p>
                    </div>
                </div>

                <!-- Info Cards -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px;">
                    <div class="glass-card" style="padding: 20px; text-align: center;">
                        <i class="fas fa-shield-alt" style="font-size: 32px; color: #10b981; margin-bottom: 10px; display: block;"></i>
                        <h3 style="margin: 10px 0; font-size: 14px; color: var(--text-primary);">Secure</h3>
                        <p style="color: var(--text-secondary); font-size: 12px; margin: 0;">All deposits are protected</p>
                    </div>
                    <div class="glass-card" style="padding: 20px; text-align: center;">
                        <i class="fas fa-bolt" style="font-size: 32px; color: #667eea; margin-bottom: 10px; display: block;"></i>
                        <h3 style="margin: 10px 0; font-size: 14px; color: var(--text-primary);">Instant</h3>
                        <p style="color: var(--text-secondary); font-size: 12px; margin: 0;">Immediate account activation</p>
                    </div>
                </div>

                <!-- Requirements -->
                <div class="glass-card" style="padding: 25px; background: rgba(102, 126, 234, 0.08); border: 2px solid rgba(102, 126, 234, 0.3);">
                    <h3 style="margin-top: 0; margin-bottom: 15px; font-size: 16px; color: var(--text-primary);">Requirements</h3>
                    <div style="display: flex; align-items: center; margin-bottom: 12px;">
                        <i class="fas fa-check-circle" style="color: #10b981; margin-right: 12px; font-size: 18px;"></i>
                        <span style="color: var(--text-secondary);">Minimum deposit: <strong style="color: var(--text-primary);">$150 USD</strong></span>
                    </div>
                    <div style="display: flex; align-items: center; margin-bottom: 12px;">
                        <i class="fas fa-check-circle" style="color: #10b981; margin-right: 12px; font-size: 18px;"></i>
                        <span style="color: var(--text-secondary);">Valid bank account or card</span>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <i class="fas fa-check-circle" style="color: #10b981; margin-right: 12px; font-size: 18px;"></i>
                        <span style="color: var(--text-secondary);">Completed Steps 1 & 2</span>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="showDepositMethodDialog()" style="width: 100%; padding: 14px; margin-top: 30px; font-size: 16px; font-weight: 600;" id="proceedDepositBtn">
                    <i class="fas fa-check-circle" style="margin-right: 8px;"></i> Proceed with Deposit
                </button>
            </div>
        </div>

        <!-- DEPOSIT METHOD MODAL -->
        <div id="depositMethodModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 1000; align-items: center; justify-content: center;">
            <div class="glass-card" style="width: 90%; max-width: 500px; padding: 30px; max-height: 90vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <h2 style="margin: 0; font-size: 24px;">Select Deposit Method</h2>
                    <button onclick="closeDepositMethodDialog()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--text-secondary);">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <p style="color: var(--text-secondary); margin-bottom: 20px;">Choose how you'd like to deposit $150 USD</p>

                <!-- User to User Transfer Option (Enabled) -->
                <div class="glass-card" style="padding: 20px; margin-bottom: 15px; cursor: pointer; border: 2px solid rgba(102, 126, 234, 0.3); background: rgba(102, 126, 234, 0.05); transition: all 0.3s ease;" onclick="selectDepositMethod('user_transfer')">
                    <div style="display: flex; align-items: center;">
                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                            <i class="fas fa-users" style="font-size: 24px; color: white;"></i>
                        </div>
                        <div>
                            <h3 style="margin: 0 0 5px 0; font-size: 16px; color: var(--text-primary);">User-to-User Transfer</h3>
                            <p style="margin: 0; font-size: 13px; color: var(--text-secondary);">Send funds from another LEAD account</p>
                        </div>
                    </div>
                </div>

                <!-- Direct Deposit Option (Enabled) -->
                <div class="glass-card" style="padding: 20px; margin-bottom: 15px; cursor: pointer; border: 2px solid rgba(16, 185, 129, 0.3); background: rgba(16, 185, 129, 0.05); transition: all 0.3s ease;" onclick="selectDepositMethod('direct_deposit')">
                    <div style="display: flex; align-items: center;">
                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                            <i class="fas fa-university" style="font-size: 24px; color: white;"></i>
                        </div>
                        <div>
                            <h3 style="margin: 0 0 5px 0; font-size: 16px; color: var(--text-primary);">Direct Deposit (US Banks Only)</h3>
                            <p style="margin: 0; font-size: 13px; color: var(--text-secondary);">Direct deposit to US bank accounts</p>
                        </div>
                    </div>
                </div>

                <!-- Debit Card Option (Disabled) -->
                <div class="glass-card" style="padding: 20px; margin-bottom: 15px; opacity: 0.5; cursor: not-allowed; border: 2px solid rgba(0, 0, 0, 0.1);">
                    <div style="display: flex; align-items: center;">
                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #ccc 0%, #999 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                            <i class="fas fa-credit-card" style="font-size: 24px; color: white;"></i>
                        </div>
                        <div style="flex: 1;">
                            <h3 style="margin: 0 0 5px 0; font-size: 16px; color: var(--text-primary);">Debit Card</h3>
                            <p style="margin: 0; font-size: 13px; color: var(--text-secondary);">Currently unavailable</p>
                        </div>
                        <span style="background: rgba(200, 200, 200, 0.3); color: var(--text-secondary); padding: 6px 12px; border-radius: 6px; font-size: 12px;">Coming Soon</span>
                    </div>
                </div>

                <!-- Crypto Option (Disabled) -->
                <div class="glass-card" style="padding: 20px; margin-bottom: 20px; opacity: 0.5; cursor: not-allowed; border: 2px solid rgba(0, 0, 0, 0.1);">
                    <div style="display: flex; align-items: center;">
                        <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #ccc 0%, #999 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px;">
                            <i class="fas fa-bitcoin" style="font-size: 24px; color: white;"></i>
                        </div>
                        <div style="flex: 1;">
                            <h3 style="margin: 0 0 5px 0; font-size: 16px; color: var(--text-primary);">Cryptocurrency</h3>
                            <p style="margin: 0; font-size: 13px; color: var(--text-secondary);">Currently unavailable</p>
                        </div>
                        <span style="background: rgba(200, 200, 200, 0.3); color: var(--text-secondary); padding: 6px 12px; border-radius: 6px; font-size: 12px;">Coming Soon</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- DIRECT DEPOSIT MODAL -->
        <div id="directDepositModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 1000; align-items: center; justify-content: center; overflow-y: auto; padding: 20px;">
            <div class="glass-card" style="width: 100%; max-width: 520px; padding: 0; max-height: 90vh; overflow-y: auto; margin: 20px 0;">
                <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%); padding: 20px; border-bottom: 1px solid rgba(16, 185, 129, 0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                        <div style="flex: 1;">
                            <h2 style="margin: 0 0 4px 0; font-size: 24px;">Direct Deposit</h2>
                            <p id="directDepositUserName" style="margin: 0; font-size: 14px; color: var(--text-primary); font-weight: 500;">Loading...</p>
                        </div>
                        <button onclick="closeDirectDepositModal()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: var(--text-secondary);">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <p style="margin: 0; color: var(--text-secondary); font-size: 13px;">
                        <i class="fas fa-exclamation-circle" style="margin-right: 6px; color: #f43f5e;"></i>
                        <strong>US Bank Accounts Only:</strong> This is not a wire transfer. Only direct deposits from US bank accounts will be accepted.
                    </p>
                </div>

                <div style="padding: 30px;">
                    <div style="background: rgba(244, 63, 94, 0.08); border: 2px solid rgba(244, 63, 94, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 25px;">
                        <p style="margin: 0; font-size: 13px; color: var(--text-secondary); line-height: 1.6;">
                            <i class="fas fa-info-circle" style="color: #f43f5e; margin-right: 8px;"></i>
                            <strong>Instructions:</strong> Visit any USA bank branch and provide them with the direct deposit number below. They will help you set up direct deposit into your LEAD account.
                        </p>
                    </div>

                    <div style="background: rgba(102, 126, 234, 0.08); border: 2px solid rgba(102, 126, 234, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <p style="margin: 0 0 15px 0; font-size: 12px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;"><i class="fas fa-info-circle" style="margin-right: 6px;"></i> Direct Deposit Information</p>
                        
                        <div style="margin-bottom: 18px;">
                            <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Direct Deposit Number</label>
                            <div style="background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; color: var(--text-primary); font-weight: 600; display: flex; justify-content: space-between; align-items: center; font-family: 'Courier New', monospace;">
                                <span id="directDepositNumberText">Loading...</span>
                                <button onclick="copyToClipboard(document.getElementById('directDepositNumberText').textContent)" style="background: none; border: none; color: #667eea; cursor: pointer; padding: 4px 8px;">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>

                        <div style="margin-bottom: 18px;">
                            <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Account Name</label>
                            <div style="background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; color: var(--text-primary); font-weight: 600; display: flex; justify-content: space-between; align-items: center;">
                                <span id="directDepositAccountNameText">Loading...</span>
                                <button onclick="copyToClipboard(document.getElementById('directDepositAccountNameText').textContent)" style="background: none; border: none; color: #667eea; cursor: pointer; padding: 4px 8px;">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>

                        <div style="margin-bottom: 0;">
                            <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Amount</label>
                            <div style="background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; color: var(--text-primary); font-weight: 600; display: flex; justify-content: space-between; align-items: center;">
                                <span>$150.00 USD</span>
                                <button onclick="copyToClipboard('150.00')" style="background: none; border: none; color: #667eea; cursor: pointer; padding: 4px 8px;">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <button onclick="closeDirectDepositModal()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 15px; font-weight: 600;">
                        <i class="fas fa-check" style="margin-right: 8px;"></i> Got It
                    </button>
                </div>
            </div>
        </div>

        <!-- ACCOUNT DETAILS MODAL -->
        <div id="accountDetailsModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 1000; align-items: center; justify-content: center; overflow-y: auto; padding: 20px;">
            <div class="glass-card" style="width: 100%; max-width: 520px; padding: 0; max-height: 90vh; overflow-y: auto; margin: 20px 0;">
                <div style="background: linear-gradient(135deg, rgba(244, 63, 94, 0.2) 0%, rgba(255, 154, 158, 0.2) 100%); padding: 20px; border-bottom: 1px solid rgba(244, 63, 94, 0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                        <div style="flex: 1;">
                            <h2 style="margin: 0 0 4px 0; font-size: 24px;">User-to-User Deposit</h2>
                            <p id="modalUserName" style="margin: 0; font-size: 14px; color: var(--text-primary); font-weight: 500;">Loading...</p>
                        </div>
                        <button onclick="closeAccountDetailsModal()" style="background: none; border: none; font-size: 20px; cursor: pointer; color: var(--text-secondary);">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <p style="margin: 0; color: var(--text-secondary); font-size: 13px;">
                        <i class="fas fa-exclamation-circle" style="margin-right: 6px; color: #f43f5e;"></i>
                        <strong>Important:</strong> Only user-to-user transfers will be accepted. Any other transfer method will be unsuccessful.
                    </p>
                </div>

                <div style="padding: 30px;">
                    <div style="background: rgba(102, 126, 234, 0.08); border: 2px solid rgba(102, 126, 234, 0.3); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <p style="margin: 0 0 15px 0; font-size: 12px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px;"><i class="fas fa-info-circle" style="margin-right: 6px;"></i> Account Information</p>
                        
                        <div style="margin-bottom: 18px;">
                            <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Bank Name</label>
                            <div style="background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; color: var(--text-primary); font-weight: 600; display: flex; justify-content: space-between; align-items: center;">
                                <span>LEAD BANK</span>
                                <button onclick="copyToClipboard('LEAD BANK')" style="background: none; border: none; color: #667eea; cursor: pointer; padding: 4px 8px;">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>

                        <div style="margin-bottom: 18px;">
                            <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Account Holder Name</label>
                            <div id="accountHolderNameDisplay" style="background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; color: var(--text-primary); font-weight: 600; display: flex; justify-content: space-between; align-items: center;">
                                <span id="accountHolderNameText">Loading...</span>
                                <button onclick="copyToClipboard(document.getElementById('accountHolderNameText').textContent)" style="background: none; border: none; color: #667eea; cursor: pointer; padding: 4px 8px;">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>

                        <div style="margin-bottom: 18px;">
                            <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Account Number</label>
                            <div style="background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; color: var(--text-primary); font-weight: 600; display: flex; justify-content: space-between; align-items: center; font-family: 'Courier New', monospace;">
                                <span id="accountNumberText">CC-9847562841005</span>
                                <button onclick="copyToClipboard(document.getElementById('accountNumberText').textContent)" style="background: none; border: none; color: #667eea; cursor: pointer; padding: 4px 8px;">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>

                        <div style="margin-bottom: 0;">
                            <label style="display: block; font-size: 12px; color: var(--text-secondary); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px;">Amount</label>
                            <div style="background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; color: var(--text-primary); font-weight: 600; display: flex; justify-content: space-between; align-items: center;">
                                <span>$150.00 USD</span>
                                <button onclick="copyToClipboard('150.00')" style="background: none; border: none; color: #667eea; cursor: pointer; padding: 4px 8px;">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div style="background: rgba(16, 185, 129, 0.08); border: 2px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 15px; margin-bottom: 25px;">
                        <p style="margin: 0; font-size: 13px; color: var(--text-secondary); line-height: 1.6;">
                            <i class="fas fa-users" style="color: #10b981; margin-right: 8px;"></i>
                            <strong>Transfer From:</strong> Use the "Send Money" button in LEAD from another account to send the deposit
                        </p>
                    </div>

                    <button onclick="closeAccountDetailsModal()" style="width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 15px; font-weight: 600;">
                        <i class="fas fa-check" style="margin-right: 8px;"></i> Got It
                    </button>
                </div>
            </div>
        </div>

        <div id="billsPage" class="page" style="display: none;">
            <div class="header">
                <div onclick="navigateTo('dashboard')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </div>
            </div>
            <div class="content">
                <h2 style="margin-bottom: 30px;">Pay Bills</h2>
                <div id="billsContainer" style="display: flex; flex-direction: column; gap: 15px;"></div>
            </div>
        </div>

        <div id="addCardPage" class="page">
            <div class="header">
                <div onclick="navigateTo('cards')" style="cursor: pointer;">
                    <i class="fas fa-arrow-left"></i>
                </div>
                <div class="logo">LEAD</div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </div>
            </div>

            <div class="content">
                <h2 style="margin-bottom: 30px;">Add New Card</h2>
                <div id="addCardAlert" class="alert"></div>
                <form id="addCardForm" style="display: flex; flex-direction: column; gap: 15px;">
                    <div class="input-group">
                        <label for="cardType">Card Type</label>
                        <select id="cardType" required style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                            <option value="">Select Type</option>
                            <option value="debit">Debit Card</option>
                            <option value="credit">Credit Card</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="cardBrand">Card Brand</label>
                        <select id="cardBrand" required style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                            <option value="">Select Brand</option>
                            <option value="Visa">Visa</option>
                            <option value="Mastercard">Mastercard</option>
                            <option value="American Express">American Express</option>
                            <option value="Discover">Discover</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="cardName">Cardholder Name</label>
                        <input type="text" id="cardName" required placeholder="Name on card" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div class="input-group">
                        <label for="cardNumber">Card Number</label>
                        <input type="text" id="cardNumber" required placeholder="•••• •••• •••• ••••" maxlength="19" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="input-group">
                            <label for="cardExpiry">Expiry Date</label>
                            <input type="text" id="cardExpiry" required placeholder="MM/YY" maxlength="5" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                        </div>
                        <div class="input-group">
                            <label for="cardCVC">CVC</label>
                            <input type="text" id="cardCVC" required placeholder="•••" maxlength="3" style="padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background: #ffffff; color: var(--text-primary);">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">Add Card</button>
                </form>
            </div>
        </div>

        <div id="transactionHistoryModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Transaction History</h2>
                    <span class="modal-close" onclick="closeModal('transactionHistoryModal')">&times;</span>
                </div>
                <div id="transactionHistoryContent" style="max-height: 60vh; overflow-y: auto;">
                    <div class="glass-card" style="text-align: center; padding: 40px;">
                        <i class="fas fa-history" style="font-size: 48px; color: var(--text-secondary); margin-bottom: 20px;"></i>
                        <p style="color: var(--text-secondary);">Your transaction history will appear here. Complete some transactions to see them listed.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, onAuthStateChanged, signOut, updatePassword } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, addDoc, query, where, getDocs, serverTimestamp, orderBy, writeBatch } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAjy5sgZPMFsklKkSOMyC1HCvQ4-qNKP-M",
            authDomain: "fir-bank-c659f.firebaseapp.com",
            projectId: "fir-bank-c659f",
            storageBucket: "fir-bank-c659f.firebasestorage.app",
            messagingSenderId: "847611883266",
            appId: "1:847611883266:web:651ecee5dfea8e0f1cdc1b",
            measurementId: "G-QK7R83FC51"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        window.auth = auth;
        window.db = db;
        window.storage = storage;

        let isSignUp = false;
        let currentUser = null;
        let userPIN = '1234';
        let currentTransactionData = null;
        let currentCryptoData = null;
        let allTransactions = [];
        let selectedTransactionIndex = -1;
        let selectedCrypto = null;
        let cryptoInputMode = 'crypto';
        let creditScoreChartInstance = null;
        let notifications = [];
        let unreadNotificationCount = 0;

        async function addNotification(type, title, description, amount, icon, color) {
            try {
                const notification = {
                    type,
                    title,
                    description,
                    amount,
                    icon,
                    color,
                    timestamp: serverTimestamp(),
                    read: false
                };
                await addDoc(collection(db, 'users', currentUser.uid, 'notifications'), notification);
                loadNotificationsFromFirebase();
            } catch (e) {
                console.error('Error adding notification:', e);
            }
        }

        async function loadNotificationsFromFirebase() {
            try {
                const q = query(collection(db, 'users', currentUser.uid, 'notifications'), orderBy('timestamp', 'desc'));
                const snapshot = await getDocs(q);
                notifications = snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data(),
                    timestamp: doc.data().timestamp?.toDate ? doc.data().timestamp.toDate() : new Date(doc.data().timestamp)
                }));
                unreadNotificationCount = notifications.filter(n => !n.read).length;
                updateNotificationBadge();
            } catch (e) {
                console.error('Error loading notifications from Firebase:', e);
            }
        }

        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                badge.textContent = unreadNotificationCount;
                badge.style.display = unreadNotificationCount > 0 ? 'flex' : 'none';
            }
        }

        function displayNotifications() {
            const container = document.getElementById('notificationsContent');
            if (!container) return;

            if (notifications.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">No notifications yet</div>';
                return;
            }

            container.innerHTML = notifications.map(notif => `
                <div class="glass-card" style="padding: 15px; display: flex; gap: 15px; align-items: flex-start; cursor: pointer;" onclick="markNotificationAsRead('${notif.id}')">
                    <div style="font-size: 28px; min-width: 40px; text-align: center;">${notif.icon}</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 4px;">${notif.title}</div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 8px;">${notif.description}</div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 12px; color: var(--text-secondary);">${new Date(notif.timestamp).toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' })}</span>
                            <span style="font-weight: 600; color: ${notif.amount.startsWith('-') ? '#ef4444' : '#10b981'}; font-size: 14px;">${notif.amount}</span>
                        </div>
                    </div>
                    ${!notif.read ? '<div style="width: 8px; height: 8px; border-radius: 50%; background: #667eea; margin-top: 8px;"></div>' : ''}
                </div>
            `).join('');

            markAllNotificationsAsRead();
        }

        async function markNotificationAsRead(id) {
            try {
                await updateDoc(doc(db, 'users', currentUser.uid, 'notifications', id), { read: true });
                loadNotificationsFromFirebase();
            } catch (e) {
                console.error('Error marking notification as read:', e);
            }
        }

        async function markAllNotificationsAsRead() {
            try {
                const batch = writeBatch(db);
                notifications.forEach(n => {
                    if (!n.read) {
                        batch.update(doc(db, 'users', currentUser.uid, 'notifications', n.id), { read: true });
                    }
                });
                await batch.commit();
                unreadNotificationCount = 0;
                updateNotificationBadge();
                loadNotificationsFromFirebase();
            } catch (e) {
                console.error('Error marking all as read:', e);
            }
        }

        const countries = {
            "Australia": ["Australian Capital Territory", "New South Wales", "Northern Territory", "Queensland", "South Australia", "Tasmania", "Victoria", "Western Australia"],
            "Brazil": ["Acre", "Alagoas", "Amapá", "Amazonas", "Bahia", "Ceará", "Distrito Federal", "Espírito Santo", "Goiás", "Maranhão", "Mato Grosso", "Mato Grosso do Sul", "Minas Gerais", "Pará", "Paraíba", "Paraná", "Pernambuco", "Piauí", "Rio de Janeiro", "Rio Grande do Norte", "Rio Grande do Sul", "Rondônia", "Roraima", "Santa Catarina", "São Paulo", "Sergipe", "Tocantins"],
            "Canada": ["Alberta", "British Columbia", "Manitoba", "New Brunswick", "Newfoundland and Labrador", "Northwest Territories", "Nova Scotia", "Nunavut", "Ontario", "Prince Edward Island", "Quebec", "Saskatchewan", "Yukon"],
            "China": ["Anhui", "Beijing", "Chongqing", "Fujian", "Gansu", "Guangdong", "Guangxi", "Guizhou", "Hainan", "Hebei", "Heilongjiang", "Henan", "Hubei", "Hunan", "Inner Mongolia", "Jiangsu", "Jiangxi", "Jilin", "Liaoning", "Ningxia", "Qinghai", "Shaanxi", "Shandong", "Shanghai", "Shanxi", "Sichuan", "Tianjin", "Tibet", "Xinjiang", "Yunnan", "Zhejiang"],
            "France": ["Auvergne-Rhône-Alpes", "Bourgogne-Franche-Comté", "Bretagne", "Centre-Val de Loire", "Corsica", "Grand Est", "Guadeloupe", "Guyane", "Hauts-de-France", "Île-de-France", "Martinique", "Mayotte", "Normandy", "Nouvelle-Aquitaine", "Occitanie", "Pays de la Loire", "Provence-Alpes-Côte d'Azur", "Réunion"],
            "Germany": ["Baden-Württemberg", "Bavaria", "Berlin", "Brandenburg", "Bremen", "Hamburg", "Hesse", "Lower Saxony", "Mecklenburg-Vorpommern", "North Rhine-Westphalia", "Rhineland-Palatinate", "Saarland", "Saxony", "Saxony-Anhalt", "Schleswig-Holstein", "Thuringia"],
            "Hong Kong": ["Hong Kong Island", "Kowloon", "New Territories"],
            "India": ["Andaman and Nicobar Islands", "Andhra Pradesh", "Arunachal Pradesh", "Assam", "Bihar", "Chandigarh", "Chhattisgarh", "Dadra and Nagar Haveli", "Daman and Diu", "Delhi", "Goa", "Gujarat", "Haryana", "Himachal Pradesh", "Jammu and Kashmir", "Jharkhand", "Karnataka", "Kerala", "Ladakh", "Lakshadweep", "Madhya Pradesh", "Maharashtra", "Manipur", "Meghalaya", "Mizoram", "Nagaland", "Odisha", "Puducherry", "Punjab", "Rajasthan", "Sikkim", "Tamil Nadu", "Telangana", "Tripura", "Uttar Pradesh", "Uttarakhand", "West Bengal"],
            "Italy": ["Abruzzo", "Basilicata", "Calabria", "Campania", "Emilia-Romagna", "Friuli-Venezia Giulia", "Lazio", "Liguria", "Lombardy", "Marche", "Molise", "Piedmont", "Puglia", "Sardinia", "Sicily", "Tuscany", "Trentino-Alto Adige", "Umbria", "Valle d'Aosta", "Veneto"],
            "Japan": ["Aichi", "Akita", "Aomori", "Chiba", "Ehime", "Fukui", "Fukuoka", "Fukushima", "Gifu", "Gunma", "Hiroshima", "Hokkaido", "Hyogo", "Ibaraki", "Ishikawa", "Iwate", "Kagawa", "Kagoshima", "Kanagawa", "Kochi", "Kumamoto", "Kyoto", "Mie", "Miyagi", "Miyazaki", "Nagano", "Nagasaki", "Nara", "Niigata", "Oita", "Okayama", "Okinawa", "Osaka", "Saga", "Saitama", "Shiga", "Shimane", "Shizuoka", "Tochigi", "Tokushima", "Tokyo", "Tottori", "Toyama", "Wakayama", "Yamagata", "Yamaguchi", "Yamanashi"],
            "Mexico": ["Aguascalientes", "Baja California", "Baja California Sur", "Campeche", "Chiapas", "Chihuahua", "Ciudad de México", "Coahuila", "Colima", "Durango", "Estado de México", "Guanajuato", "Guerrero", "Hidalgo", "Jalisco", "Michoacán", "Morelos", "Nayarit", "Nuevo León", "Oaxaca", "Puebla", "Querétaro", "Quintana Roo", "San Luis Potosí", "Sinaloa", "Sonora", "Tabasco", "Tamaulipas", "Tlaxcala", "Veracruz", "Yucatán", "Zacatecas"],
            "Netherlands": ["Drenthe", "Flevoland", "Friesland", "Gelderland", "Groningen", "Limburg", "North Brabant", "North Holland", "Overijssel", "South Holland", "Utrecht"],
            "New Zealand": ["Auckland", "Bay of Plenty", "Canterbury", "Chatham Islands", "Gisborne", "Hawke's Bay", "Manawatu-Whanganui", "Marlborough", "Nelson", "Northland", "Otago", "Southland", "Taranaki", "Tasman", "Waikato", "Wellington", "West Coast"],
            "Singapore": ["Central", "East", "North", "North-East", "West"],
            "South Korea": ["Busan", "Daegu", "Daejeon", "Gangwon", "Gwangju", "Gyeonggi", "Incheon", "Jeju", "Jeonbuk", "Jeonnam", "Kimhae", "North Chungcheong", "North Gyeongsang", "North Jeolla", "Seoul", "South Chungcheong", "South Gyeongsang", "South Jeolla", "Ulsan"],
            "Spain": ["Andalusia", "Aragon", "Asturias", "Balearic Islands", "Basque Country", "Canary Islands", "Cantabria", "Castile and León", "Castilla-La Mancha", "Catalonia", "Ceuta", "Community of Madrid", "Extremadura", "Galicia", "La Rioja", "Melilla", "Murcia", "Navarre", "Valencian Community"],
            "Sweden": ["Blekinge", "Dalarna", "Dalarnas", "East Gothland", "Gävleborg", "Gotland", "Halland", "Jämtland", "Jönköpings", "Kalmar", "Kronoberg", "Norrbotten", "Skåne", "Södermanland", "Stockholm", "Uppsala", "Värmland", "Västerbotten", "Västermanland", "Västernorrland", "Västra Götaland", "Västyorkland", "Örebro", "Östergötland"],
            "Switzerland": ["Aargau", "Appenzell Ausserrhoden", "Appenzell Innerrhoden", "Basel-Landschaft", "Basel-Stadt", "Bern", "Fribourg", "Geneva", "Glarus", "Graubünden", "Jura", "Lucerne", "Neuchâtel", "Nidwalden", "Obwalden", "Schaffhausen", "Schwyz", "Solothurn", "St. Gallen", "Thurgau", "Ticino", "Uri", "Valais", "Vaud", "Zug", "Zurich"],
            "United Kingdom": ["England", "Northern Ireland", "Scotland", "Wales"],
            "United States": ["Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico", "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming"]
        };

        const cryptoData = {
            'BTC': { name: 'Bitcoin', symbol: 'BTC', icon: '₿', price: 0, change: 0 }
        };

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                if (!user.emailVerified) {
                    navigateTo('auth');
                    return;
                }

                currentUser = user;
                requestNotificationPermission();
                try {
                    const userDocPromise = getDoc(doc(db, 'users', user.uid));
                    const timeoutPromise = new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('Firestore timeout')), 8000)
                    );
                    
                    const userDoc = await Promise.race([userDocPromise, timeoutPromise]);

                    if (!userDoc.exists() || !userDoc.data().profileComplete) {
                        navigateTo('userInfo');
                    } else {
                        navigateTo('dashboard');
                        document.getElementById('bottomNav').style.display = 'flex';
                        loadUserData().catch(err => console.error('Error loading user data:', err));
                    }
                } catch (error) {
                    console.error('Auth state change error:', error);
                    navigateTo('dashboard');
                    document.getElementById('bottomNav').style.display = 'flex';
                    loadUserData().catch(err => console.error('Error loading user data:', err));
                }
            } else {
                currentUser = null;
                navigateTo('auth');
                document.getElementById('bottomNav').style.display = 'none';
            }
        });

        document.getElementById('authToggleLink').addEventListener('click', () => {
            isSignUp = !isSignUp;
            if (isSignUp) {
                document.getElementById('authTitle').textContent = 'Create Account';
                document.getElementById('authSubtitle').textContent = 'Sign up to get started';
                document.getElementById('authButtonText').textContent = 'Sign Up';
                document.getElementById('authToggleText').textContent = 'Already have an account?';
                document.getElementById('authToggleLink').textContent = 'Sign In';
            } else {
                document.getElementById('authTitle').textContent = 'Welcome Back';
                document.getElementById('authSubtitle').textContent = 'Sign in to continue';
                document.getElementById('authButtonText').textContent = 'Sign In';
                document.getElementById('authToggleText').textContent = "Don't have an account?";
                document.getElementById('authToggleLink').textContent = 'Sign Up';
            }
            document.getElementById('verificationNotice').style.display = 'none';
        });

        document.getElementById('authForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;

            showLoading('Please wait...');

            try {
                if (isSignUp) {
                    const signupPromise = (async () => {
                        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                        await sendEmailVerification(userCredential.user);
                        await signOut(auth);
                    })();
                    const timeoutPromise = new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('Request timeout. Please try again.')), 15000)
                    );
                    
                    await Promise.race([signupPromise, timeoutPromise]);
                    
                    hideLoading();
                    document.getElementById('verificationNotice').style.display = 'block';
                    document.getElementById('authForm').reset();
                    
                    isSignUp = false;
                    document.getElementById('authTitle').textContent = 'Welcome Back';
                    document.getElementById('authSubtitle').textContent = 'Sign in to continue';
                    document.getElementById('authButtonText').textContent = 'Sign In';
                    document.getElementById('authToggleText').textContent = "Don't have an account?";
                    document.getElementById('authToggleLink').textContent = 'Sign Up';
                } else {
                    const signinPromise = (async () => {
                        const userCredential = await signInWithEmailAndPassword(auth, email, password);
                        if (!userCredential.user.emailVerified) {
                            await signOut(auth);
                            throw new Error('verify_email');
                        }
                    })();
                    const timeoutPromise = new Promise((_, reject) => 
                        setTimeout(() => reject(new Error('Connection timeout. Please check your internet.')), 15000)
                    );
                    
                    await Promise.race([signinPromise, timeoutPromise]);
                    hideLoading();
                }
            } catch (error) {
                hideLoading();
                let errorMessage = 'An error occurred';
                
                if (error.message === 'verify_email') {
                    errorMessage = 'Please verify your email before signing in.';
                } else if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Email not found. Please sign up first.';
                } else if (error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                    errorMessage = 'Incorrect password. Please try again.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Invalid email address.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Password is too weak. Use at least 6 characters.';
                } else if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Email already registered. Please sign in.';
                } else {
                    errorMessage = error.message;
                }
                
                showAlert(errorMessage, 'error', 'alertBox');
            }
        });

        const countrySelect = document.getElementById('country');
        Object.keys(countries).forEach(country => {
            const option = document.createElement('option');
            option.value = country;
            option.textContent = country;
            countrySelect.appendChild(option);
        });

        countrySelect.addEventListener('change', (e) => {
            const stateSelect = document.getElementById('state');
            stateSelect.innerHTML = '<option value="">Select State</option>';
            
            if (e.target.value && countries[e.target.value]) {
                countries[e.target.value].forEach(state => {
                    const option = document.createElement('option');
                    option.value = state;
                    option.textContent = state;
                    stateSelect.appendChild(option);
                });
            }
        });

        document.getElementById('profileEditForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const updatedData = {
                firstName: document.getElementById('editFirstName').value,
                surname: document.getElementById('editSurname').value,
                phoneNumber: document.getElementById('editPhoneNumber').value,
                age: document.getElementById('editAge').value,
                country: document.getElementById('editCountry').value,
                state: document.getElementById('editState').value,
                streetAddress: document.getElementById('editStreetAddress').value
            };

            showLoading('Updating profile...');

            try {
                await updateDoc(doc(db, 'users', currentUser.uid), updatedData);
                hideLoading();
                showAlert('Profile updated successfully!', 'success', 'profileEditAlert');
                setTimeout(() => {
                    loadUserData();
                    navigateTo('profile');
                }, 1000);
            } catch (error) {
                hideLoading();
                showAlert('Error updating profile: ' + error.message, 'error', 'profileEditAlert');
            }
        });

        function generateAccountNumber() {
            return Math.floor(Math.random() * 9000000000) + 1000000000;
        }

        document.getElementById('userInfoForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const userData = {
                firstName: document.getElementById('firstName').value,
                surname: document.getElementById('surname').value,
                phoneNumber: document.getElementById('phoneNumber').value,
                age: document.getElementById('age').value,
                country: document.getElementById('country').value,
                state: document.getElementById('state').value,
                streetAddress: document.getElementById('streetAddress').value,
                profileComplete: true,
                accountNumber: generateAccountNumber(),
                checkingBalance: 0,
                savingsBalance: 0,
                cryptoHoldings: { BTC: 0 },
                createdAt: serverTimestamp()
            };

            showLoading('Setting up your account...');

            try {
                await setDoc(doc(db, 'users', currentUser.uid), userData);
                hideLoading();
                navigateTo('pinSetup');
            } catch (error) {
                hideLoading();
                showAlert(error.message, 'error', 'userInfoAlert');
            }
        });

        async function loadUserData() {
            try {
                const userDocPromise = getDoc(doc(db, 'users', currentUser.uid));
                const timeoutPromise = new Promise((_, reject) => 
                    setTimeout(() => reject(new Error('Firestore timeout')), 8000)
                );
                const userDoc = await Promise.race([userDocPromise, timeoutPromise]);
                let userData = userDoc.data() || {};
                
                loadNotificationsFromFirebase().catch(err => console.error('Notifications error:', err));
                loadThemeFromFirebase().catch(err => console.error('Theme error:', err));

                // Load PIN from Firebase
                if (userData.userPin) {
                    userPIN = userData.userPin;
                }

                // Generate account number for old users who don't have one
                if (!userData.accountNumber) {
                    const accountNumber = generateAccountNumber();
                    await updateDoc(doc(db, 'users', currentUser.uid), { accountNumber });
                    userData.accountNumber = accountNumber;
                }

                function updateGreeting() {
                    const hour = new Date().getHours();
                    let greeting = 'Good evening';
                    let emoji = '🌙';
                    if (hour < 12) {
                        greeting = 'Good morning';
                        emoji = '🌅';
                    } else if (hour < 18) {
                        greeting = 'Good afternoon';
                        emoji = '☀️';
                    }

                    const now = new Date();
                    const dateStr = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                    
                    document.getElementById('greeting').innerHTML = `
                        <div class="greeting-content">
                            <div class="greeting-text">
                                <div class="greeting-message">${greeting}, ${userData.firstName}!</div>
                                <div class="greeting-date-time">
                                    <div class="greeting-date">
                                        <i class="fas fa-calendar-alt"></i>
                                        <span>${dateStr}</span>
                                    </div>
                                    <div class="greeting-time">
                                        <i class="fas fa-clock"></i>
                                        <span>${timeStr}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                updateGreeting();
                setInterval(updateGreeting, 1000);

                const checking = userData.checkingBalance || 0;
                const savings = userData.savingsBalance || 0;
                const total = checking + savings;

                document.getElementById('mainBalance').textContent = `$${total.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                document.getElementById('checkingBalance').textContent = `$${checking.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                document.getElementById('savingsBalance').textContent = `$${savings.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;

                // Display account number
                if (userData.accountNumber) {
                    const accountNum = userData.accountNumber.toString();
                    const lastFour = accountNum.slice(-4);
                    const displayNum = '••••••' + lastFour;
                    document.getElementById('accountNumberDisplay').textContent = displayNum;
                    window.fullAccountNumber = userData.accountNumber.toString();
                }

                // Load crypto holdings
                displayCryptoHoldings();

                document.getElementById('profileContent').innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <h3 style="margin-bottom: 15px;">Account Details</h3>
                        <div class="summary-row">
                            <span>Account Number</span>
                            <span style="font-family: monospace; font-weight: 600; color: #667eea; letter-spacing: 2px;">${userData.accountNumber}</span>
                        </div>
                        <h3 style="margin-bottom: 15px; margin-top: 25px;">Personal Information</h3>
                        <div class="summary-row">
                            <span>Name</span>
                            <span>${userData.firstName} ${userData.surname}</span>
                        </div>
                        <div class="summary-row">
                            <span>Email</span>
                            <span>${currentUser.email}</span>
                        </div>
                        <div class="summary-row">
                            <span>Phone</span>
                            <span>${userData.phoneNumber}</span>
                        </div>
                        <div class="summary-row">
                            <span>Age</span>
                            <span>${userData.age}</span>
                        </div>
                        <div class="summary-row">
                            <span>Location</span>
                            <span>${userData.state}, ${userData.country}</span>
                        </div>
                        <div class="summary-row">
                            <span>Address</span>
                            <span>${userData.streetAddress}</span>
                        </div>
                    </div>
                `;

                if (userData.profilePicture) {
                    document.getElementById('profilePictureDisplay').src = userData.profilePicture;
                    document.getElementById('sidebarProfilePicture').src = userData.profilePicture;
                }

                // Populate edit form
                document.getElementById('editFirstName').value = userData.firstName || '';
                document.getElementById('editSurname').value = userData.surname || '';
                document.getElementById('editPhoneNumber').value = userData.phoneNumber || '';
                document.getElementById('editAge').value = userData.age || '';
                document.getElementById('editCountry').value = userData.country || '';
                document.getElementById('editState').value = userData.state || '';
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        window.loadLoansPage = function() {
            const loans = [
                { name: 'Personal Loan', rate: '8.5%', minAmount: '$1,000', maxAmount: '$100,000' },
                { name: 'Home Loan', rate: '5.2%', minAmount: '$50,000', maxAmount: '$500,000' },
                { name: 'Auto Loan', rate: '6.8%', minAmount: '$10,000', maxAmount: '$150,000' },
                { name: 'Education Loan', rate: '4.5%', minAmount: '$5,000', maxAmount: '$200,000' },
                { name: 'Business Loan', rate: '9.2%', minAmount: '$10,000', maxAmount: '$1,000,000' }
            ];
            
            const loansContainer = document.getElementById('loansContainer');
            loansContainer.innerHTML = loans.map(loan => `
                <div class="glass-card" style="padding: 20px; cursor: not-allowed; opacity: 0.7;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div>
                            <h3 style="margin: 0; font-size: 18px;">${loan.name}</h3>
                            <p style="margin: 5px 0 0 0; color: var(--text-secondary); font-size: 14px;">Interest Rate: <strong>${loan.rate}</strong></p>
                        </div>
                        <div style="text-align: right;">
                            <p style="margin: 0; font-size: 12px; color: var(--text-secondary);">Range</p>
                            <p style="margin: 5px 0 0 0; font-size: 14px; font-weight: 600;">${loan.minAmount} - ${loan.maxAmount}</p>
                        </div>
                    </div>
                    <button class="btn btn-primary" disabled style="width: 100%; cursor: not-allowed; opacity: 0.6;">
                        Loan Not Available Now
                    </button>
                </div>
            `).join('');
        };

        window.countries = ['United States', 'United Kingdom', 'Canada', 'Australia', 'Germany', 'France', 'Japan', 'China', 'India', 'Brazil', 'Mexico', 'Spain', 'Italy', 'Netherlands', 'Switzerland', 'Singapore', 'South Korea', 'Hong Kong', 'New Zealand', 'Sweden'];

        window.toggleCountryDropdown = function() {
            const dropdown = document.getElementById('wireCountryDropdown');
            if (!dropdown) return;
            
            if (dropdown.style.display === 'none' || dropdown.style.display === '') {
                dropdown.style.display = 'block';
                dropdown.innerHTML = window.countries.map(country => `
                    <div style="padding: 12px 15px; cursor: pointer; color: #1e293b; border-bottom: 1px solid #f1f5f9; transition: background-color 0.2s;" 
                         onmouseover="this.style.backgroundColor='#f0f4f8';" 
                         onmouseout="this.style.backgroundColor='transparent';"
                         onclick="selectCountry('${country}')">
                        ${country}
                    </div>
                `).join('');
            } else {
                dropdown.style.display = 'none';
            }
        };

        window.selectCountry = function(country) {
            document.getElementById('wireCountry').value = country;
            document.getElementById('wireCountryDropdown').style.display = 'none';
        };

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('wireCountryDropdown');
            const countryInput = document.getElementById('wireCountry');
            if (dropdown && countryInput && !countryInput.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });

        window.loadBillsPage = function() {
            const bills = [
                { name: 'Electricity Bill', icon: '⚡', type: 'utilities' },
                { name: 'Water Bill', icon: '💧', type: 'utilities' },
                { name: 'Internet Bill', icon: '📡', type: 'utilities' },
                { name: 'Mobile Recharge', icon: '📱', type: 'mobile' },
                { name: 'Insurance Premium', icon: '🛡️', type: 'insurance' },
                { name: 'Rent Payment', icon: '🏠', type: 'rent' },
                { name: 'Credit Card Bill', icon: '💳', type: 'credit' },
                { name: 'Loan EMI', icon: '📊', type: 'loan' }
            ];
            
            const billsContainer = document.getElementById('billsContainer');
            billsContainer.innerHTML = bills.map(bill => `
                <div class="glass-card" style="padding: 20px; cursor: pointer; transition: all 0.3s;" onclick="openTransferModal('bill')">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="font-size: 32px;">${bill.icon}</div>
                        <div style="flex: 1;">
                            <h3 style="margin: 0; font-size: 16px;">${bill.name}</h3>
                            <p style="margin: 5px 0 0 0; color: var(--text-secondary); font-size: 13px;">Click to pay</p>
                        </div>
                        <i class="fas fa-chevron-right" style="color: var(--text-secondary);"></i>
                    </div>
                </div>
            `).join('');
        };

        window.navigateTo = function(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            const pageEl = document.getElementById(page + 'Page');
            if (pageEl) pageEl.classList.add('active');

            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            if (page === 'dashboard' || page === 'crypto' || page === 'profile') {
                event?.target?.closest('.nav-item')?.classList.add('active');
            }

            if (page === 'crypto') {
                loadCryptoData();
            }

            if (page === 'creditScore') {
                setTimeout(() => renderCreditScoreChart(), 100);
            }

            if (page === 'cards') {
                loadCardsPage();
            }

            if (page === 'loans') {
                loadLoansPage();
            }

            if (page === 'bills') {
                loadBillsPage();
            }

            if (page === 'profileEdit') {
                loadProfileEditCountries();
            }

            if (page === 'notifications') {
                loadNotificationsFromFirebase().then(() => displayNotifications());
            }

            if (page === 'profile') {
                loadUserData();
                document.getElementById('profilePictureSaveButton').style.display = 'none';
            }

            if (page === 'pinSetup') {
                document.getElementById('pinSetupFirstContainer').querySelectorAll('.pin-digit').forEach(input => input.value = '');
                document.getElementById('pinSetupSecondContainer').querySelectorAll('.pin-digit').forEach(input => input.value = '');
                createDialPadForSetup();
            }

            if (page === 'resetPinModal') {
                document.getElementById('resetPinFirstContainer').querySelectorAll('.pin-digit').forEach(input => input.value = '');
                document.getElementById('resetPinSecondContainer').querySelectorAll('.pin-digit').forEach(input => input.value = '');
                createDialPadForReset();
            }

            if (page === 'credcryptTransfer') {
                setTimeout(() => loadCredcryptTransferBalance(), 50);
            }

            updateThemeIcons();
        };

        let tempProfilePictureData = null;

        window.previewProfilePicture = function(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                const imageData = e.target.result;
                tempProfilePictureData = imageData;
                document.getElementById('profilePictureDisplay').src = imageData;
                document.getElementById('profilePictureSaveButton').style.display = 'block';
                showAlert('Preview updated. Click Save Picture to confirm.', 'info');
            };
            reader.readAsDataURL(file);
        };

        window.saveProfilePicture = async function() {
            if (!tempProfilePictureData) {
                showAlert('No picture selected', 'error');
                return;
            }

            showLoading('Saving picture...');
            try {
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    profilePicture: tempProfilePictureData
                });
                hideLoading();
                document.getElementById('profilePictureSaveButton').style.display = 'none';
                tempProfilePictureData = null;
                showAlert('Profile picture saved to your account!', 'success');
            } catch (error) {
                hideLoading();
                showAlert('Error saving picture: ' + error.message, 'error');
            }
        };

        window.loadProfileEditCountries = function() {
            const countrySelect = document.getElementById('editCountry');
            if (countrySelect.querySelectorAll('option').length <= 1) {
                Object.keys(countries).forEach(country => {
                    const option = document.createElement('option');
                    option.value = country;
                    option.textContent = country;
                    countrySelect.appendChild(option);
                });

                countrySelect.addEventListener('change', (e) => {
                    const stateSelect = document.getElementById('editState');
                    stateSelect.innerHTML = '<option value="">Select State</option>';
                    
                    if (e.target.value && countries[e.target.value]) {
                        countries[e.target.value].forEach(state => {
                            const option = document.createElement('option');
                            option.value = state;
                            option.textContent = state;
                            stateSelect.appendChild(option);
                        });
                    }
                });
            }
        };

        window.toggleSidebar = function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        };

        window.toggleTheme = async function() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            if (currentUser) {
                try {
                    await updateDoc(doc(db, 'users', currentUser.uid), { theme: newTheme });
                } catch (e) {
                    console.error('Error saving theme:', e);
                }
            }
            updateThemeIcons();
        };

        function updateThemeIcons() {
            const theme = document.documentElement.getAttribute('data-theme');
            const icon = theme === 'dark' ? 'fa-sun' : 'fa-moon';
            document.querySelectorAll('[id^="themeIcon"]').forEach(el => {
                el.className = `fas ${icon}`;
            });
        }

        async function loadThemeFromFirebase() {
            if (currentUser) {
                try {
                    const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                    const theme = userDoc.data()?.theme || 'light';
                    document.documentElement.setAttribute('data-theme', theme);
                    updateThemeIcons();
                } catch (e) {
                    console.error('Error loading theme:', e);
                    document.documentElement.setAttribute('data-theme', 'light');
                    updateThemeIcons();
                }
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                updateThemeIcons();
            }
        }

        loadThemeFromFirebase();

        window.pinSetupAutoTab = function(input, containerId) {
            if (input.value.length === 1) {
                const container = document.getElementById(containerId);
                const inputs = container.querySelectorAll('.pin-digit');
                const index = Array.from(inputs).indexOf(input);
                if (index < inputs.length - 1) {
                    inputs[index + 1].focus();
                }
            }
        };

        window.completePinSetup = async function() {
            try {
                const firstContainer = document.getElementById('pinSetupFirstContainer');
                const secondContainer = document.getElementById('pinSetupSecondContainer');
                
                const firstPinInputs = firstContainer.querySelectorAll('.pin-digit');
                const secondPinInputs = secondContainer.querySelectorAll('.pin-digit');
                
                const firstPin = Array.from(firstPinInputs).map(input => input.value).join('');
                const secondPin = Array.from(secondPinInputs).map(input => input.value).join('');
                
                if (firstPin.length !== 4 || secondPin.length !== 4) {
                    showAlert('Please enter a 4-digit PIN', 'error', 'pinSetupAlert');
                    return;
                }
                
                if (firstPin !== secondPin) {
                    showAlert('PINs do not match', 'error', 'pinSetupAlert');
                    firstContainer.querySelectorAll('.pin-digit').forEach(input => input.value = '');
                    secondContainer.querySelectorAll('.pin-digit').forEach(input => input.value = '');
                    return;
                }
                
                userPIN = firstPin;
                showLoading('Finalizing your account...');
                try {
                    // Save PIN to Firebase
                    await updateDoc(doc(db, 'users', currentUser.uid), { 
                        userPin: firstPin 
                    });
                    await loadUserData();
                    hideLoading();
                    navigateTo('dashboard');
                    document.getElementById('bottomNav').style.display = 'flex';
                } catch (error) {
                    hideLoading();
                    showAlert('Error completing setup: ' + error.message, 'error', 'pinSetupAlert');
                }
            } catch (error) {
                showAlert('Error: ' + error.message, 'error', 'pinSetupAlert');
            }
        };

        window.openResetPinModal = function() {
            navigateTo('resetPinModal');
        };

        window.openResetPasswordModal = function() {
            navigateTo('resetPasswordModal');
        };

        window.saveNewPin = async function() {
            const firstContainer = document.getElementById('resetPinFirstContainer');
            const secondContainer = document.getElementById('resetPinSecondContainer');
            
            const firstPinInputs = firstContainer.querySelectorAll('.pin-digit');
            const secondPinInputs = secondContainer.querySelectorAll('.pin-digit');
            
            const firstPin = Array.from(firstPinInputs).map(input => input.value).join('');
            const secondPin = Array.from(secondPinInputs).map(input => input.value).join('');
            
            if (firstPin.length !== 4 || secondPin.length !== 4) {
                showAlert('Please enter a 4-digit PIN', 'error', 'resetPinAlert');
                return;
            }
            
            if (firstPin !== secondPin) {
                showAlert('PINs do not match', 'error', 'resetPinAlert');
                firstContainer.querySelectorAll('.pin-digit').forEach(input => input.value = '');
                secondContainer.querySelectorAll('.pin-digit').forEach(input => input.value = '');
                return;
            }
            
            userPIN = firstPin;
            showLoading('Updating PIN...');
            try {
                await updateDoc(doc(db, 'users', currentUser.uid), { 
                    userPin: firstPin 
                });
                hideLoading();
                showAlert('PIN updated successfully!', 'success', 'resetPinAlert');
                setTimeout(() => navigateTo('security'), 1500);
            } catch (error) {
                hideLoading();
                showAlert('Error updating PIN: ' + error.message, 'error', 'resetPinAlert');
            }
        };

        window.saveNewPassword = function() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!newPassword || newPassword.length < 6) {
                showAlert('Password must be at least 6 characters', 'error', 'resetPasswordAlert');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showAlert('Passwords do not match', 'error', 'resetPasswordAlert');
                return;
            }
            
            showLoading('Updating password...');
            updatePassword(currentUser, newPassword).then(() => {
                hideLoading();
                showAlert('Password updated successfully!', 'success', 'resetPasswordAlert');
                setTimeout(() => navigateTo('security'), 1500);
            }).catch((error) => {
                hideLoading();
                showAlert('Error: ' + error.message, 'error', 'resetPasswordAlert');
            });
        };

        window.copyAccountNumber = async function() {
            if (window.fullAccountNumber) {
                try {
                    await navigator.clipboard.writeText(window.fullAccountNumber);
                    showAlert('Account number copied!', 'success');
                } catch (error) {
                    console.error('Failed to copy:', error);
                    showAlert('Failed to copy account number', 'error');
                }
            }
        };

        window.logout = async function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            if (sidebar) sidebar.classList.remove('active');
            if (overlay) overlay.classList.remove('active');
            await signOut(auth);
            navigateTo('auth');
        };

        window.showAlert = function(message, type = 'info', targetId = null) {
            try {
                let alertBoxes = [];
                if (targetId) {
                    const el = document.getElementById(targetId);
                    if (el) alertBoxes = [el];
                } else {
                    alertBoxes = Array.from(document.querySelectorAll('.alert'));
                }
                
                alertBoxes.forEach(alertBox => {
                    if (alertBox) {
                        alertBox.className = `alert alert-${type} show`;
                        alertBox.textContent = message;
                        setTimeout(() => {
                            if (alertBox) alertBox.classList.remove('show');
                        }, 5000);
                    }
                });
            } catch (error) {
                console.error('Error showing alert:', error);
            }
        };

        function showLoading(text = 'Please wait...') {
            try {
                const loadingScreen = document.getElementById('loadingScreen');
                const loadingText = document.querySelector('.loading-text');
                if (loadingScreen) loadingScreen.classList.add('active');
                if (loadingText) loadingText.textContent = text;
            } catch (error) {
                console.error('Error showing loading:', error);
            }
        }

        function hideLoading() {
            try {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) loadingScreen.classList.remove('active');
            } catch (error) {
                console.error('Error hiding loading:', error);
            }
        }

        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().catch(err => console.log('Notification permission request:', err));
            }
        }

        window.showTransactionNotification = function(transactionData) {
            try {
                const banner = document.getElementById('notificationBanner');
                const text = document.getElementById('notificationText');
                
                let message = 'Transaction successful!';
                
                if (transactionData && typeof transactionData === 'object') {
                    const type = transactionData.type;
                    const amount = transactionData.amount;
                    const formattedAmount = amount ? `$${amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}` : '';
                    
                    if (type === 'topup') {
                        const account = transactionData.toAccount || 'checking';
                        message = `You've added ${formattedAmount} to your ${account} account`;
                    } else if (type === 'withdraw') {
                        const account = transactionData.fromAccount || 'checking';
                        message = `You've withdrawn ${formattedAmount} from your ${account} account`;
                    } else if (type === 'internalTransfer') {
                        const from = transactionData.fromAccount || 'checking';
                        const to = transactionData.toAccount || 'savings';
                        message = `You've moved ${formattedAmount} from ${from} to ${to}`;
                    } else if (type === 'credcryptTransfer') {
                        const recipient = transactionData.recipientName || 'recipient';
                        message = `You've sent ${formattedAmount} to ${recipient}`;
                    } else if (type === 'bank' || type === 'transfer') {
                        const recipient = transactionData.recipientName || 'recipient';
                        message = `You've sent ${formattedAmount} to ${recipient}`;
                    } else if (type === 'wire') {
                        const recipient = transactionData.recipientName || 'recipient';
                        message = `You've wired ${formattedAmount} to ${recipient}`;
                    } else if (type === 'crypto') {
                        const action = transactionData.action === 'buy' ? 'bought' : 'sold';
                        const crypto = transactionData.crypto || 'crypto';
                        message = `You've ${action} ${transactionData.cryptoAmount || ''} ${crypto}`;
                    } else if (['bikes', 'bill', 'mobile', 'donation', 'insurance', 'investment', 'savings'].includes(type)) {
                        const typeNames = { bikes: 'Bikes', bill: 'Bill', mobile: 'Mobile', donation: 'Donation', insurance: 'Insurance', investment: 'Investment', savings: 'Savings' };
                        const typeName = typeNames[type] || type;
                        message = `You've paid ${formattedAmount} for ${typeName}`;
                    }
                }
                
                if (text) text.textContent = message;
                if (banner) {
                    banner.classList.add('show');
                    try {
                        const audio = document.getElementById('notificationSound');
                        if (audio) audio.play().catch(() => {});
                    } catch (e) {}
                    setTimeout(() => {
                        if (banner) banner.classList.remove('show');
                    }, 5000);
                }
            } catch (error) {
                console.error('Error showing notification:', error);
            }
        };

        window.testNotification = function() {
            showTransactionNotification({
                type: 'topup',
                amount: 50,
                toAccount: 'checking'
            });
        };

        async function displayAvailableBalance(fromAccount) {
            const balanceDisplay = document.getElementById('availableBalanceDisplay');
            const balanceAmount = document.getElementById('availableBalanceAmount');
            
            try {
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                const userDataBalance = userDoc.data();
                const balance = fromAccount === 'savings' ? userDataBalance.savingsBalance : userDataBalance.checkingBalance;
                balanceAmount.textContent = `$${balance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                balanceDisplay.style.display = 'block';
            } catch (error) {
                console.error('Error getting balance:', error);
            }
        }

        window.openTransferModal = function(type) {
            currentTransactionData = { type };
            const titles = {
                bank: 'Bank Transfer',
                wire: 'Wire Transfer',
                withdraw: 'Withdraw',
                topup: 'Top Up',
                bikes: 'Bikes Payment',
                bill: 'Bill Payment',
                mobile: 'Mobile Recharge',
                donation: 'Donation',
                insurance: 'Insurance Payment',
                investment: 'Investment',
                savings: 'Savings Plan'
            };

            document.getElementById('transferModalTitle').textContent = titles[type] || 'Payment';

            let fields = '';

            if (type === 'topup') {
                fields = `
                    <div class="input-group">
                        <label>Amount</label>
                        <input type="number" id="transferAmount" step="0.01" required>
                    </div>
                    <div class="input-group">
                        <label>To Account</label>
                        <select id="transferToAccount" required>
                            <option value="checking">Checking</option>
                            <option value="savings">Savings</option>
                        </select>
                    </div>
                `;
            } else if (type === 'withdraw') {
                fields = `
                    <div class="input-group">
                        <label>Amount</label>
                        <input type="number" id="transferAmount" step="0.01" required>
                    </div>
                    <div class="input-group">
                        <label>From Account</label>
                        <select id="transferFromAccount" required>
                            <option value="checking">Checking</option>
                            <option value="savings">Savings</option>
                        </select>
                    </div>
                `;
            } else if (['bikes', 'bill', 'mobile', 'donation', 'insurance', 'investment', 'savings'].includes(type)) {
                fields = `
                    <div class="input-group">
                        <label>${type === 'bikes' ? 'Bike Service' : type === 'bill' ? 'Bill Provider' : type === 'mobile' ? 'Mobile Number' : 'Recipient'}</label>
                        <input type="text" id="recipientName" required placeholder="${type === 'mobile' ? 'Enter mobile number' : 'Enter details'}">
                    </div>
                    <div class="input-group">
                        <label>Reference/Description</label>
                        <input type="text" id="accountNumber" required placeholder="Reference number or description">
                    </div>
                    <div class="input-group">
                        <label>Amount</label>
                        <input type="number" id="transferAmount" step="0.01" required>
                    </div>
                    <div class="input-group">
                        <label>From Account</label>
                        <select id="transferFromAccount" required>
                            <option value="checking">Checking</option>
                            <option value="savings">Savings</option>
                        </select>
                    </div>
                `;
            } else {
                fields = `
                    <div class="input-group">
                        <label>Recipient Name</label>
                        <input type="text" id="recipientName" required>
                    </div>
                    <div class="input-group">
                        <label>Recipient Bank</label>
                        <input type="text" id="recipientBank" required>
                    </div>
                    <div class="input-group">
                        <label>${type === 'wire' ? 'IBAN' : 'Account Number'}</label>
                        <input type="text" id="accountNumber" required>
                    </div>
                    <div class="input-group">
                        <label>Address</label>
                        <textarea id="recipientAddress" required></textarea>
                    </div>
                `;

                if (type === 'wire') {
                    fields += `
                        <div class="input-group">
                            <label>Country</label>
                            <select id="wireCountry" required>
                                <option value="">Select Country</option>
                                <option value="US">United States</option>
                                <option value="UK">United Kingdom</option>
                                <option value="CA">Canada</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="input-group" id="routingGroup" style="display: none;">
                            <label>Routing Number</label>
                            <input type="text" id="routingNumber">
                        </div>
                        <div class="input-group" id="swiftGroup" style="display: none;">
                            <label>SWIFT/BIC</label>
                            <input type="text" id="swiftCode">
                        </div>
                    `;
                }

                fields += `
                    <div class="input-group">
                        <label>Amount</label>
                        <input type="number" id="transferAmount" step="0.01" required>
                    </div>
                    <div class="input-group">
                        <label>From Account</label>
                        <select id="transferFromAccount" required>
                            <option value="checking">Checking</option>
                            <option value="savings">Savings</option>
                        </select>
                    </div>
                `;
            }

            document.getElementById('transferFormFields').innerHTML = fields;
            
            // Show available balance
            setTimeout(async () => {
                const accountSelect = document.getElementById('transferFromAccount');
                if (accountSelect) {
                    displayAvailableBalance(accountSelect.value);
                    accountSelect.addEventListener('change', (e) => displayAvailableBalance(e.target.value));
                } else {
                    document.getElementById('availableBalanceDisplay').style.display = 'none';
                }
            }, 100);

            if (type === 'wire') {
                setTimeout(() => {
                    document.getElementById('wireCountry')?.addEventListener('change', (e) => {
                        const routingGroup = document.getElementById('routingGroup');
                        const swiftGroup = document.getElementById('swiftGroup');
                        if (e.target.value === 'US') {
                            routingGroup.style.display = 'block';
                            swiftGroup.style.display = 'none';
                            document.getElementById('routingNumber').required = true;
                            document.getElementById('swiftCode').required = false;
                        } else if (e.target.value && e.target.value !== 'US') {
                            routingGroup.style.display = 'none';
                            swiftGroup.style.display = 'block';
                            document.getElementById('routingNumber').required = false;
                            document.getElementById('swiftCode').required = true;
                        }
                    });
                }, 100);
            }

            document.getElementById('transferModal').classList.add('active');
        };

        document.getElementById('transferForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const amount = parseFloat(document.getElementById('transferAmount').value);
            const type = currentTransactionData.type;

            const fee = type === 'wire' ? amount * 0.02 : amount * 0.01;
            const total = amount + fee;

            // Get current balance
            const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
            const userData = userDoc.data();
            
            let availableBalance = userData.checkingBalance + userData.savingsBalance;
            if (type === 'topup') {
                // Topup adds money, so no balance check needed
            } else if (type !== 'topup') {
                // All other types require deducting from account
                const fromAccount = document.getElementById('transferFromAccount')?.value || 'checking';
                const accountBalance = fromAccount === 'savings' ? userData.savingsBalance : userData.checkingBalance;
                
                if (total > accountBalance) {
                    showAlert(`Insufficient balance! You have $${accountBalance.toFixed(2)} but need $${total.toFixed(2)}`, 'error', 'transferModalAlert');
                    return;
                }
            }

            currentTransactionData.amount = amount;
            currentTransactionData.fee = fee;
            currentTransactionData.total = total;

            if (type === 'topup') {
                currentTransactionData.toAccount = document.getElementById('transferToAccount').value;
            } else if (type === 'withdraw') {
                currentTransactionData.fromAccount = document.getElementById('transferFromAccount').value;
            } else if (['bikes', 'bill', 'mobile', 'donation', 'insurance', 'investment', 'savings'].includes(type)) {
                currentTransactionData.recipientName = document.getElementById('recipientName').value;
                currentTransactionData.reference = document.getElementById('accountNumber').value;
                currentTransactionData.fromAccount = document.getElementById('transferFromAccount').value;
            } else {
                currentTransactionData.recipientName = document.getElementById('recipientName').value;
                currentTransactionData.recipientBank = document.getElementById('recipientBank').value;
                currentTransactionData.accountNumber = document.getElementById('accountNumber').value;
                currentTransactionData.recipientAddress = document.getElementById('recipientAddress').value;
                currentTransactionData.fromAccount = document.getElementById('transferFromAccount').value;

                if (type === 'wire') {
                    currentTransactionData.country = document.getElementById('wireCountry').value;
                    if (currentTransactionData.country === 'US') {
                        currentTransactionData.routingNumber = document.getElementById('routingNumber').value;
                    } else {
                        currentTransactionData.swiftCode = document.getElementById('swiftCode').value;
                    }
                }
            }

            // VALIDATION: Check balance BEFORE showing confirmation
            const balanceCheckDoc = await getDoc(doc(db, 'users', currentUser.uid));
            const userDataBalance = balanceCheckDoc.data();
            
            let fromBalance = 0;
            if (type === 'topup') {
                // Top-up adds money, no balance check needed
            } else {
                const fromAccount = currentTransactionData.fromAccount || (type === 'withdraw' ? document.getElementById('transferFromAccount')?.value : 'checking');
                fromBalance = fromAccount === 'savings' ? userDataBalance.savingsBalance : userDataBalance.checkingBalance;
                
                if (total > fromBalance) {
                    showAlert(`Insufficient balance! You have $${fromBalance.toFixed(2)} but need $${total.toFixed(2)} for this transaction.`, 'error', 'transferModalAlert');
                    return;
                }
            }

            let summary = `
                <div class="summary-row">
                    <span>Amount</span>
                    <span>$${amount.toFixed(2)}</span>
                </div>
                <div class="summary-row">
                    <span>Fee</span>
                    <span>$${fee.toFixed(2)}</span>
                </div>
                <div class="summary-row">
                    <span>Total</span>
                    <span>$${total.toFixed(2)}</span>
                </div>
            `;

            document.getElementById('confirmationSummary').innerHTML = summary;
            closeModal('transferModal');
            document.getElementById('confirmationModal').classList.add('active');
            setTimeout(() => {
                document.getElementById('pin1').value = '';
                document.getElementById('pin2').value = '';
                document.getElementById('pin3').value = '';
                document.getElementById('pin4').value = '';
                createDialPad();
            }, 100);
        });

        function createDialPadForSetup() {
            const dialPad = document.getElementById('pinSetupDialPad');
            if (!dialPad) return;
            dialPad.innerHTML = '';
            dialPad.style.display = 'grid';
            dialPad.style.gridTemplateColumns = 'repeat(3, 1fr)';
            dialPad.style.gap = '15px';
            
            const buttons = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '', '0', '⌫'];
            buttons.forEach(num => {
                const btn = document.createElement('button');
                btn.type = 'button';
                if (num === '') {
                    btn.style.display = 'none';
                } else {
                    btn.innerHTML = num;
                    btn.style.cssText = `padding: 20px 10px !important; font-size: 22px !important; font-weight: 700 !important; border: 2px solid #667eea !important; border-radius: 10px !important; background: #667eea !important; color: white !important; cursor: pointer !important; display: flex !important; align-items: center !important; justify-content: center !important; height: 55px !important; width: 100% !important;`;
                    btn.onclick = (e) => { e.preventDefault(); if (num === '⌫') deletePinDigit(); else addPinDigit(num); };
                    btn.onmouseover = (e) => { e.target.style.background = '#764ba2 !important'; };
                    btn.onmouseout = (e) => { e.target.style.background = '#667eea !important'; };
                }
                dialPad.appendChild(btn);
            });
        }

        function createDialPadForReset() {
            const dialPad = document.getElementById('resetPinDialPad');
            if (!dialPad) return;
            dialPad.innerHTML = '';
            dialPad.style.display = 'grid';
            dialPad.style.gridTemplateColumns = 'repeat(3, 1fr)';
            dialPad.style.gap = '15px';
            
            const buttons = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '', '0', '⌫'];
            buttons.forEach(num => {
                const btn = document.createElement('button');
                btn.type = 'button';
                if (num === '') {
                    btn.style.display = 'none';
                } else {
                    btn.innerHTML = num;
                    btn.style.cssText = `padding: 20px 10px !important; font-size: 22px !important; font-weight: 700 !important; border: 2px solid #667eea !important; border-radius: 10px !important; background: #667eea !important; color: white !important; cursor: pointer !important; display: flex !important; align-items: center !important; justify-content: center !important; height: 55px !important; width: 100% !important;`;
                    btn.onclick = (e) => { e.preventDefault(); if (num === '⌫') deletePinDigit(); else addPinDigit(num); };
                    btn.onmouseover = (e) => { e.target.style.background = '#764ba2 !important'; };
                    btn.onmouseout = (e) => { e.target.style.background = '#667eea !important'; };
                }
                dialPad.appendChild(btn);
            });
        }

        function createDialPad() {
            const dialPad = document.getElementById('dialPad');
            if (!dialPad) return;
            
            dialPad.innerHTML = '<style>#dialPad button { visibility: visible !important; opacity: 1 !important; display: flex !important; }</style>';
            dialPad.style.display = 'grid';
            dialPad.style.gridTemplateColumns = 'repeat(3, 1fr)';
            dialPad.style.gap = '15px';
            dialPad.style.marginTop = '20px';
            dialPad.style.minHeight = 'auto';
            dialPad.style.width = '100%';
            
            const buttons = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '', '0', '⌫'];
            
            buttons.forEach(num => {
                const btn = document.createElement('button');
                btn.type = 'button';
                
                if (num === '') {
                    btn.style.display = 'none';
                } else {
                    btn.innerHTML = num;
                    btn.style.cssText = `
                        padding: 20px 10px !important;
                        font-size: 22px !important;
                        font-weight: 700 !important;
                        border: 2px solid #667eea !important;
                        border-radius: 10px !important;
                        background: #667eea !important;
                        color: white !important;
                        cursor: pointer !important;
                        display: flex !important;
                        align-items: center !important;
                        justify-content: center !important;
                        height: 55px !important;
                        width: 100% !important;
                        opacity: 1 !important;
                        visibility: visible !important;
                        margin: 0 !important;
                    `;
                    
                    btn.onclick = (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        if (num === '⌫') {
                            deletePinDigit();
                        } else {
                            addPinDigit(num);
                        }
                    };
                    
                    btn.onmouseover = (e) => {
                        e.target.style.background = '#764ba2 !important';
                        e.target.style.boxShadow = '0 4px 12px rgba(102, 126, 234, 0.6) !important';
                        e.target.style.transform = 'scale(1.05)';
                    };
                    
                    btn.onmouseout = (e) => {
                        e.target.style.background = '#667eea !important';
                        e.target.style.boxShadow = 'none';
                        e.target.style.transform = 'scale(1)';
                    };
                }
                
                dialPad.appendChild(btn);
            });
        }

        function addPinDigit(digit) {
            // Get visible PIN inputs from the active modal or page
            let inputs = [];
            const confirmModal = document.getElementById('confirmationModal');
            const topupModal = document.getElementById('topupConfirmPage');
            const pinSetupPage = document.getElementById('pinSetupPage');
            const resetPinPage = document.getElementById('resetPinModalPage');
            const cryptoModal = document.getElementById('cryptoConfirmationModal');
            
            if (confirmModal && confirmModal.classList.contains('active')) {
                inputs = Array.from(confirmModal.querySelectorAll('.pin-digit'));
            } else if (topupModal && topupModal.classList.contains('active')) {
                inputs = Array.from(topupModal.querySelectorAll('.pin-digit'));
            } else if (pinSetupPage && pinSetupPage.classList.contains('active')) {
                inputs = Array.from(pinSetupPage.querySelectorAll('.pin-digit'));
            } else if (resetPinPage && resetPinPage.classList.contains('active')) {
                inputs = Array.from(resetPinPage.querySelectorAll('.pin-digit'));

            } else {
                inputs = Array.from(document.querySelectorAll('.pin-digit'));
            }
            
            for (let input of inputs) {
                if (!input.value) {
                    input.value = digit;
                    return;
                }
            }
        }

        function deletePinDigit() {
            // Get visible PIN inputs from the active modal or page
            let inputs = [];
            const confirmModal = document.getElementById('confirmationModal');
            const topupModal = document.getElementById('topupConfirmPage');
            const pinSetupPage = document.getElementById('pinSetupPage');
            const resetPinPage = document.getElementById('resetPinModalPage');
            const cryptoModal = document.getElementById('cryptoConfirmationModal');
            
            if (confirmModal && confirmModal.classList.contains('active')) {
                inputs = Array.from(confirmModal.querySelectorAll('.pin-digit'));
            } else if (topupModal && topupModal.classList.contains('active')) {
                inputs = Array.from(topupModal.querySelectorAll('.pin-digit'));
            } else if (pinSetupPage && pinSetupPage.classList.contains('active')) {
                inputs = Array.from(pinSetupPage.querySelectorAll('.pin-digit'));
            } else if (resetPinPage && resetPinPage.classList.contains('active')) {
                inputs = Array.from(resetPinPage.querySelectorAll('.pin-digit'));

            } else {
                inputs = Array.from(document.querySelectorAll('.pin-digit'));
            }
            
            for (let i = inputs.length - 1; i >= 0; i--) {
                if (inputs[i].value) {
                    inputs[i].value = '';
                    return;
                }
            }
        }

        window.processPinTransaction = async function() {
            // Get PIN inputs from active modal only
            let pinInputs = [];
            const confirmModal = document.getElementById('confirmationModal');
            const topupModal = document.getElementById('topupConfirmPage');
            
            if (confirmModal && confirmModal.classList.contains('active')) {
                pinInputs = confirmModal.querySelectorAll('.pin-digit');
            } else if (topupModal && topupModal.classList.contains('active')) {
                pinInputs = topupModal.querySelectorAll('.pin-digit');
            } else {
                pinInputs = document.querySelectorAll('.pin-digit');
            }
            
            const pin = Array.from(pinInputs).map(input => input.value).join('');

            if (pin.length !== 4) {
                showAlert('Please enter a 4-digit PIN', 'error');
                return;
            }

            if (pin !== userPIN) {
                showAlert('Incorrect PIN. Please try again.', 'error');
                // Clear PIN fields
                Array.from(document.querySelectorAll('.pin-digit')).forEach(input => input.value = '');
                return;
            }

            closeModal('confirmationModal');
            showLoading('Processing transaction...');

            try {
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                const userDataTx = userDoc.data();

                let newCheckingBalance = userDataTx.checkingBalance;
                let newSavingsBalance = userDataTx.savingsBalance;
                let success = false;
                const type = currentTransactionData.type;
                let pendingTransactionId = null;

                // For withdrawals, always set as pending
                if (type === 'withdraw') {
                    // Generate a unique transaction ID for the pending withdrawal
                    pendingTransactionId = 'WD' + Date.now().toString(36).toUpperCase() + Math.random().toString(36).substring(2, 6).toUpperCase();
                    currentTransactionData.pendingTransactionId = pendingTransactionId;
                    currentTransactionData.isPending = true;
                    
                    // Try to save to API if available (optional)
                    try {
                        const response = await fetch('/api/transactions', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                user_id: currentUser.uid,
                                type: 'withdraw',
                                amount: currentTransactionData.total,
                                recipient_name: currentTransactionData.bankName || 'Card Withdrawal',
                                recipient_account: currentTransactionData.accountNumber || '',
                                recipient_bank: currentTransactionData.bankName || '',
                                description: `Withdrawal from ${currentTransactionData.fromAccount} account`
                            })
                        });
                        if (response.ok) {
                            const result = await response.json();
                            if (result.transaction_id) {
                                pendingTransactionId = result.transaction_id;
                                currentTransactionData.pendingTransactionId = pendingTransactionId;
                            }
                        }
                    } catch (apiError) {
                        console.log('API not available, using local pending transaction');
                    }
                }

                // FINAL BALANCE CHECK BEFORE PROCESSING
                if (type === 'topup') {
                    // Top-up adds money
                    if (currentTransactionData.toAccount === 'checking') {
                        newCheckingBalance += currentTransactionData.amount;
                    } else {
                        newSavingsBalance += currentTransactionData.amount;
                    }
                    success = true;
                } else if (type === 'withdraw') {
                    // Withdrawal
                    if (currentTransactionData.fromAccount === 'checking') {
                        if (newCheckingBalance >= currentTransactionData.total) {
                            newCheckingBalance -= currentTransactionData.total;
                            success = true;
                        }
                    } else {
                        if (newSavingsBalance >= currentTransactionData.total) {
                            newSavingsBalance -= currentTransactionData.total;
                            success = true;
                        }
                    }
                } else if (type === 'internalTransfer') {
                    // Internal transfer between checking and savings - NO FEES
                    const fromAccount = currentTransactionData.fromAccount;
                    const toAccount = currentTransactionData.toAccount;
                    const amount = currentTransactionData.amount;
                    
                    const fromBalance = fromAccount === 'savings' ? newSavingsBalance : newCheckingBalance;
                    
                    if (fromBalance >= amount) {
                        // Deduct from source account
                        if (fromAccount === 'checking') {
                            newCheckingBalance -= amount;
                        } else {
                            newSavingsBalance -= amount;
                        }
                        
                        // Add to destination account
                        if (toAccount === 'checking') {
                            newCheckingBalance += amount;
                        } else {
                            newSavingsBalance += amount;
                        }
                        success = true;
                    }
                } else if (type === 'credcryptTransfer') {
                    // LEAD to LEAD transfer - NO FEES, always to checking
                    const fromBalance = newCheckingBalance;
                    const amount = currentTransactionData.amount || 0;
                    
                    if (fromBalance >= amount) {
                        newCheckingBalance -= amount;
                        // Add transaction to recipient
                        const recipientUid = currentTransactionData.recipientUid;
                        const recipientDoc = await getDoc(doc(db, 'users', recipientUid));
                        const recipientData = recipientDoc.data();
                        const newRecipientChecking = (recipientData.checkingBalance || 0) + amount;
                        
                        await updateDoc(doc(db, 'users', recipientUid), {
                            checkingBalance: newRecipientChecking
                        });
                        
                        // Add transaction to recipient's history
                        await addDoc(collection(db, 'users', recipientUid, 'transactions'), {
                            type: 'credcryptTransfer',
                            recipientName: recipientData.firstName + ' ' + recipientData.surname,
                            senderName: userDataTx.firstName + ' ' + userDataTx.surname,
                            senderAccount: userDataTx.accountNumber,
                            amount: amount,
                            fee: 0,
                            total: amount,
                            toAccount: 'checking',
                            isReceived: true,
                            timestamp: serverTimestamp(),
                            status: 'success'
                        });
                        
                        success = true;
                    }
                } else if (type === 'transfer' || type === 'wire' || type === 'withdraw') {
                    // Bank/Wire transfers and withdrawals
                    const fromAccount = currentTransactionData.fromAccount;
                    const fromBalance = fromAccount === 'savings' ? newSavingsBalance : newCheckingBalance;
                    const total = currentTransactionData.total || 0;
                    
                    if (fromBalance >= total) {
                        if (fromAccount === 'checking') {
                            newCheckingBalance -= total;
                        } else {
                            newSavingsBalance -= total;
                        }
                        success = true;
                    }
                } else if (type === 'crypto') {
                    // Crypto transactions
                    const action = currentTransactionData.action;
                    const fromAccount = currentTransactionData.fromAccount || 'checking';
                    const fromBalance = fromAccount === 'savings' ? newSavingsBalance : newCheckingBalance;
                    const total = currentTransactionData.total || 0;
                    
                    if (action === 'sell') {
                        // Check if they have crypto to sell
                        const holdings = userDataTx.cryptoHoldings || { BTC: 0 };
                        const amountToSell = currentTransactionData.cryptoAmount || 0;
                        
                        if (holdings[currentTransactionData.crypto] >= amountToSell) {
                            // Deduct crypto and add USD
                            let newHoldings = { ...holdings };
                            newHoldings[currentTransactionData.crypto] = (holdings[currentTransactionData.crypto] - amountToSell).toFixed(8);
                            
                            if (fromAccount === 'checking') {
                                newCheckingBalance += total;
                            } else {
                                newSavingsBalance += total;
                            }
                            
                            await updateDoc(doc(db, 'users', currentUser.uid), {
                                cryptoHoldings: newHoldings
                            });
                            success = true;
                        }
                    } else if (action === 'buy') {
                        // Check if they have USD balance to buy crypto
                        if (fromBalance >= total) {
                            // Deduct USD and add crypto
                            let newHoldings = { ...userDataTx.cryptoHoldings };
                            newHoldings[currentTransactionData.crypto] = (parseFloat(newHoldings[currentTransactionData.crypto] || 0) + (currentTransactionData.cryptoAmount || 0)).toFixed(8);
                            
                            if (fromAccount === 'checking') {
                                newCheckingBalance -= total;
                            } else {
                                newSavingsBalance -= total;
                            }
                            
                            await updateDoc(doc(db, 'users', currentUser.uid), {
                                cryptoHoldings: newHoldings
                            });
                            success = true;
                        }
                    }
                } else {
                    // Other transactions (transfer, wire, bill, mobile, etc.)
                    const fromAccount = currentTransactionData.fromAccount || 'checking';
                    if (fromAccount === 'checking') {
                        if (newCheckingBalance >= currentTransactionData.total) {
                            newCheckingBalance -= currentTransactionData.total;
                            success = true;
                        }
                    } else {
                        if (newSavingsBalance >= currentTransactionData.total) {
                            newSavingsBalance -= currentTransactionData.total;
                            success = true;
                        }
                    }
                }

                if (success) {
                    await updateDoc(doc(db, 'users', currentUser.uid), {
                        checkingBalance: newCheckingBalance,
                        savingsBalance: newSavingsBalance
                    });

                    await addDoc(collection(db, 'users', currentUser.uid, 'transactions'), {
                        ...currentTransactionData,
                        timestamp: serverTimestamp(),
                        status: 'success'
                    });
                } else {
                    // Transaction failed due to insufficient balance
                    hideLoading();
                    showAlert('Transaction failed: Insufficient balance or insufficient crypto holdings.', 'error');
                    return;
                }

                hideLoading();
                
                // Show transaction notification with details
                if (success) {
                    showTransactionNotification(currentTransactionData);
                }
                
                // Store balance after transaction
                if (success) {
                    currentTransactionData.checkingBalanceAfter = newCheckingBalance;
                    currentTransactionData.savingsBalanceAfter = newSavingsBalance;
                }
                
                showReceipt(success);
            } catch (error) {
                hideLoading();
                showAlert('Error processing transaction: ' + error.message, 'error');
            }
        };

        function showReceipt(success) {
            const type = currentTransactionData.type;
            const typeNames = {
                bank: 'Bank Transfer',
                wire: 'Wire Transfer',
                withdraw: 'Withdrawal',
                topup: 'Top Up',
                bikes: 'Bikes Payment',
                bill: 'Bill Payment',
                mobile: 'Mobile Recharge',
                donation: 'Donation',
                insurance: 'Insurance Payment',
                investment: 'Investment',
                savings: 'Savings Plan'
            };

            const isPendingWithdrawal = type === 'withdraw' && currentTransactionData.isPending;

            if (success) {
                const typeIcons = { bank: '🏦', wire: '💳', withdraw: '💵', topup: '➕', bikes: '🚴', bill: '📄', mobile: '📱', donation: '❤️', insurance: '🛡️', investment: '📊', savings: '🏪' };
                const typeColors = { bank: '#667eea', wire: '#f59e0b', withdraw: '#ef4444', topup: '#10b981', bikes: '#667eea', bill: '#f59e0b', mobile: '#10b981', donation: '#ef4444', insurance: '#667eea', investment: '#f59e0b', savings: '#10b981' };
                const isCredit = type === 'topup';
                const amountSign = isCredit ? '+' : '-';
                const description = type === 'topup' ? `To ${currentTransactionData.toAccount} Account` : `To ${currentTransactionData.recipientName || currentTransactionData.bankName || 'Account'}`;
                addNotification(
                    type,
                    typeNames[type] || type,
                    description,
                    `${amountSign}$${currentTransactionData.total.toFixed(2)}`,
                    typeIcons[type] || '💸',
                    typeColors[type] || '#667eea'
                );
            }

            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            const receiptId = currentTransactionData.pendingTransactionId || Math.random().toString(36).substring(2, 11).toUpperCase();

            const typeIcons = { bank: 'fa-exchange-alt', wire: 'fa-paper-plane', withdraw: 'fa-money-bill', topup: 'fa-plus-circle', bikes: 'fa-bicycle', bill: 'fa-file-invoice', mobile: 'fa-mobile-alt', donation: 'fa-hand-holding-heart', insurance: 'fa-shield-alt', investment: 'fa-chart-line', savings: 'fa-piggy-bank' };

            let statusText = success ? 'Completed' : 'Failed';
            let statusColor = success ? '#10b981' : '#ef4444';
            if (isPendingWithdrawal) {
                statusText = 'Pending';
                statusColor = '#f59e0b';
            }

            let details = `
                <div class="receipt-transaction-type">
                    <div class="receipt-type-icon">
                        <i class="fas ${typeIcons[type] || 'fa-exchange-alt'}" style="color: #667eea;"></i>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: #1f2937;">${typeNames[type] || type}</div>
                        <div style="font-size: 12px; color: ${statusColor}; margin-top: 2px;" id="receiptStatusText">${statusText}</div>
                    </div>
                </div>
                ${isPendingWithdrawal ? `
                <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 1px solid #f59e0b; border-radius: 12px; padding: 15px; margin: 15px 0; text-align: center;">
                    <i class="fas fa-clock" style="color: #d97706; font-size: 24px; margin-bottom: 8px;"></i>
                    <div style="font-weight: 600; color: #92400e; margin-bottom: 4px;">Withdrawal Pending</div>
                    <div style="font-size: 12px; color: #b45309;">Your withdrawal is being processed. Funds have been deducted and will be released once approved by the bank.</div>
                </div>
                ` : ''}

                <div class="receipt-divider"></div>

                <div class="receipt-amount-section">
                    <div style="text-align: center; font-size: 12px; color: #666; margin-bottom: 8px;">Total Amount</div>
                    <div class="receipt-amount-large">$${currentTransactionData.total.toFixed(2)}</div>
                    <div style="text-align: center; font-size: 12px; color: #999;">
                        ${currentTransactionData.amount.toFixed(2)} + $${currentTransactionData.fee.toFixed(2)} fee
                    </div>
                </div>

                <div class="receipt-divider"></div>

                <div class="summary-row">
                    <span class="receipt-label">Transaction ID</span>
                    <span class="receipt-value" style="font-size: 12px; font-family: monospace;">${receiptId}</span>
                </div>
                <div class="summary-row">
                    <span class="receipt-label">Date</span>
                    <span class="receipt-value">${dateStr}</span>
                </div>
                <div class="summary-row">
                    <span class="receipt-label">Time</span>
                    <span class="receipt-value">${timeStr}</span>
                </div>
            `;
            
            if (type === 'topup') {
                details += `
                    <div class="summary-row">
                        <span class="receipt-label">To Account</span>
                        <span class="receipt-value">${currentTransactionData.toAccount.charAt(0).toUpperCase() + currentTransactionData.toAccount.slice(1)}</span>
                    </div>
                `;
            } else if (type === 'withdraw') {
                details += `
                    <div class="summary-row">
                        <span class="receipt-label">From Account</span>
                        <span class="receipt-value">${currentTransactionData.fromAccount.charAt(0).toUpperCase() + currentTransactionData.fromAccount.slice(1)}</span>
                    </div>
                `;
            } else if (['bikes', 'bill', 'mobile', 'donation', 'insurance', 'investment', 'savings'].includes(type)) {
                details += `
                    <div class="summary-row">
                        <span class="receipt-label">Recipient</span>
                        <span class="receipt-value">${currentTransactionData.recipientName}</span>
                    </div>
                    <div class="summary-row">
                        <span class="receipt-label">Reference</span>
                        <span class="receipt-value">${currentTransactionData.reference}</span>
                    </div>
                    <div class="summary-row">
                        <span class="receipt-label">From Account</span>
                        <span class="receipt-value">${currentTransactionData.fromAccount.charAt(0).toUpperCase() + currentTransactionData.fromAccount.slice(1)}</span>
                    </div>
                `;
            } else if (type === 'credcryptTransfer') {
                details += `
                    <div class="summary-row">
                        <span class="receipt-label">Recipient</span>
                        <span class="receipt-value">${currentTransactionData.recipientName}</span>
                    </div>
                    <div class="summary-row">
                        <span class="receipt-label">Account</span>
                        <span class="receipt-value">${currentTransactionData.recipientAccount}</span>
                    </div>
                    <div class="summary-row">
                        <span class="receipt-label">From Account</span>
                        <span class="receipt-value">${currentTransactionData.fromAccount.charAt(0).toUpperCase() + currentTransactionData.fromAccount.slice(1)}</span>
                    </div>
                `;
            } else if (type === 'bank' || type === 'wire') {
                if (currentTransactionData.recipientName) {
                    details += `
                        <div class="summary-row">
                            <span class="receipt-label">Recipient</span>
                            <span class="receipt-value">${currentTransactionData.recipientName}</span>
                        </div>
                    `;
                }
                if (currentTransactionData.recipientBank) {
                    details += `
                        <div class="summary-row">
                            <span class="receipt-label">Bank</span>
                            <span class="receipt-value">${currentTransactionData.recipientBank}</span>
                        </div>
                    `;
                }
                if (currentTransactionData.accountNumber) {
                    details += `
                        <div class="summary-row">
                            <span class="receipt-label">Account</span>
                            <span class="receipt-value">${currentTransactionData.accountNumber}</span>
                        </div>
                    `;
                }
                details += `
                    <div class="summary-row">
                        <span class="receipt-label">From Account</span>
                        <span class="receipt-value">${currentTransactionData.fromAccount.charAt(0).toUpperCase() + currentTransactionData.fromAccount.slice(1)}</span>
                    </div>
                `;
            }

            details += `
                <div class="receipt-divider"></div>
                <div class="summary-row">
                    <span class="receipt-label">Checking</span>
                    <span class="receipt-value">$${(currentTransactionData.checkingBalanceAfter || 0).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
                </div>
                <div class="summary-row">
                    <span class="receipt-label">Savings</span>
                    <span class="receipt-value">$${(currentTransactionData.savingsBalanceAfter || 0).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
                </div>
            `;

            let receiptStatusClass = success ? 'success' : 'failed';
            let receiptStatusIcon = success ? 'check-circle' : 'times-circle';
            let receiptStatusLabel = success ? 'Successful' : 'Failed';
            
            if (isPendingWithdrawal) {
                receiptStatusClass = 'pending';
                receiptStatusIcon = 'clock';
                receiptStatusLabel = 'Pending';
            }

            document.getElementById('receiptContent').innerHTML = `
                <div class="receipt" data-transaction-id="${receiptId}">
                    <div class="receipt-header">
                        <div class="receipt-logo">LEAD</div>
                        <h3 style="margin: 8px 0 0 0; font-size: 16px; color: #1f2937; font-weight: 600;">Receipt</h3>
                        <div class="receipt-status ${receiptStatusClass}" id="receiptStatusBadge" style="${isPendingWithdrawal ? 'background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #92400e;' : ''}">
                            <i class="fas fa-${receiptStatusIcon}" id="receiptStatusIcon"></i>
                            <span id="receiptStatusLabel">${receiptStatusLabel}</span>
                        </div>
                    </div>
                    <div class="receipt-details">
                        ${details}
                    </div>
                    ${isPendingWithdrawal ? `
                    <div style="text-align: center; padding: 15px; border-top: 1px dashed #e5e7eb;">
                        <button onclick="checkTransactionStatus('${receiptId}')" class="btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 24px; font-size: 14px;">
                            <i class="fas fa-sync-alt"></i> Check Status
                        </button>
                    </div>
                    ` : ''}
                </div>
            `;

            loadUserData();
            navigateTo('receipt');
        }

        window.checkTransactionStatus = async function(transactionId) {
            const statusBadge = document.getElementById('receiptStatusBadge');
            const statusIcon = document.getElementById('receiptStatusIcon');
            const statusLabel = document.getElementById('receiptStatusLabel');
            const statusText = document.getElementById('receiptStatusText');
            
            try {
                const response = await fetch(`/api/transactions/${transactionId}`);
                if (!response.ok) throw new Error('API not available');
                const transaction = await response.json();
                
                if (transaction.status === 'Completed') {
                    if (statusBadge) statusBadge.style.cssText = 'background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); color: #065f46;';
                    if (statusIcon) statusIcon.className = 'fas fa-check-circle';
                    if (statusLabel) statusLabel.textContent = 'Completed';
                    if (statusText) { statusText.textContent = 'Completed'; statusText.style.color = '#10b981'; }
                    showAlert('Your withdrawal has been approved and completed!', 'success');
                } else if (transaction.status === 'Failed') {
                    if (statusBadge) statusBadge.style.cssText = 'background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); color: #991b1b;';
                    if (statusIcon) statusIcon.className = 'fas fa-times-circle';
                    if (statusLabel) statusLabel.textContent = 'Failed';
                    if (statusText) { statusText.textContent = 'Failed'; statusText.style.color = '#ef4444'; }
                    showAlert('Your withdrawal was declined. Please contact support.', 'error');
                } else {
                    showAlert('Your withdrawal is still being processed. Please check back later.', 'info');
                }
            } catch (error) {
                // For standalone HTML without backend, show pending status message
                showAlert('Your withdrawal is being processed by the bank. This typically takes 1-3 business days. You will be notified when complete.', 'info');
            }
        };

        window.closeModal = function(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
        };

        window.openLoanModal = function() {
            const modal = document.getElementById('loanModal');
            if (modal) {
                modal.classList.add('active');
            }
        };

        window.openAddCardModal = function() {
            navigateTo('addCardPage');
        };

        window.showTransactionHistory = async function() {
            try {
                const transactionsQuery = query(collection(db, 'users', currentUser.uid, 'transactions'), orderBy('timestamp', 'desc'));
                const snapshot = await getDocs(transactionsQuery);
                
                allTransactions = [];
                if (snapshot.empty) {
                    document.getElementById('transactionHistoryContent').innerHTML = `
                        <div class="glass-card" style="text-align: center; padding: 40px;">
                            <i class="fas fa-inbox" style="font-size: 48px; color: var(--text-secondary); margin-bottom: 20px;"></i>
                            <p style="color: var(--text-secondary);">No transactions yet. Complete some transactions to see them listed here.</p>
                        </div>
                    `;
                } else {
                    snapshot.forEach(doc => {
                        allTransactions.push({ id: doc.id, ...doc.data() });
                    });
                    
                    document.getElementById('transactionHistoryContent').innerHTML = allTransactions.map((tx, idx) => {
                        const icons = {
                            'transfer': 'fas fa-exchange-alt',
                            'wire': 'fas fa-globe',
                            'crypto': 'fab fa-bitcoin',
                            'withdraw': 'fas fa-arrow-down',
                            'topup': 'fas fa-arrow-up',
                            'bill': 'fas fa-file-invoice-dollar',
                            'mobile': 'fas fa-mobile-alt',
                            'donation': 'fas fa-heart',
                            'insurance': 'fas fa-shield-alt',
                            'investment': 'fas fa-chart-line',
                            'savings': 'fas fa-piggy-bank',
                            'bikes': 'fas fa-motorcycle'
                        };
                        const icon = icons[tx.type] || 'fas fa-exchange-alt';
                        const date = tx.timestamp ? new Date(tx.timestamp.seconds * 1000).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' }) : 'N/A';
                        const amount = tx.amount || tx.total || (tx.cryptoAmount && tx.price ? tx.cryptoAmount * tx.price : 0);
                        
                        // Determine if debit or credit
                        const debitTypes = ['transfer', 'wire', 'withdraw', 'bill', 'mobile', 'donation', 'insurance', 'investment', 'bikes'];
                        const isDebit = debitTypes.includes(tx.type) || (tx.type === 'crypto' && tx.action === 'sell');
                        const isCredit = tx.type === 'topup' || (tx.type === 'crypto' && tx.action === 'buy') || tx.type === 'savings';
                        
                        const amountColor = isDebit ? '#ef4444' : isCredit ? '#10b981' : '#667eea';
                        const icon_bg = isDebit ? 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)' : isCredit ? 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)' : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                        const sign = isDebit ? '−' : isCredit ? '+' : '';
                        
                        // For crypto transactions, show crypto amount + symbol
                        const displayAmount = tx.type === 'crypto' ? `${sign}${(tx.cryptoAmount || 0).toFixed(8)} ${tx.crypto || ''}` : `${sign}$${(amount).toFixed(2)}`;
                        
                        return `
                            <div class="glass-card" onclick="showTransactionDetail(${idx})" style="cursor: pointer; padding: 16px; display: flex; justify-content: space-between; align-items: center; hover-effect; transition: all 0.2s; border: 2px solid transparent;" onmouseover="this.style.borderColor='#667eea'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='transparent'; this.style.transform='translateY(0)';">
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div style="width: 45px; height: 45px; border-radius: 12px; background: ${icon_bg}; display: flex; align-items: center; justify-content: center; color: white; font-size: 18px;">
                                        <i class="${icon}"></i>
                                    </div>
                                    <div>
                                        <div style="font-weight: 600; font-size: 14px; text-transform: capitalize;">${tx.type || 'Transaction'}</div>
                                        <div style="font-size: 12px; color: var(--text-secondary); margin-top: 3px;">${date}</div>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-weight: 700; font-size: 16px; color: ${amountColor};">${displayAmount}</div>
                                    <div style="font-size: 12px; color: ${tx.status === 'success' ? '#10b981' : '#ef4444'}; text-transform: capitalize;">${tx.status || 'pending'}</div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
            } catch (error) {
                console.error('Error loading transactions:', error);
                allTransactions = [];
                document.getElementById('transactionHistoryContent').innerHTML = `
                    <div class="glass-card" style="text-align: center; padding: 40px;">
                        <p style="color: var(--text-secondary);">Unable to load transactions. Please try again.</p>
                    </div>
                `;
            }
            navigateTo('transactionHistory');
        };
        
        window.showTransactionDetail = function(index) {
            selectedTransactionIndex = index;
            if (allTransactions[index]) {
                const tx = allTransactions[index];
                const date = tx.timestamp ? new Date(tx.timestamp.seconds * 1000).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) : 'N/A';
                const time = tx.timestamp ? new Date(tx.timestamp.seconds * 1000).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) : 'N/A';
                const fullTime = tx.timestamp ? new Date(tx.timestamp.seconds * 1000).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', second: '2-digit', hour12: true }) : 'N/A';
                const amount = tx.amount || tx.total || (tx.cryptoAmount && tx.price ? tx.cryptoAmount * tx.price : 0);
                
                // Determine if debit or credit
                const debitTypes = ['transfer', 'wire', 'withdraw', 'bill', 'mobile', 'donation', 'insurance', 'investment', 'bikes'];
                const isDebit = debitTypes.includes(tx.type) || (tx.type === 'crypto' && tx.action === 'sell');
                const isCredit = tx.type === 'topup' || (tx.type === 'crypto' && tx.action === 'buy') || tx.type === 'savings';
                
                const amountColor = isDebit ? '#ef4444' : isCredit ? '#10b981' : '#667eea';
                const icon_bg = isDebit ? 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)' : isCredit ? 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)' : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                const sign = isDebit ? '−' : isCredit ? '+' : '';
                const transactionIcon = tx.status === 'success' ? 'check-circle' : 'info-circle';
                
                // For crypto transactions, show crypto amount + symbol
                const headerDisplayAmount = tx.type === 'crypto' ? `${sign}${(tx.cryptoAmount || 0).toFixed(8)} ${tx.crypto || ''}` : `${sign}$${(amount).toFixed(2)}`;
                
                let details = `
                    <div style="text-align: center; margin-bottom: 30px;">
                        <div style="width: 100px; height: 100px; border-radius: 50%; background: ${icon_bg}; display: flex; align-items: center; justify-content: center; color: white; font-size: 48px; margin: 0 auto 20px;">
                            <i class="fas fa-${transactionIcon}"></i>
                        </div>
                        <h2 style="margin: 0 0 5px 0; text-transform: capitalize; color: var(--text-primary);">${tx.type || 'Transaction'}</h2>
                        <p style="margin: 0 0 15px 0; color: var(--text-secondary); font-size: 14px;">${date}</p>
                        <div style="font-size: 32px; font-weight: 700; color: ${amountColor}; margin: 10px 0;">
                            ${headerDisplayAmount}
                        </div>
                    </div>
                    
                    <div style="background: #ffffff; padding: 20px; border-radius: 16px; margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div>
                                <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">Date</div>
                                <div style="font-weight: 600; color: var(--text-primary);">${date}</div>
                            </div>
                            <div>
                                <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">Time</div>
                                <div style="font-weight: 600; color: var(--text-primary);">${fullTime}</div>
                            </div>
                        </div>
                        
                        <div style="padding-top: 20px; border-top: 1px solid var(--border-color);">
                            <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">Transaction Type</div>
                            <div style="font-weight: 600; color: var(--text-primary); text-transform: capitalize;">${tx.type || 'Transaction'}</div>
                        </div>
                    </div>
                    
                    <div style="background: #ffffff; padding: 20px; border-radius: 16px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 15px 0; font-size: 14px; font-weight: 700; text-transform: uppercase; color: var(--text-secondary);">Transaction Details</h3>
                        
                        <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-color);">
                            <span style="color: var(--text-secondary); font-size: 14px;">${tx.type === 'crypto' ? 'Crypto Amount' : 'Amount'}</span>
                            <span style="font-weight: 700; color: ${amountColor};">${tx.type === 'crypto' ? `${(tx.cryptoAmount || 0).toFixed(8)} ${tx.crypto || ''}` : `${sign}$${(amount).toFixed(2)}`}</span>
                        </div>
                        
                        ${tx.type === 'crypto' && tx.usdAmount ? `<div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-color);">
                            <span style="color: var(--text-secondary); font-size: 14px;">USD Amount</span>
                            <span style="font-weight: 700;">$${(tx.usdAmount).toFixed(2)}</span>
                        </div>` : ''}
                        
                        ${tx.fee ? `<div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-color);">
                            <span style="color: var(--text-secondary); font-size: 14px;">Fee</span>
                            <span style="font-weight: 700;">$${(tx.fee).toFixed(2)}</span>
                        </div>` : ''}
                        
                        ${tx.total ? `<div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-color);">
                            <span style="color: var(--text-secondary); font-size: 14px;">Total</span>
                            <span style="font-weight: 700; color: ${amountColor};">${tx.type === 'crypto' ? `$${(tx.total).toFixed(2)}` : `${sign}$${(tx.total).toFixed(2)}`}</span>
                        </div>` : ''}
                        
                        <div style="display: flex; justify-content: space-between; padding: 12px 0;">
                            <span style="color: var(--text-secondary); font-size: 14px;">Status</span>
                            <span style="color: ${tx.status === 'success' ? '#10b981' : '#ef4444'}; font-weight: 700; text-transform: capitalize;">${tx.status || 'pending'}</span>
                        </div>
                    </div>
                    
                    ${tx.fromAccount || tx.toAccount || tx.recipientName || tx.recipientBank ? `<div style="background: #ffffff; padding: 20px; border-radius: 16px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 15px 0; font-size: 14px; font-weight: 700; text-transform: uppercase; color: var(--text-secondary);">Account Information</h3>
                        
                        ${tx.fromAccount ? `<div style="padding: 12px 0; border-bottom: 1px solid var(--border-color);">
                            <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; font-weight: 600;">From Account</div>
                            <div style="font-weight: 600; text-transform: capitalize;">${tx.fromAccount}</div>
                        </div>` : ''}
                        
                        ${tx.toAccount ? `<div style="padding: 12px 0; border-bottom: 1px solid var(--border-color);">
                            <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; font-weight: 600;">To Account</div>
                            <div style="font-weight: 600; text-transform: capitalize;">${tx.toAccount}</div>
                        </div>` : ''}
                        
                        ${tx.recipientName ? `<div style="padding: 12px 0; border-bottom: 1px solid var(--border-color);">
                            <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; font-weight: 600;">Recipient</div>
                            <div style="font-weight: 600;">${tx.recipientName}</div>
                        </div>` : ''}
                        
                        ${tx.recipientBank ? `<div style="padding: 12px 0; border-bottom: 1px solid var(--border-color);">
                            <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; font-weight: 600;">Recipient Bank</div>
                            <div style="font-weight: 600;">${tx.recipientBank}</div>
                        </div>` : ''}
                        
                        ${tx.accountNumber ? `<div style="padding: 12px 0;">
                            <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; font-weight: 600;">Account Number</div>
                            <div style="font-weight: 600; font-family: monospace;">****${tx.accountNumber.slice(-4)}</div>
                        </div>` : ''}
                    </div>` : ''}
                    
                    ${tx.type === 'crypto' ? `<div style="background: #ffffff; padding: 20px; border-radius: 16px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 15px 0; font-size: 14px; font-weight: 700; text-transform: uppercase; color: var(--text-secondary);">Crypto Details</h3>
                        
                        <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-color);">
                            <span style="color: var(--text-secondary); font-size: 14px;">Cryptocurrency</span>
                            <span style="font-weight: 700;">${tx.crypto || 'N/A'}</span>
                        </div>
                        
                        ${tx.cryptoAmount ? `<div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-color);">
                            <span style="color: var(--text-secondary); font-size: 14px;">Crypto Amount</span>
                            <span style="font-weight: 700;">${(tx.cryptoAmount).toFixed(8)} ${tx.crypto || ''}</span>
                        </div>` : ''}
                        
                        ${tx.price ? `<div style="display: flex; justify-content: space-between; padding: 12px 0;">
                            <span style="color: var(--text-secondary); font-size: 14px;">Price per Unit</span>
                            <span style="font-weight: 700;">$${(tx.price).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
                        </div>` : ''}
                    </div>` : ''}
                    
                    <div style="background: #ffffff; padding: 20px; border-radius: 16px; margin-bottom: 20px;">
                        <h3 style="margin: 0 0 15px 0; font-size: 14px; font-weight: 700; text-transform: uppercase; color: var(--text-secondary);">Reference Information</h3>
                        
                        <div style="padding: 12px 0;">
                            <div style="font-size: 11px; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">Transaction ID</div>
                            <div style="font-family: monospace; font-size: 12px; word-break: break-all; color: var(--text-primary); padding: 12px; background: var(--bg-primary); border-radius: 8px;">${tx.id || 'N/A'}</div>
                        </div>
                    </div>
                `;
                
                document.getElementById('transactionDetailContent').innerHTML = details;
            }
            navigateTo('transactionDetail');
        };

        async function loadCardsPage() {
            const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
            const userDataCards = userDoc.data();
            const cards = userDataCards.cards || [];

            const cardsContainer = document.getElementById('cardsContainer');
            cardsContainer.innerHTML = cards.map(card => `
                <div class="glass-card" style="background: ${card.color}; color: white; padding: 30px; position: relative;">
                    <button onclick="deleteCard('${card.id}')" style="position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); border: none; color: white; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.3s; font-size: 16px;" onmouseover="this.style.background='rgba(255,255,255,0.4)'" onmouseout="this.style.background='rgba(255,255,255,0.2)'">
                        <i class="fas fa-trash"></i>
                    </button>
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 40px;">
                        <div>
                            <div style="font-size: 14px; opacity: 0.9;">${card.type.toUpperCase()} CARD</div>
                            <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;">${card.account.charAt(0).toUpperCase() + card.account.slice(1)} Account</div>
                        </div>
                        <div style="font-size: 24px;">
                            <i class="fas fa-credit-card"></i>
                        </div>
                    </div>
                    <div style="font-size: 24px; letter-spacing: 3px; margin-bottom: 20px;">
                        •••• •••• •••• ${card.last4}
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <div>
                            <div style="font-size: 12px; opacity: 0.8;">CARDHOLDER</div>
                            <div style="font-size: 14px; margin-top: 5px;">${card.name}</div>
                        </div>
                        ${card.type === 'credit' ? `
                            <div>
                                <div style="font-size: 12px; opacity: 0.8;">LIMIT</div>
                                <div style="font-size: 14px; margin-top: 5px;">$${card.limit.toLocaleString()}</div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        window.deleteCard = async function(cardId) {
            if (!confirm('Are you sure you want to delete this card?')) {
                return;
            }

            showLoading('Deleting card...');
            try {
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                const userData = userDoc.data() || {};
                const cards = userData.cards || [];
                
                const updatedCards = cards.filter(card => card.id !== cardId);
                
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    cards: updatedCards
                });
                
                hideLoading();
                showAlert('Card deleted successfully!', 'success');
                loadCardsPage();
            } catch (error) {
                hideLoading();
                showAlert('Error deleting card: ' + error.message, 'error');
            }
        };

        function renderCreditScoreChart() {
            const ctx = document.getElementById('creditScoreChart');
            if (!ctx) return;

            if (creditScoreChartInstance) {
                creditScoreChartInstance.destroy();
            }

            creditScoreChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [750, 100],
                        backgroundColor: ['#667eea', '#e5e7eb'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    cutout: '75%',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            enabled: false
                        }
                    }
                }
            });
        }

        document.getElementById('addCardForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const cardType = document.getElementById('cardType').value;
            const cardBrand = document.getElementById('cardBrand').value;
            const cardName = document.getElementById('cardName').value;
            const cardNumber = document.getElementById('cardNumber').value;
            const cardExpiry = document.getElementById('cardExpiry').value;
            const cardCVC = document.getElementById('cardCVC').value;

            if (!cardType || !cardBrand || !cardName || !cardNumber || !cardExpiry || !cardCVC) {
                showAlert('Please fill all fields', 'error', 'addCardAlert');
                return;
            }

            showLoading('Adding your card...');

            try {
                const last4 = cardNumber.replace(/\s/g, '').slice(-4);
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                const userData = userDoc.data() || {};
                const cards = userData.cards || [];

                const colors = [
                    'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                    'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                    'linear-gradient(135deg, #fa709a 0%, #fee140 100%)'
                ];

                const newCard = {
                    id: Date.now().toString(),
                    type: cardType,
                    brand: cardBrand,
                    name: cardName,
                    number: cardNumber,
                    expiry: cardExpiry,
                    cvc: cardCVC,
                    last4: last4,
                    color: colors[cards.length % colors.length],
                    createdAt: serverTimestamp()
                };

                cards.push(newCard);

                await updateDoc(doc(db, 'users', currentUser.uid), {
                    cards: cards
                });

                hideLoading();
                document.getElementById('addCardForm').reset();
                showAlert('Card added successfully!', 'success', 'addCardAlert');
                navigateTo('cards');
                loadCardsPage();
            } catch (error) {
                hideLoading();
                showAlert('Error adding card: ' + error.message, 'error', 'addCardAlert');
            }
        });

        async function displayCryptoHoldings() {
            const holdings = document.getElementById('cryptoHoldings');
            try {
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                const userDataCrypto = userDoc.data();
                const cryptoHoldings = userDataCrypto.cryptoHoldings || { BTC: 0 };
                
                holdings.innerHTML = `
                    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 15px; border-radius: 12px; text-align: center; color: white; font-weight: 600;">
                        <div style="font-size: 12px; opacity: 0.9;"><i class="fas fa-btc"></i> Bitcoin</div>
                        <div style="font-size: 18px; margin-top: 5px;">${(cryptoHoldings.BTC || 0).toFixed(4)} BTC</div>
                    </div>
                `;
            } catch (error) {
                holdings.innerHTML = '<div style="padding: 15px; color: var(--text-secondary); text-align: center;">Error loading holdings</div>';
            }
        }

        async function loadCryptoData() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true');
                const data = await response.json();

                cryptoData.BTC.price = data.bitcoin.usd;
                cryptoData.BTC.change = data.bitcoin.usd_24h_change;

                displayCryptoList();
            } catch (error) {
                console.error('Error fetching crypto prices:', error);
            }
        }

        function displayCryptoList() {
            const cryptoList = document.getElementById('cryptoList');
            cryptoList.innerHTML = '';

            Object.entries(cryptoData).forEach(([symbol, data]) => {
                const changeClass = data.change >= 0 ? 'positive' : 'negative';
                const changeSign = data.change >= 0 ? '+' : '';

                const cryptoItem = document.createElement('div');
                cryptoItem.className = 'crypto-item';
                cryptoItem.onclick = () => openCryptoDetail(symbol);
                cryptoItem.innerHTML = `
                    <div class="crypto-info">
                        <div class="crypto-icon">${data.icon}</div>
                        <div class="crypto-details">
                            <h3>${data.name}</h3>
                            <p>${data.symbol}</p>
                        </div>
                    </div>
                    <div class="crypto-price">
                        <div class="price">$${data.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</div>
                        <div class="change ${changeClass}">${changeSign}${data.change.toFixed(2)}%</div>
                    </div>
                `;
                cryptoList.appendChild(cryptoItem);
            });
        }

        window.openCryptoDetail = function(symbol) {
            selectedCrypto = symbol;
            const crypto = cryptoData[symbol];

            document.getElementById('cryptoDetailContent').innerHTML = `
                <h2>${crypto.name} (${crypto.symbol})</h2>
                <div class="glass-card" style="margin: 20px 0;">
                    <div style="font-size: 36px; font-weight: 700; margin-bottom: 10px;">
                        $${crypto.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                    </div>
                    <div style="color: ${crypto.change >= 0 ? '#10b981' : '#ef4444'}; font-size: 18px;">
                        ${crypto.change >= 0 ? '+' : ''}${crypto.change.toFixed(2)}% (24h)
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-tabs">
                        <div class="chart-tab active">Day</div>
                        <div class="chart-tab">Week</div>
                        <div class="chart-tab">Month</div>
                        <div class="chart-tab">Year</div>
                    </div>
                    <canvas id="cryptoChart"></canvas>
                </div>

                <div class="crypto-action-btns">
                    <button class="crypto-action-btn" onclick="openBuyCryptoPage()" disabled style="opacity: 0.5; cursor: not-allowed;">
                        <i class="fas fa-arrow-down"></i>
                        <span>Buy</span>
                    </button>
                    <button class="crypto-action-btn" onclick="openSellCryptoPage()" disabled style="opacity: 0.5; cursor: not-allowed;">
                        <i class="fas fa-arrow-up"></i>
                        <span>Sell</span>
                    </button>
                </div>
            `;

            navigateTo('cryptoDetail');
            renderCryptoChart();
        };

        function renderCryptoChart() {
            const ctx = document.getElementById('cryptoChart');
            if (!ctx) return;

            const labels = Array.from({ length: 24 }, (_, i) => `${i}:00`);
            const basePrice = cryptoData[selectedCrypto].price;
            const data = labels.map(() => basePrice + (Math.random() - 0.5) * basePrice * 0.1);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'Price',
                        data,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }

        window.openCryptoTrade = function(action) {
            currentCryptoData = { action, crypto: selectedCrypto };
            const titles = {
                buy: 'Buy ' + cryptoData[selectedCrypto].name,
                sell: 'Sell ' + cryptoData[selectedCrypto].name,
                send: 'Send ' + cryptoData[selectedCrypto].name,
                receive: 'Receive ' + cryptoData[selectedCrypto].name
            };

            document.getElementById('cryptoTradeTitle').textContent = titles[action];

            if (action === 'receive') {
                showAlert('Receive functionality coming soon! Your wallet address will be displayed here.', 'info');
                return;
            }

            document.getElementById('cryptoTradeModal').classList.add('active');
            cryptoInputMode = 'crypto';
            const cryptoModal = document.getElementById('cryptoTradeModal');
            const toggleOptions = cryptoModal.querySelectorAll('.toggle-option');
            toggleOptions.forEach(el => el.classList.remove('active'));
            toggleOptions[0].classList.add('active');
            document.getElementById('cryptoAmount').value = '';
            updateCryptoInputLabel();
            displayCryptoHoldingsInModal();
        };

        async function displayCryptoHoldingsInModal() {
            const holdingsDisplay = document.getElementById('cryptoHoldingsDisplay');
            const holdingsAmount = document.getElementById('cryptoHoldingsAmount');
            
            try {
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                const userDataModal = userDoc.data();
                const holdings = userDataModal.cryptoHoldings || { BTC: 0 };
                holdingsAmount.textContent = `${holdings[selectedCrypto] || 0} ${selectedCrypto}`;
            } catch (error) {
                holdingsAmount.textContent = `0 ${selectedCrypto}`;
            }
            holdingsDisplay.style.display = 'block';
        }

        window.toggleCryptoInput = function(mode) {
            cryptoInputMode = mode;
            const cryptoModal = document.getElementById('cryptoTradeModal');
            if (cryptoModal) {
                const toggleOptions = cryptoModal.querySelectorAll('.toggle-option');
                toggleOptions.forEach(el => el.classList.remove('active'));
                if (mode === 'crypto') {
                    toggleOptions[0].classList.add('active');
                } else {
                    toggleOptions[1].classList.add('active');
                }
            }
            document.getElementById('cryptoAmount').value = '';
            updateCryptoInputLabel();
            setTimeout(() => {
                document.getElementById('cryptoAmount').focus();
                updateCryptoConversion();
            }, 50);
        };

        function updateCryptoInputLabel() {
            const crypto = cryptoData[selectedCrypto];
            const label = document.getElementById('cryptoInputLabel');
            if (cryptoInputMode === 'crypto') {
                label.textContent = `Amount (${crypto.symbol})`;
            } else {
                label.textContent = 'Amount (USD)';
            }
        }

        document.getElementById('cryptoAmount').addEventListener('input', updateCryptoConversion);

        function updateCryptoConversion() {
            try {
                const amount = parseFloat(document.getElementById('cryptoAmount').value) || 0;
                const crypto = cryptoData[selectedCrypto];
                if (!crypto) return;
                const conversion = document.getElementById('cryptoConversion');

                if (amount > 0) {
                    if (cryptoInputMode === 'crypto') {
                        const usdValue = amount * crypto.price;
                        conversion.textContent = `≈ $${usdValue.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                    } else {
                        const cryptoValue = amount / crypto.price;
                        conversion.textContent = `≈ ${cryptoValue.toFixed(8)} ${crypto.symbol}`;
                    }
                } else {
                    conversion.textContent = '';
                }
            } catch (error) {
                console.error('Error updating crypto conversion:', error);
            }
        }

        document.getElementById('cryptoTradeForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const amount = parseFloat(document.getElementById('cryptoAmount').value);
            if (!amount || amount <= 0) {
                showAlert('Please enter a valid amount', 'error', 'cryptoTradeAlert');
                return;
            }
            
            const crypto = cryptoData[selectedCrypto];
            if (!crypto) {
                showAlert('Invalid crypto selected', 'error', 'cryptoTradeAlert');
                return;
            }
            
            const fromAccount = document.getElementById('cryptoFromAccount').value;
            const action = currentCryptoData.action;

            let cryptoAmount, usdAmount;

            if (cryptoInputMode === 'crypto') {
                cryptoAmount = amount;
                usdAmount = amount * crypto.price;
            } else {
                usdAmount = amount;
                cryptoAmount = amount / crypto.price;
            }

            const fee = usdAmount * 0.015;
            const total = action === 'buy' ? usdAmount + fee : usdAmount - fee;

            // VALIDATE BALANCE BEFORE PROCEEDING
            try {
                const cryptoBalanceCheckDoc = await getDoc(doc(db, 'users', currentUser.uid));
                const cryptoCheckData = cryptoBalanceCheckDoc.data();
                
                if (action === 'buy') {
                    // Check if user has enough USD balance
                    const accountBalance = fromAccount === 'savings' ? cryptoCheckData.savingsBalance : cryptoCheckData.checkingBalance;
                    if (total > accountBalance) {
                        showAlert(`Insufficient balance! You have $${accountBalance.toFixed(2)} but need $${total.toFixed(2)} to buy ${cryptoAmount.toFixed(8)} ${selectedCrypto}.`, 'error', 'cryptoTradeAlert');
                        return;
                    }
                } else if (action === 'sell') {
                    // Check if user has crypto to sell
                    const holdings = cryptoCheckData.cryptoHoldings || { BTC: 0 };
                    const currentHolding = parseFloat(holdings[selectedCrypto] || 0);
                    if (cryptoAmount > currentHolding) {
                        showAlert(`Insufficient crypto! You have ${currentHolding.toFixed(8)} ${selectedCrypto} but trying to sell ${cryptoAmount.toFixed(8)}.`, 'error', 'cryptoTradeAlert');
                        return;
                    }
                }
            } catch (error) {
                showAlert('Error checking balance: ' + error.message, 'error', 'cryptoTradeAlert');
                return;
            }

            currentCryptoData.cryptoAmount = cryptoAmount;
            currentCryptoData.usdAmount = usdAmount;
            currentCryptoData.fee = fee;
            currentCryptoData.total = total;
            currentCryptoData.fromAccount = fromAccount;
            currentCryptoData.price = crypto.price;

            let summary = `
                <div class="summary-row">
                    <span>${action === 'buy' ? 'Buying' : 'Selling'}</span>
                    <span>${cryptoAmount.toFixed(8)} ${crypto.symbol}</span>
                </div>
                <div class="summary-row">
                    <span>Price</span>
                    <span>$${crypto.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
                </div>
                <div class="summary-row">
                    <span>Amount</span>
                    <span>$${usdAmount.toFixed(2)}</span>
                </div>
                <div class="summary-row">
                    <span>Fee (1.5%)</span>
                    <span>$${fee.toFixed(2)}</span>
                </div>
                <div class="summary-row">
                    <span>Total</span>
                    <span>$${total.toFixed(2)}</span>
                </div>
            `;

            document.getElementById('cryptoConfirmationSummary').innerHTML = summary;
            closeModal('cryptoTradeModal');
            document.getElementById('cryptoConfirmationModal').classList.add('active');

            currentTransactionData = { type: 'crypto', ...currentCryptoData };
        });


        async function processCryptoTransaction() {
            closeModal('cryptoConfirmationModal');
            showLoading('Processing transaction...');

            try {
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                const userDataCryptoTx = userDoc.data();

                let newCheckingBalance = userDataCryptoTx.checkingBalance;
                let newSavingsBalance = userDataCryptoTx.savingsBalance;
                let cryptoHoldings = userDataCryptoTx.cryptoHoldings || { BTC: 0 };
                let success = true;

                const action = currentCryptoData.action;
                const total = currentCryptoData.total;
                const fromAccount = currentCryptoData.fromAccount;
                const cryptoAmount = currentCryptoData.cryptoAmount;
                const symbol = currentCryptoData.crypto;

                if (action === 'buy' || action === 'send') {
                    if (fromAccount === 'checking') {
                        if (newCheckingBalance >= total) {
                            newCheckingBalance -= total;
                        } else {
                            success = false;
                        }
                    } else {
                        if (newSavingsBalance >= total) {
                            newSavingsBalance -= total;
                        } else {
                            success = false;
                        }
                    }
                    if (success) {
                        cryptoHoldings[symbol] = (parseFloat(cryptoHoldings[symbol] || 0) + parseFloat(cryptoAmount)).toFixed(8);
                    }
                } else if (action === 'sell') {
                    if (cryptoHoldings[symbol] >= cryptoAmount) {
                        if (fromAccount === 'checking') {
                            newCheckingBalance += total;
                        } else {
                            newSavingsBalance += total;
                        }
                        cryptoHoldings[symbol] = (parseFloat(cryptoHoldings[symbol] || 0) - parseFloat(cryptoAmount)).toFixed(8);
                    } else {
                        success = false;
                    }
                }

                if (!success) {
                    hideLoading();
                    showAlert('Transaction failed: Insufficient balance or insufficient crypto holdings.', 'error');
                    return;
                }

                // Store balances after transaction for receipt
                currentCryptoData.checkingBalanceAfter = newCheckingBalance;
                currentCryptoData.savingsBalanceAfter = newSavingsBalance;

                await updateDoc(doc(db, 'users', currentUser.uid), {
                    checkingBalance: newCheckingBalance,
                    savingsBalance: newSavingsBalance,
                    cryptoHoldings: cryptoHoldings
                });

                await addDoc(collection(db, 'users', currentUser.uid, 'transactions'), {
                    ...currentCryptoData,
                    timestamp: serverTimestamp(),
                    status: 'success'
                });
                
                hideLoading();
                await loadUserData();
                showCryptoReceipt(success);
                navigateTo('receipt');
            } catch (error) {
                hideLoading();
                showAlert(error.message, 'error');
            }
        }

        function showCryptoReceipt(success) {
            const crypto = cryptoData[selectedCrypto];
            const action = currentCryptoData.action;
            const actionNames = {
                buy: 'Buy',
                sell: 'Sell',
                send: 'Send'
            };

            if (success) {
                const actionIcons = { buy: '📉', sell: '📈', send: '💸' };
                const actionColors = { buy: '#ef4444', sell: '#10b981', send: '#667eea' };
                const isCredit = action === 'sell';
                const amountSign = isCredit ? '+' : '-';
                const creditColors = { buy: '#ef4444', sell: '#10b981', send: '#667eea' };
                addNotification(
                    'crypto',
                    `${actionNames[action]} ${crypto.symbol}`,
                    `${currentCryptoData.cryptoAmount.toFixed(8)} ${crypto.symbol}`,
                    `${amountSign}$${currentCryptoData.total.toFixed(2)}`,
                    actionIcons[action],
                    creditColors[action]
                );
            }

            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

            document.getElementById('receiptContent').innerHTML = `
                <div class="receipt">
                    <div class="receipt-header">
                        <div class="receipt-logo">LEAD</div>
                        <h2>Crypto Transaction Receipt</h2>
                        <div class="receipt-status ${success ? 'success' : 'failed'}">
                            <i class="fas fa-${success ? 'check-circle' : 'times-circle'}"></i>
                            ${success ? 'Success' : 'Failed'}
                        </div>
                    </div>
                    <div class="receipt-details">
                        <div class="summary-row">
                            <span class="receipt-label">Type</span>
                            <span class="receipt-value">${actionNames[action]} ${crypto.name}</span>
                        </div>
                        <div class="summary-row">
                            <span class="receipt-label">Amount</span>
                            <span class="receipt-value">${currentCryptoData.cryptoAmount.toFixed(8)} ${crypto.symbol}</span>
                        </div>
                        <div class="summary-row">
                            <span class="receipt-label">Price</span>
                            <span class="receipt-value">$${currentCryptoData.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
                        </div>
                        <div class="summary-row">
                            <span class="receipt-label">USD Amount</span>
                            <span class="receipt-value">$${currentCryptoData.usdAmount.toFixed(2)}</span>
                        </div>
                        <div class="summary-row">
                            <span class="receipt-label">Fee</span>
                            <span class="receipt-value">$${currentCryptoData.fee.toFixed(2)}</span>
                        </div>
                        <div class="summary-row">
                            <span class="receipt-label">Total</span>
                            <span class="receipt-value">$${currentCryptoData.total.toFixed(2)}</span>
                        </div>
                        <div class="summary-row">
                            <span class="receipt-label">Account</span>
                            <span class="receipt-value">${currentCryptoData.fromAccount.charAt(0).toUpperCase() + currentCryptoData.fromAccount.slice(1)}</span>
                        </div>
                        <div class="summary-row">
                            <span class="receipt-label">Date</span>
                            <span class="receipt-value">${dateStr}</span>
                        </div>
                        <div class="summary-row">
                            <span class="receipt-label">Time</span>
                            <span class="receipt-value">${timeStr}</span>
                        </div>
                        <div class="summary-row">
                            <span class="receipt-label">Checking Balance After</span>
                            <span class="receipt-value">$${(currentCryptoData.checkingBalanceAfter || 0).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
                        </div>
                        <div class="summary-row">
                            <span class="receipt-label">Savings Balance After</span>
                            <span class="receipt-value">$${(currentCryptoData.savingsBalanceAfter || 0).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span>
                        </div>
                    </div>
                </div>
            `;

            loadUserData();
            navigateTo('receipt');
        }

        // TOP-UP PAGE VARIABLES
        let selectedTopupCard = null;
        let topupAmount = 0;

        window.loadTopupPage = async function() {
            try {
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                const userData = userDoc.data();
                const cards = userData.cards || [
                    {
                        id: '1',
                        type: 'debit',
                        last4: '4532',
                        name: userData.firstName + ' ' + userData.surname,
                        account: 'checking',
                        color: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
                    }
                ];

                const cardsHTML = cards.map(card => `
                    <div class="glass-card" onclick="selectTopupCard('${card.id}', '${card.last4}', '${card.color}')" style="cursor: pointer; background: ${card.color}; color: white; padding: 20px; border: 3px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='white'; this.style.transform='scale(1.02)';" onmouseout="this.style.borderColor='transparent'; this.style.transform='scale(1)';">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 30px;">
                            <div>
                                <div style="font-size: 12px; opacity: 0.9; margin-bottom: 5px;">CARD</div>
                                <div style="font-size: 14px; font-weight: 600;">${card.type.toUpperCase()}</div>
                            </div>
                            <i class="fas fa-credit-card" style="font-size: 24px;"></i>
                        </div>
                        <div style="font-size: 20px; letter-spacing: 2px; margin-bottom: 20px;">•••• •••• •••• ${card.last4}</div>
                        <div style="font-size: 12px; opacity: 0.9;">CARDHOLDER</div>
                        <div style="font-size: 14px; font-weight: 600;">${card.name}</div>
                    </div>
                `).join('');

                document.getElementById('topupCardsContainer').innerHTML = cardsHTML;
                navigateTo('topupSelectCard');
            } catch (error) {
                showAlert('Error loading cards: ' + error.message, 'error');
            }
        };

        window.selectTopupCard = function(cardId, cardLast4, cardColor) {
            selectedTopupCard = { cardId, cardLast4, cardColor };
            document.getElementById('topupCardDisplay').textContent = `Selected card: ••••${cardLast4}`;
            document.getElementById('topupAmount').value = '';
            document.getElementById('topupAmount').focus();
            navigateTo('topupAmount');
        };

        window.setTopupAmount = function(amount) {
            document.getElementById('topupAmount').value = amount.toLocaleString();
            topupAmount = amount;
        };

        window.proceedToTopupConfirm = function() {
            const amountInput = document.getElementById('topupAmount');
            topupAmount = parseFloat(amountInput.value.replace(/,/g, '')) || 0;

            if (!selectedTopupCard) {
                showAlert('Please select a card', 'error');
                return;
            }

            if (!topupAmount || topupAmount < 1) {
                showAlert('Please enter a valid amount (minimum $1)', 'error');
                return;
            }

            if (topupAmount > 100000) {
                showAlert('Maximum top-up amount is $100,000', 'error');
                return;
            }

            // Proceed to PIN confirmation
            const toAccount = document.getElementById('topupToAccount')?.value || 'checking';
            currentTransactionData = {
                type: 'topup',
                cardLast4: selectedTopupCard.cardLast4,
                amount: topupAmount,
                fee: 0,
                total: topupAmount,
                toAccount: toAccount
            };
            
            const confirmModal = document.getElementById('confirmationModal');
            if (confirmModal) confirmModal.classList.add('active');
            document.getElementById('pin1').value = '';
            document.getElementById('pin2').value = '';
            document.getElementById('pin3').value = '';
            document.getElementById('pin4').value = '';
            
            let summary = `
                <div class="summary-row">
                    <span>Top Up From</span>
                    <span>Card ••••${selectedTopupCard.cardLast4}</span>
                </div>
                <div class="summary-row">
                    <span>To Account</span>
                    <span>${toAccount.charAt(0).toUpperCase() + toAccount.slice(1)}</span>
                </div>
                <div class="summary-row">
                    <span>Amount</span>
                    <span>$${topupAmount.toFixed(2)}</span>
                </div>
                <div class="summary-row">
                    <span>Fee</span>
                    <span>Free</span>
                </div>
                <div class="summary-row">
                    <span>Total</span>
                    <span>$${topupAmount.toFixed(2)}</span>
                </div>
            `;
            
            document.getElementById('confirmationSummary').innerHTML = summary;
            document.getElementById('confirmationModal').querySelector('.modal-title').textContent = 'Confirm Top Up';
            
            createDialPad();
            const pin1 = document.getElementById('pin1');
            if (pin1) pin1.focus();
        };

        function createTopupDialPad() {
            const dialPad = document.getElementById('topupDialPad');
            dialPad.innerHTML = '';

            for (let i = 1; i <= 9; i++) {
                const button = document.createElement('button');
                button.type = 'button';
                button.textContent = i;
                button.className = 'btn btn-secondary';
                button.style.background = 'var(--bg-card)';
                button.style.border = '2px solid var(--border-color)';
                button.onclick = (e) => {
                    e.preventDefault();
                    handleTopupPinInput(i.toString());
                };
                dialPad.appendChild(button);
            }

            const zeroButton = document.createElement('button');
            zeroButton.type = 'button';
            zeroButton.textContent = '0';
            zeroButton.className = 'btn btn-secondary';
            zeroButton.style.background = 'var(--bg-card)';
            zeroButton.style.border = '2px solid var(--border-color)';
            zeroButton.onclick = (e) => {
                e.preventDefault();
                handleTopupPinInput('0');
            };
            dialPad.appendChild(zeroButton);

            const backButton = document.createElement('button');
            backButton.type = 'button';
            backButton.innerHTML = '<i class="fas fa-backspace"></i>';
            backButton.className = 'btn btn-secondary';
            backButton.style.background = 'var(--bg-card)';
            backButton.style.border = '2px solid var(--border-color)';
            backButton.onclick = (e) => {
                e.preventDefault();
                handleTopupPinBackspace();
            };
            dialPad.appendChild(backButton);
        }

        function handleTopupPinInput(digit) {
            const inputs = [
                document.getElementById('topupPin1'),
                document.getElementById('topupPin2'),
                document.getElementById('topupPin3'),
                document.getElementById('topupPin4')
            ];

            for (let input of inputs) {
                if (input.value === '') {
                    input.value = digit;
                    input.nextElementSibling?.focus();
                    break;
                }
            }
        }

        function handleTopupPinBackspace() {
            const inputs = [
                document.getElementById('topupPin1'),
                document.getElementById('topupPin2'),
                document.getElementById('topupPin3'),
                document.getElementById('topupPin4')
            ];

            for (let i = inputs.length - 1; i >= 0; i--) {
                if (inputs[i].value !== '') {
                    inputs[i].value = '';
                    inputs[i].focus();
                    break;
                }
            }
        }

        window.completeTopup = async function() {
            const pin = [
                document.getElementById('topupPin1').value,
                document.getElementById('topupPin2').value,
                document.getElementById('topupPin3').value,
                document.getElementById('topupPin4').value
            ].join('');

            if (pin.length !== 4) {
                showAlert('Please enter a 4-digit PIN', 'error');
                return;
            }

            if (pin !== userPIN) {
                showAlert('Incorrect PIN. Please try again.', 'error');
                // Clear PIN fields
                document.getElementById('topupPin1').value = '';
                document.getElementById('topupPin2').value = '';
                document.getElementById('topupPin3').value = '';
                document.getElementById('topupPin4').value = '';
                document.getElementById('topupPin1').focus();
                return;
            }

            if (!selectedTopupCard || !topupAmount) {
                showAlert('Transaction data missing', 'error');
                return;
            }

            showLoading('Processing top up...');

            try {
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                const userData = userDoc.data();

                let newCheckingBalance = userData.checkingBalance || 0;
                const fee = topupAmount * 0.005; // 0.5% fee
                const total = topupAmount + fee;

                newCheckingBalance += topupAmount;

                await updateDoc(doc(db, 'users', currentUser.uid), {
                    checkingBalance: newCheckingBalance
                });

                await addDoc(collection(db, 'users', currentUser.uid, 'transactions'), {
                    type: 'topup',
                    amount: topupAmount,
                    fee: fee,
                    total: total,
                    card: selectedTopupCard.cardLast4,
                    toAccount: 'checking',
                    timestamp: serverTimestamp(),
                    status: 'success',
                    id: Math.random().toString(36).substr(2, 9)
                });

                hideLoading();

                // Show receipt
                const now = new Date();
                const dateStr = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });

                document.getElementById('receiptContent').innerHTML = `
                    <div class="receipt">
                        <div class="receipt-header">
                            <div class="receipt-logo">LEAD</div>
                            <h2>Top Up Receipt</h2>
                            <div class="receipt-status success">
                                <i class="fas fa-check-circle"></i>
                                Success
                            </div>
                        </div>
                        <div class="receipt-details">
                            <div class="summary-row">
                                <span class="receipt-label">Type</span>
                                <span class="receipt-value">Account Top Up</span>
                            </div>
                            <div class="summary-row">
                                <span class="receipt-label">Amount</span>
                                <span class="receipt-value">$${topupAmount.toFixed(2)}</span>
                            </div>
                            <div class="summary-row">
                                <span class="receipt-label">Card</span>
                                <span class="receipt-value">••••${selectedTopupCard.cardLast4}</span>
                            </div>
                            <div class="summary-row">
                                <span class="receipt-label">Fee (0.5%)</span>
                                <span class="receipt-value">$${fee.toFixed(2)}</span>
                            </div>
                            <div class="summary-row">
                                <span class="receipt-label">Total Charged</span>
                                <span class="receipt-value">$${total.toFixed(2)}</span>
                            </div>
                            <div class="summary-row">
                                <span class="receipt-label">To Account</span>
                                <span class="receipt-value">Checking</span>
                            </div>
                            <div class="summary-row">
                                <span class="receipt-label">Date</span>
                                <span class="receipt-value">${dateStr}</span>
                            </div>
                            <div class="summary-row">
                                <span class="receipt-label">Time</span>
                                <span class="receipt-value">${timeStr}</span>
                            </div>
                        </div>
                    </div>
                `;

                loadUserData();
                navigateTo('receipt');
            } catch (error) {
                hideLoading();
                showAlert('Error: ' + error.message, 'error');
            }
        };

        // Handle add card form in top-up
        document.getElementById('topupAddCardForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const cardType = document.getElementById('topupCardType').value;
            const cardName = document.getElementById('topupCardName').value;
            const cardNumber = document.getElementById('topupCardNumber').value;
            const cardExpiry = document.getElementById('topupCardExpiry').value;
            const cardCVC = document.getElementById('topupCardCVC').value;

            if (!cardType || !cardName || !cardNumber || !cardExpiry || !cardCVC) {
                showAlert('Please fill in all fields', 'error', 'topupAddCardAlert');
                return;
            }

            if (cardNumber.replace(/\D/g, '').length !== 16) {
                showAlert('Card number must be 16 digits', 'error', 'topupAddCardAlert');
                return;
            }

            if (!cardExpiry.match(/^\d{2}\/\d{2}$/)) {
                showAlert('Expiry must be in MM/YY format', 'error', 'topupAddCardAlert');
                return;
            }

            if (cardCVC.length !== 3) {
                showAlert('CVC must be 3 digits', 'error', 'topupAddCardAlert');
                return;
            }

            try {
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                const userData = userDoc.data();
                const cards = userData.cards || [];

                const colors = [
                    'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
                    'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
                    'linear-gradient(135deg, #fa709a 0%, #fee140 100%)'
                ];

                const newCard = {
                    id: Math.random().toString(36).substr(2, 9),
                    type: cardType,
                    last4: cardNumber.slice(-4),
                    name: cardName,
                    account: 'checking',
                    color: colors[cards.length % colors.length]
                };

                cards.push(newCard);

                await updateDoc(doc(db, 'users', currentUser.uid), {
                    cards: cards
                });

                showAlert('Card added successfully!', 'success', 'topupAddCardAlert');
                
                // Reset form and go back to card selection
                document.getElementById('topupAddCardForm').reset();
                selectedTopupCard = null;
                
                // Reload and navigate back
                setTimeout(() => {
                    loadTopupPage();
                }, 500);
            } catch (error) {
                showAlert('Error adding card: ' + error.message, 'error', 'topupAddCardAlert');
            }
        });

        window.openBuyCryptoPage = function() {
            const crypto = cryptoData[selectedCrypto];
            document.getElementById('buyCryptoName').textContent = crypto.name;
            document.getElementById('buyCryptoPrice').textContent = `$${crypto.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('buyCryptoUSD').value = '';
            document.getElementById('buyCryptoUSD').focus();
            updateBuyAccountDisplay();
            navigateTo('buyCrypto');
        };

        window.openSellCryptoPage = async function() {
            const crypto = cryptoData[selectedCrypto];
            const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
            const userData = userDoc.data();
            const holdings = userData.cryptoHoldings || {};
            
            document.getElementById('sellCryptoName').textContent = crypto.name;
            document.getElementById('sellCryptoSymbol').textContent = crypto.symbol;
            document.getElementById('sellCryptoPrice').textContent = `$${crypto.price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('sellCryptoHoldings').textContent = `${(holdings[selectedCrypto] || 0).toFixed(8)} ${selectedCrypto}`;
            document.getElementById('sellCryptoAmount').value = '';
            document.getElementById('sellCryptoAmount').focus();
            navigateTo('sellCrypto');
        };

        window.updateBuyCryptoCalculation = function() {
            try {
                const amountEl = document.getElementById('buyCryptoUSD');
                if (!amountEl || !selectedCrypto || !cryptoData[selectedCrypto]) return;
                
                const amount = parseFloat(amountEl.value) || 0;
                const crypto = cryptoData[selectedCrypto];
                const cryptoAmount = amount / crypto.price;
                const fee = amount * 0.015;
                const total = amount + fee;

                const buyCryptoAmount = document.getElementById('buyCryptoAmount');
                const buyCryptoFee = document.getElementById('buyCryptoFee');
                const buyCryptoTotal = document.getElementById('buyCryptoTotal');
                
                if (buyCryptoAmount) buyCryptoAmount.textContent = `${cryptoAmount.toFixed(8)} ${selectedCrypto}`;
                if (buyCryptoFee) buyCryptoFee.textContent = `$${fee.toFixed(2)}`;
                if (buyCryptoTotal) buyCryptoTotal.textContent = `$${total.toFixed(2)}`;
            } catch (error) {
                console.error('Error updating buy crypto calculation:', error);
            }
        };

        window.updateBuyAccountDisplay = async function() {
            try {
                const accountEl = document.getElementById('buyCryptoFromAccount');
                if (!accountEl || !currentUser) return;
                
                const account = accountEl.value;
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                const userData = userDoc.data();
                const balance = account === 'checking' ? userData.checkingBalance : userData.savingsBalance;
                
                const balanceEl = document.getElementById('buyCryptoBalance');
                if (balanceEl) balanceEl.textContent = `$${balance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            } catch (error) {
                console.error('Error updating buy account display:', error);
            }
        };

        window.updateSellCryptoCalculation = function() {
            try {
                const amountEl = document.getElementById('sellCryptoAmount');
                if (!amountEl || !selectedCrypto || !cryptoData[selectedCrypto]) return;
                
                const amount = parseFloat(amountEl.value) || 0;
                const crypto = cryptoData[selectedCrypto];
                const usdAmount = amount * crypto.price;
                const fee = usdAmount * 0.015;
                const receive = usdAmount - fee;

                const sellCryptoUSD = document.getElementById('sellCryptoUSD');
                const sellCryptoFee = document.getElementById('sellCryptoFee');
                const sellCryptoReceive = document.getElementById('sellCryptoReceive');
                
                if (sellCryptoUSD) sellCryptoUSD.textContent = `$${usdAmount.toFixed(2)}`;
                if (sellCryptoFee) sellCryptoFee.textContent = `$${fee.toFixed(2)}`;
                if (sellCryptoReceive) sellCryptoReceive.textContent = `$${receive.toFixed(2)}`;
            } catch (error) {
                console.error('Error updating sell crypto calculation:', error);
            }
        };

        // BUY CRYPTO FORM
        const buyCryptoFormEl = document.getElementById('buyCryptoForm');
        if (buyCryptoFormEl) {
            buyCryptoFormEl.addEventListener('submit', (e) => {
                e.preventDefault();
                try {
                    const amount = parseFloat(document.getElementById('buyCryptoUSD').value);
                    if (!amount || amount < 1) {
                        showAlert('Enter valid amount (minimum $1)', 'error', 'buyCryptoAlert');
                        return;
                    }
                    if (!selectedCrypto || !cryptoData[selectedCrypto]) {
                        showAlert('Please select a cryptocurrency', 'error', 'buyCryptoAlert');
                        return;
                    }
                    const crypto = cryptoData[selectedCrypto];
                    currentCryptoData = {
                        action: 'buy',
                        crypto: selectedCrypto,
                        usdAmount: amount,
                        cryptoAmount: amount / crypto.price,
                        price: crypto.price,
                        fee: amount * 0.015,
                        total: amount + (amount * 0.015),
                        fromAccount: document.getElementById('buyCryptoFromAccount').value
                    };
                    const confirmModal = document.getElementById('confirmationModal');
                    if (confirmModal) confirmModal.classList.add('active');
                    const pin1 = document.getElementById('pin1');
                    if (pin1) pin1.focus();
                } catch (error) {
                    showAlert('Error processing buy: ' + error.message, 'error', 'buyCryptoAlert');
                    console.error('Buy crypto error:', error);
                }
            });
        }

        // SELL CRYPTO FORM
        const sellCryptoFormEl = document.getElementById('sellCryptoForm');
        if (sellCryptoFormEl) {
            sellCryptoFormEl.addEventListener('submit', (e) => {
                e.preventDefault();
                try {
                    const amount = parseFloat(document.getElementById('sellCryptoAmount').value);
                    if (!amount || amount < 0) {
                        showAlert('Enter valid amount', 'error', 'sellCryptoAlert');
                        return;
                    }
                    if (!selectedCrypto || !cryptoData[selectedCrypto]) {
                        showAlert('Please select a cryptocurrency', 'error', 'sellCryptoAlert');
                        return;
                    }
                    const crypto = cryptoData[selectedCrypto];
                    const usdAmount = amount * crypto.price;
                    currentCryptoData = {
                        action: 'sell',
                        crypto: selectedCrypto,
                        cryptoAmount: amount,
                        usdAmount: usdAmount,
                        price: crypto.price,
                        fee: usdAmount * 0.015,
                        total: usdAmount - (usdAmount * 0.015),
                        toAccount: document.getElementById('sellCryptoToAccount').value
                    };
                    const confirmModal = document.getElementById('confirmationModal');
                    if (confirmModal) confirmModal.classList.add('active');
                    const pin1 = document.getElementById('pin1');
                    if (pin1) pin1.focus();
                } catch (error) {
                    showAlert('Error processing sell: ' + error.message, 'error', 'sellCryptoAlert');
                    console.error('Sell crypto error:', error);
                }
            });
        }

        // BANK TRANSFER FORM
        const bankTransferFormEl = document.getElementById('bankTransferForm');
        if (bankTransferFormEl) {
            bankTransferFormEl.addEventListener('submit', (e) => {
                e.preventDefault();
                try {
                    const amount = parseFloat(document.getElementById('bankTransferAmount').value);
                    if (!amount || amount < 1) {
                        showAlert('Enter valid amount', 'error', 'bankTransferAlert');
                        return;
                    }
                    const fee = amount * 0.015;
                    currentTransactionData = {
                        type: 'transfer',
                        recipientName: document.getElementById('bankTransferRecipient').value,
                        accountNumber: document.getElementById('bankTransferAccount').value,
                        recipientBank: document.getElementById('bankTransferBank').value,
                        amount: amount,
                        fee: fee,
                        total: amount + fee,
                        fromAccount: document.getElementById('bankTransferFromAccount').value
                    };
                    
                    // Show PIN confirmation modal
                    const confirmModal = document.getElementById('confirmationModal');
                    if (confirmModal) confirmModal.classList.add('active');
                    document.getElementById('pin1').value = '';
                    document.getElementById('pin2').value = '';
                    document.getElementById('pin3').value = '';
                    document.getElementById('pin4').value = '';
                    
                    let summary = `
                        <div class="summary-row">
                            <span>Recipient</span>
                            <span>${currentTransactionData.recipientName}</span>
                        </div>
                        <div class="summary-row">
                            <span>Bank</span>
                            <span>${currentTransactionData.recipientBank}</span>
                        </div>
                        <div class="summary-row">
                            <span>Account</span>
                            <span>${currentTransactionData.accountNumber}</span>
                        </div>
                        <div class="summary-row">
                            <span>Amount</span>
                            <span>$${amount.toFixed(2)}</span>
                        </div>
                        <div class="summary-row">
                            <span>Fee (1.5%)</span>
                            <span>$${fee.toFixed(2)}</span>
                        </div>
                        <div class="summary-row">
                            <span>Total</span>
                            <span>$${(amount + fee).toFixed(2)}</span>
                        </div>
                    `;
                    
                    document.getElementById('confirmationSummary').innerHTML = summary;
                    document.getElementById('confirmationModal').querySelector('.modal-title').textContent = 'Confirm Transfer';
                    
                    createDialPad();
                    const pin1 = document.getElementById('pin1');
                    if (pin1) pin1.focus();
                } catch (error) {
                    showAlert('Error processing transfer: ' + error.message, 'error', 'bankTransferAlert');
                    console.error('Bank transfer error:', error);
                }
            });
        }

        // WIRE TRANSFER FORM
        const wireTransferFormEl = document.getElementById('wireTransferForm');
        if (wireTransferFormEl) {
            wireTransferFormEl.addEventListener('submit', (e) => {
                e.preventDefault();
                try {
                    const amount = parseFloat(document.getElementById('wireAmount').value);
                    if (!amount || amount < 1) {
                        showAlert('Enter valid amount', 'error', 'wireTransferAlert');
                        return;
                    }
                    const fee = amount * 0.025;
                    currentTransactionData = {
                        type: 'wire',
                        recipientName: document.getElementById('wireRecipient').value,
                        recipientAddress: document.getElementById('wireRecipientAddress').value,
                        country: document.getElementById('wireCountry').value,
                        recipientBank: document.getElementById('wireBank').value,
                        bankAddress: document.getElementById('wireBankAddress').value,
                        swiftCode: document.getElementById('wireSwiftCode').value,
                        accountNumber: document.getElementById('wireAccount').value,
                        amount: amount,
                        fee: fee,
                        total: amount + fee,
                        fromAccount: document.getElementById('wireFromAccount').value
                    };
                    
                    // Show PIN confirmation modal
                    const confirmModal = document.getElementById('confirmationModal');
                    if (confirmModal) confirmModal.classList.add('active');
                    document.getElementById('pin1').value = '';
                    document.getElementById('pin2').value = '';
                    document.getElementById('pin3').value = '';
                    document.getElementById('pin4').value = '';
                    
                    let summary = `
                        <div class="summary-row">
                            <span>Recipient</span>
                            <span>${currentTransactionData.recipientName}</span>
                        </div>
                        <div class="summary-row">
                            <span>Country</span>
                            <span>${currentTransactionData.country}</span>
                        </div>
                        <div class="summary-row">
                            <span>Bank</span>
                            <span>${currentTransactionData.recipientBank}</span>
                        </div>
                        <div class="summary-row">
                            <span>SWIFT Code</span>
                            <span>${currentTransactionData.swiftCode}</span>
                        </div>
                        <div class="summary-row">
                            <span>Amount</span>
                            <span>$${amount.toFixed(2)}</span>
                        </div>
                        <div class="summary-row">
                            <span>Fee (2.5%)</span>
                            <span>$${fee.toFixed(2)}</span>
                        </div>
                        <div class="summary-row">
                            <span>Total</span>
                            <span>$${(amount + fee).toFixed(2)}</span>
                        </div>
                    `;
                    
                    document.getElementById('confirmationSummary').innerHTML = summary;
                    document.getElementById('confirmationModal').querySelector('.modal-title').textContent = 'Confirm Wire Transfer';
                    
                    createDialPad();
                    const pin1 = document.getElementById('pin1');
                    if (pin1) pin1.focus();
                } catch (error) {
                    showAlert('Error processing wire: ' + error.message, 'error', 'wireTransferAlert');
                    console.error('Wire transfer error:', error);
                }
            });
        }

        // INTERNAL TRANSFER FORM
        const internalTransferFormEl = document.getElementById('internalTransferForm');
        if (internalTransferFormEl) {
            internalTransferFormEl.addEventListener('submit', (e) => {
                e.preventDefault();
                try {
                    const amount = parseFloat(document.getElementById('internalTransferAmount').value);
                    const fromAccount = document.getElementById('internalFromAccount').value;
                    const toAccount = document.getElementById('internalToAccount').value;
                    
                    if (!amount || amount < 0.01) {
                        showAlert('Enter valid amount', 'error', 'internalTransferAlert');
                        return;
                    }
                    
                    if (fromAccount === toAccount) {
                        showAlert('Please select different accounts', 'error', 'internalTransferAlert');
                        return;
                    }
                    
                    currentTransactionData = {
                        type: 'internalTransfer',
                        fromAccount: fromAccount,
                        toAccount: toAccount,
                        amount: amount,
                        fee: 0,
                        total: amount
                    };
                    
                    const confirmModal = document.getElementById('confirmationModal');
                    if (confirmModal) confirmModal.classList.add('active');
                    document.getElementById('pin1').value = '';
                    document.getElementById('pin2').value = '';
                    document.getElementById('pin3').value = '';
                    document.getElementById('pin4').value = '';
                    
                    let summary = `
                        <div class="summary-row">
                            <span>From</span>
                            <span>${fromAccount.charAt(0).toUpperCase() + fromAccount.slice(1)}</span>
                        </div>
                        <div class="summary-row">
                            <span>To</span>
                            <span>${toAccount.charAt(0).toUpperCase() + toAccount.slice(1)}</span>
                        </div>
                        <div class="summary-row">
                            <span>Amount</span>
                            <span>$${amount.toFixed(2)}</span>
                        </div>
                        <div class="summary-row">
                            <span>Fee</span>
                            <span>Free</span>
                        </div>
                        <div class="summary-row">
                            <span>Total</span>
                            <span>$${amount.toFixed(2)}</span>
                        </div>
                    `;
                    
                    document.getElementById('confirmationSummary').innerHTML = summary;
                    document.getElementById('confirmationModal').querySelector('.modal-title').textContent = 'Confirm Transfer';
                    
                    createDialPad();
                    const pin1 = document.getElementById('pin1');
                    if (pin1) pin1.focus();
                } catch (error) {
                    showAlert('Error processing transfer: ' + error.message, 'error', 'internalTransferAlert');
                    console.error('Internal transfer error:', error);
                }
            });
        }

        // LOAD CREDCRYPT TRANSFER BALANCE
        window.loadCredcryptTransferBalance = async function() {
            try {
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                const userData = userDoc.data();
                const balance = userData.checkingBalance || 0;
                document.getElementById('credcryptAvailableBalance').textContent = `$${balance.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            } catch (error) {
                console.error('Error loading balance:', error);
                document.getElementById('credcryptAvailableBalance').textContent = '$0.00';
            }
        };

        // LOOKUP CREDCRYPT USER
        window.lookupCredcryptUser = async function() {
            const accountNumber = document.getElementById('credcryptRecipientAccount').value.trim();
            const displayDiv = document.getElementById('credcryptRecipientNameDisplay');
            const nameDiv = document.getElementById('credcryptRecipientName');
            
            if (!accountNumber || accountNumber.length !== 10) {
                displayDiv.style.display = 'none';
                return;
            }
            
            try {
                const usersRef = collection(db, 'users');
                const q = query(usersRef, where('accountNumber', '==', parseInt(accountNumber)));
                const snapshot = await getDocs(q);
                
                if (snapshot.empty) {
                    displayDiv.style.display = 'none';
                    showAlert('Account not found', 'error', 'credcryptTransferAlert');
                } else {
                    const userData = snapshot.docs[0].data();
                    nameDiv.textContent = userData.firstName + ' ' + userData.surname;
                    displayDiv.style.display = 'block';
                    document.getElementById('credcryptTransferAlert').classList.remove('show');
                }
            } catch (error) {
                console.error('Error looking up user:', error);
                displayDiv.style.display = 'none';
                showAlert('Error looking up account', 'error', 'credcryptTransferAlert');
            }
        };

        // CREDCRYPT TRANSFER FORM
        const credcryptTransferFormEl = document.getElementById('credcryptTransferForm');
        if (credcryptTransferFormEl) {
            credcryptTransferFormEl.addEventListener('submit', async (e) => {
                e.preventDefault();
                try {
                    const recipientAccount = document.getElementById('credcryptRecipientAccount').value.trim();
                    const amount = parseFloat(document.getElementById('credcryptAmount').value);
                    
                    if (!recipientAccount || recipientAccount.length !== 10) {
                        showAlert('Enter valid account number', 'error', 'credcryptTransferAlert');
                        return;
                    }
                    
                    if (!amount || amount < 0.01) {
                        showAlert('Enter valid amount', 'error', 'credcryptTransferAlert');
                        return;
                    }
                    
                    // Verify recipient exists
                    const usersRef = collection(db, 'users');
                    const q = query(usersRef, where('accountNumber', '==', parseInt(recipientAccount)));
                    const snapshot = await getDocs(q);
                    
                    if (snapshot.empty) {
                        showAlert('Recipient account not found', 'error', 'credcryptTransferAlert');
                        return;
                    }
                    
                    const recipientUid = snapshot.docs[0].id;
                    if (recipientUid === currentUser.uid) {
                        showAlert('You cannot send money to yourself', 'error', 'credcryptTransferAlert');
                        return;
                    }
                    
                    const recipientData = snapshot.docs[0].data();
                    
                    currentTransactionData = {
                        type: 'credcryptTransfer',
                        recipientName: recipientData.firstName + ' ' + recipientData.surname,
                        recipientAccount: recipientAccount,
                        recipientUid: snapshot.docs[0].id,
                        amount: amount,
                        fee: 0,
                        total: amount,
                        fromAccount: 'checking'
                    };
                    
                    const confirmModal = document.getElementById('confirmationModal');
                    if (confirmModal) confirmModal.classList.add('active');
                    document.getElementById('pin1').value = '';
                    document.getElementById('pin2').value = '';
                    document.getElementById('pin3').value = '';
                    document.getElementById('pin4').value = '';
                    
                    let summary = `
                        <div class="summary-row">
                            <span>Recipient</span>
                            <span>${recipientData.firstName} ${recipientData.surname}</span>
                        </div>
                        <div class="summary-row">
                            <span>Account</span>
                            <span>${recipientAccount}</span>
                        </div>
                        <div class="summary-row">
                            <span>Amount</span>
                            <span>$${amount.toFixed(2)}</span>
                        </div>
                        <div class="summary-row">
                            <span>Fee</span>
                            <span>Free</span>
                        </div>
                        <div class="summary-row">
                            <span>Total</span>
                            <span>$${amount.toFixed(2)}</span>
                        </div>
                    `;
                    
                    document.getElementById('confirmationSummary').innerHTML = summary;
                    document.getElementById('confirmationModal').querySelector('.modal-title').textContent = 'Confirm Transfer';
                    
                    createDialPad();
                    const pin1 = document.getElementById('pin1');
                    if (pin1) pin1.focus();
                } catch (error) {
                    showAlert('Error processing transfer: ' + error.message, 'error', 'credcryptTransferAlert');
                    console.error('LEAD transfer error:', error);
                }
            });
        }

        // WITHDRAW TYPE SELECTION
        window.selectWithdrawType = function(type) {
            if (type === 'card') {
                navigateTo('withdrawCard');
                loadWithdrawCards();
            } else {
                navigateTo('withdrawBank');
            }
        };

        async function loadWithdrawCards() {
            const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
            const userData = userDoc.data();
            const cards = userData.cards || [];
            
            const container = document.getElementById('withdrawCardsContainer');
            container.innerHTML = cards.map(card => `
                <div class="glass-card" onclick="selectWithdrawCard('${card.last4}')" style="background: ${card.color}; color: white; padding: 20px; cursor: pointer; border: 3px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='white';" onmouseout="this.style.borderColor='transparent';">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <div>
                            <div style="font-size: 12px; opacity: 0.9;">CARD</div>
                            <div style="font-size: 14px; font-weight: 600; margin-top: 5px;">${card.type.toUpperCase()}</div>
                        </div>
                        <i class="fas fa-credit-card" style="font-size: 24px;"></i>
                    </div>
                    <div style="font-size: 18px; letter-spacing: 2px;">•••• •••• •••• ${card.last4}</div>
                </div>
            `).join('');
        }

        window.selectWithdrawCard = function(last4) {
            selectedTopupCard = { cardLast4: last4 };
        };

        // WITHDRAW TO CARD FORM
        document.getElementById('withdrawCardForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const amount = parseFloat(document.getElementById('withdrawCardAmount').value);
            if (!amount || amount < 1) {
                showAlert('Enter valid amount', 'error', 'withdrawCardAlert');
                return;
            }
            if (!selectedTopupCard) {
                showAlert('Select a card', 'error', 'withdrawCardAlert');
                return;
            }
            const fromAccount = document.getElementById('withdrawCardFromAccount').value;
            const fee = amount * 0.015;
            currentTransactionData = {
                type: 'withdraw',
                bankName: 'Card ending in ' + selectedTopupCard.cardLast4,
                accountNumber: selectedTopupCard.cardLast4,
                amount: amount,
                fee: fee,
                total: amount + fee,
                fromAccount: fromAccount
            };
            
            // Show PIN confirmation modal
            const confirmModal = document.getElementById('confirmationModal');
            if (confirmModal) confirmModal.classList.add('active');
            document.getElementById('pin1').value = '';
            document.getElementById('pin2').value = '';
            document.getElementById('pin3').value = '';
            document.getElementById('pin4').value = '';
            
            let summary = `
                <div class="summary-row">
                    <span>Withdraw To</span>
                    <span>Card ••••${selectedTopupCard.cardLast4}</span>
                </div>
                <div class="summary-row">
                    <span>From Account</span>
                    <span>${fromAccount.charAt(0).toUpperCase() + fromAccount.slice(1)}</span>
                </div>
                <div class="summary-row">
                    <span>Amount</span>
                    <span>$${amount.toFixed(2)}</span>
                </div>
                <div class="summary-row">
                    <span>Fee (1.5%)</span>
                    <span>$${fee.toFixed(2)}</span>
                </div>
                <div class="summary-row">
                    <span>Total</span>
                    <span>$${(amount + fee).toFixed(2)}</span>
                </div>
            `;
            
            document.getElementById('confirmationSummary').innerHTML = summary;
            document.getElementById('confirmationModal').querySelector('.modal-title').textContent = 'Confirm Withdrawal';
            
            createDialPad();
            const pin1El = document.getElementById('pin1');
            if (pin1El) pin1El.focus();
        });

        // WITHDRAW TO BANK FORM
        document.getElementById('withdrawBankForm').addEventListener('submit', (e) => {
            e.preventDefault();
            try {
                const amount = parseFloat(document.getElementById('withdrawBankAmount').value);
                if (!amount || amount < 1) {
                    showAlert('Enter valid amount', 'error', 'withdrawBankAlert');
                    return;
                }
                const fee = amount * 0.015;
                currentTransactionData = {
                    type: 'withdraw',
                    bankName: document.getElementById('withdrawBankName').value,
                    accountNumber: document.getElementById('withdrawBankAccount').value,
                    amount: amount,
                    fee: fee,
                    total: amount + fee,
                    fromAccount: document.getElementById('withdrawBankFromAccount').value
                };
                
                // Show PIN confirmation modal
                const confirmModal = document.getElementById('confirmationModal');
                if (confirmModal) confirmModal.classList.add('active');
                document.getElementById('pin1').value = '';
                document.getElementById('pin2').value = '';
                document.getElementById('pin3').value = '';
                document.getElementById('pin4').value = '';
                
                let summary = `
                    <div class="summary-row">
                        <span>Withdraw To</span>
                        <span>${currentTransactionData.bankName}</span>
                    </div>
                    <div class="summary-row">
                        <span>Account</span>
                        <span>${currentTransactionData.accountNumber}</span>
                    </div>
                    <div class="summary-row">
                        <span>From Account</span>
                        <span>${currentTransactionData.fromAccount.charAt(0).toUpperCase() + currentTransactionData.fromAccount.slice(1)}</span>
                    </div>
                    <div class="summary-row">
                        <span>Amount</span>
                        <span>$${amount.toFixed(2)}</span>
                    </div>
                    <div class="summary-row">
                        <span>Fee (1.5%)</span>
                        <span>$${fee.toFixed(2)}</span>
                    </div>
                    <div class="summary-row">
                        <span>Total</span>
                        <span>$${(amount + fee).toFixed(2)}</span>
                    </div>
                `;
                
                document.getElementById('confirmationSummary').innerHTML = summary;
                document.getElementById('confirmationModal').querySelector('.modal-title').textContent = 'Confirm Withdrawal';
                
                createDialPad();
                const pin1El = document.getElementById('pin1');
                if (pin1El) pin1El.focus();
            } catch (error) {
                showAlert('Error processing withdrawal: ' + error.message, 'error', 'withdrawBankAlert');
                console.error('Withdraw error:', error);
            }
        });


        setInterval(() => {
            if (document.getElementById('cryptoPage').classList.contains('active')) {
                loadCryptoData();
            }
        }, 30000);

        // UPGRADE FLOW FUNCTIONS
        let step1FaceFile = null;
        let step1IDFile = null;
        let uploadedAddressFile = null;
        let step1Completed = false;
        let step2Completed = false;

        window.loadVerificationStatus = async function() {
            if (!currentUser) return;
            try {
                const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                const userData = userDoc.data();
                
                if (userData?.step1Completed) {
                    step1Completed = true;
                    document.getElementById('step1Badge').style.background = 'linear-gradient(135deg, #10b981 0%, #0f9668 100%)';
                    document.getElementById('step1Check').style.display = 'block';
                    document.getElementById('step1Number').style.display = 'none';
                    document.getElementById('step2Card').style.opacity = '1';
                    document.getElementById('step2Hint').textContent = 'Click to continue →';
                }
                
                if (userData?.step2Completed) {
                    step2Completed = true;
                    document.getElementById('step2Badge').style.background = 'linear-gradient(135deg, #10b981 0%, #0f9668 100%)';
                    document.getElementById('step2Check').style.display = 'block';
                    document.getElementById('step2Number').style.display = 'none';
                    document.getElementById('step3Card').style.opacity = '1';
                    document.getElementById('step3Hint').textContent = 'Click to complete →';
                }
            } catch (error) {
                console.log('Verification status loaded');
            }
        };


        window.handleStep1FaceUpload = function() {
            const input = document.getElementById('step1FaceInput');
            if (input.files.length > 0) {
                step1FaceFile = input.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('step1FaceImage').src = e.target.result;
                    document.getElementById('step1FacePreview').style.display = 'block';
                    if (step1IDFile) {
                        document.getElementById('step1SaveBtn').style.display = 'block';
                    }
                };
                reader.readAsDataURL(step1FaceFile);
            }
        };

        window.handleStep1IDUpload = function() {
            const input = document.getElementById('step1IDInput');
            if (input.files.length > 0) {
                step1IDFile = input.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('step1IDImage').src = e.target.result;
                    document.getElementById('step1IDPreview').style.display = 'block';
                    if (step1FaceFile) {
                        document.getElementById('step1SaveBtn').style.display = 'block';
                    }
                };
                reader.readAsDataURL(step1IDFile);
            }
        };

        window.uploadStep1Face = async function() {
            if (!step1FaceFile || !currentUser) {
                showAlert('Please select a face photo', 'error');
                return;
            }
            try {
                showAlert('Uploading face photo...', 'info');
                const faceRef = ref(storage, `verifications/${currentUser.uid}/face-${Date.now()}.jpg`);
                await uploadBytes(faceRef, step1FaceFile);
                const faceUrl = await getDownloadURL(faceRef);
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    face_verified: true,
                    faceImageUrl: faceUrl,
                    faceUploadedAt: serverTimestamp()
                });
                showAlert('Face photo saved!', 'success');
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        };

        window.uploadStep1ID = async function() {
            if (!step1IDFile || !currentUser) {
                showAlert('Please select an ID card', 'error');
                return;
            }
            try {
                showAlert('Uploading ID card...', 'info');
                const idRef = ref(storage, `verifications/${currentUser.uid}/id-${Date.now()}.${step1IDFile.name.split('.').pop()}`);
                await uploadBytes(idRef, step1IDFile);
                const idUrl = await getDownloadURL(idRef);
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    id_verified: true,
                    idDocumentUrl: idUrl,
                    idUploadedAt: serverTimestamp(),
                    step1Completed: true
                });
                step1Completed = true;
                document.getElementById('step1Badge').style.background = 'linear-gradient(135deg, #10b981 0%, #0f9668 100%)';
                document.getElementById('step1Check').style.display = 'block';
                document.getElementById('step1Number').style.display = 'none';
                setTimeout(() => {
                    showAlert('Step 1 complete! ✓', 'success');
                    document.getElementById('step2Badge').style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                }, 500);
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        };

        window.startFaceCamera = async function() {
            try {
                showAlert('Opening camera...', 'info');
                const video = document.getElementById('faceVerificationVideo');
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'user', width: { ideal: 1280 }, height: { ideal: 720 } },
                    audio: false
                });
                
                upgradeFlowFaceStream = stream;
                video.srcObject = stream;
                video.style.display = 'block';
                
                video.onloadedmetadata = function() {
                    video.play();
                    showAlert('Camera ready', 'success');
                };
                
                document.getElementById('startCameraBtn').style.display = 'none';
                document.getElementById('cameraControlsDiv').style.display = 'flex';
                
            } catch (permissionError) {
                showAlert('Camera permission denied', 'error');
                console.error('Camera error:', permissionError);
            }
        };

        window.captureFace = function() {
            const video = document.getElementById('faceVerificationVideo');
            const previewCanvas = document.getElementById('facePreviewCanvas');
            previewCanvas.width = video.videoWidth;
            previewCanvas.height = video.videoHeight;
            previewCanvas.getContext('2d').drawImage(video, 0, 0);
            
            const canvas = document.getElementById('faceVerificationCanvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            if (upgradeFlowFaceStream) {
                upgradeFlowFaceStream.getTracks().forEach(track => track.stop());
                upgradeFlowFaceStream = null;
            }
            
            faceCaptured = true;
            video.style.display = 'none';
            document.getElementById('faceCapturePreview').style.display = 'block';
            document.getElementById('cameraControlsDiv').style.display = 'none';
            document.getElementById('startCameraBtn').style.display = 'block';
            document.getElementById('uploadFaceBtn').style.display = 'block';
        };

        window.stopFaceCamera = function() {
            if (upgradeFlowFaceStream) {
                upgradeFlowFaceStream.getTracks().forEach(track => track.stop());
                upgradeFlowFaceStream = null;
            }
            document.getElementById('faceVerificationVideo').style.display = 'none';
            document.getElementById('cameraControlsDiv').style.display = 'none';
            document.getElementById('startCameraBtn').style.display = 'block';
        };

        window.handleFaceFileUpload = function() {
            const input = document.getElementById('faceFileInput');
            if (input.files.length > 0) {
                const file = input.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.getElementById('facePreviewCanvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        canvas.getContext('2d').drawImage(img, 0, 0);
                        
                        const mainCanvas = document.getElementById('faceVerificationCanvas');
                        mainCanvas.width = img.width;
                        mainCanvas.height = img.height;
                        mainCanvas.getContext('2d').drawImage(img, 0, 0);
                        
                        faceCaptured = true;
                        document.getElementById('faceCapturePreview').style.display = 'block';
                        document.getElementById('startCameraBtn').style.display = 'block';
                        document.getElementById('uploadFaceBtn').style.display = 'block';
                        showAlert('Photo ready to upload', 'success');
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        };
        
        window.uploadFaceCaptured = async function() {
            if (!faceCaptured) {
                showAlert('No photo captured', 'error');
                return;
            }
            if (!currentUser) {
                showAlert('Please login first', 'error');
                return;
            }
            try {
                showAlert('Uploading photo...', 'info');
                const faceCanvas = document.getElementById('faceVerificationCanvas');
                const faceBlob = await new Promise(resolve => faceCanvas.toBlob(resolve, 'image/jpeg', 0.9));
                const faceRef = ref(storage, `verifications/${currentUser.uid}/face-${Date.now()}.jpg`);
                await uploadBytes(faceRef, faceBlob);
                const faceImageUrl = await getDownloadURL(faceRef);
                
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    face_verified: true,
                    faceImageUrl: faceImageUrl,
                    faceUploadedAt: serverTimestamp()
                });
                
                faceUploadedToFirebase = true;
                document.getElementById('uploadFaceBtn').style.display = 'none';
                document.getElementById('faceCapturePreview').style.display = 'none';
                document.getElementById('startCameraBtn').style.display = 'block';
                showAlert('Face photo saved to Firebase!', 'success');
                console.log('Face uploaded successfully');
            } catch (error) {
                console.error('Face upload error:', error);
                showAlert('Upload failed: ' + error.message, 'error');
            }
        };

        window.handleIDUpload = function() {
            const input = document.getElementById('idUploadInput');
            if (input.files.length > 0) {
                uploadedIdFile = input.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('idPreviewImage').src = e.target.result;
                    document.getElementById('idUploadPreview').style.display = 'block';
                    document.getElementById('uploadIDBtn').style.display = 'block';
                };
                reader.readAsDataURL(uploadedIdFile);
            }
        };

        window.uploadIDCard = async function() {
            if (!uploadedIdFile) {
                showAlert('Please select an ID card', 'error');
                return;
            }
            if (!currentUser) {
                showAlert('Please login first', 'error');
                return;
            }
            try {
                showAlert('Uploading ID card...', 'info');
                const idRef = ref(storage, `verifications/${currentUser.uid}/id-${Date.now()}.${uploadedIdFile.name.split('.').pop()}`);
                await uploadBytes(idRef, uploadedIdFile);
                const idDocumentUrl = await getDownloadURL(idRef);
                
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    id_verified: true,
                    idDocumentUrl: idDocumentUrl,
                    idUploadedAt: serverTimestamp(),
                    step1Completed: true
                });
                
                idUploadedToFirebase = true;
                step1Completed = true;
                document.getElementById('uploadIDBtn').style.display = 'none';
                document.getElementById('step1MainContent').style.display = 'none';
                document.getElementById('step1Badge').style.background = '#10b981';
                document.getElementById('step1Check').style.display = 'block';
                document.getElementById('step1Number').style.display = 'none';
                
                setTimeout(() => {
                    document.getElementById('step2Card').style.opacity = '0.8';
                    document.getElementById('step2Card').style.pointerEvents = 'auto';
                    document.getElementById('step2Card').style.cursor = 'pointer';
                }, 300);
                
                showAlert('Step 1 saved! ✓ Click Step 2 to continue', 'success');
                console.log('ID uploaded - Step 2 is now clickable');
            } catch (error) {
                console.error('ID upload error:', error);
                showAlert('Upload failed: ' + error.message, 'error');
            }
        };

        window.handleAddressUpload = function() {
            const input = document.getElementById('addressUploadInput');
            if (input.files.length > 0) {
                uploadedAddressFile = input.files[0];
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('addressPreviewImage').src = e.target.result;
                    document.getElementById('addressUploadPreview').style.display = 'block';
                    document.getElementById('uploadAddressBtn').style.display = 'block';
                };
                reader.readAsDataURL(uploadedAddressFile);
            }
        };

        window.uploadAddressDoc = async function() {
            const docType = document.getElementById('addressDocType').value;
            if (!docType || !uploadedAddressFile || !currentUser) {
                showAlert('Select document type and file', 'error');
                return;
            }
            try {
                showAlert('Uploading document...', 'info');
                const addressRef = ref(storage, `verifications/${currentUser.uid}/address-${Date.now()}.${uploadedAddressFile.name.split('.').pop()}`);
                await uploadBytes(addressRef, uploadedAddressFile);
                const addressDocumentUrl = await getDownloadURL(addressRef);
                
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    address_verified: true,
                    addressDocumentUrl: addressDocumentUrl,
                    addressDocType: docType,
                    addressUploadedAt: serverTimestamp(),
                    step2Completed: true
                });
                
                step2Completed = true;
                document.getElementById('uploadAddressBtn').style.display = 'none';
                document.getElementById('addressUploadPreview').style.display = 'none';
                
                setTimeout(() => {
                    document.getElementById('step2Badge').style.background = 'linear-gradient(135deg, #10b981 0%, #0f9668 100%)';
                    document.getElementById('step2Check').style.display = 'block';
                    document.getElementById('step2Number').style.display = 'none';
                    document.getElementById('step3Badge').style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    showAlert('Step 2 complete! ✓', 'success');
                }, 500);
            } catch (error) {
                showAlert('Upload failed: ' + error.message, 'error');
            }
        };

        window.saveStep1Complete = async function() {
            try {
                if (!step1FaceFile) {
                    alert('Please upload face photo');
                    return;
                }
                if (!step1IDFile) {
                    alert('Please upload ID card');
                    return;
                }
                if (!currentUser) {
                    alert('Not logged in. Please log in first.');
                    return;
                }
                
                const btn = document.getElementById('step1SaveBtn');
                btn.disabled = true;
                btn.textContent = 'Uploading...';
                
                console.log('Starting Step 1 upload for user:', currentUser.uid);
                
                // Save verification data to Firestore
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    face_verified: true,
                    faceFileName: step1FaceFile.name,
                    id_verified: true,
                    idFileName: step1IDFile.name,
                    step1Completed: true,
                    step1CompletedAt: serverTimestamp()
                });
                
                console.log('Step 1 saved to Firebase');
                
                step1Completed = true;
                document.getElementById('step1Badge').style.background = 'linear-gradient(135deg, #10b981 0%, #0f9668 100%)';
                document.getElementById('step1Check').style.display = 'block';
                document.getElementById('step1Number').style.display = 'none';
                document.getElementById('step1SaveBtn').style.display = 'none';
                
                alert('✓ Step 1 Verified! Face and ID confirmed. Moving to Step 2...');
                
                // Update step 2 badge
                setTimeout(() => {
                    document.getElementById('step2Badge').style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    document.getElementById('step2Card').style.opacity = '1';
                    document.getElementById('step2Card').style.pointerEvents = 'auto';
                    navigateTo('upgrade');
                }, 500);
                
            } catch (error) {
                console.error('Step 1 error:', error);
                alert('Upload failed: ' + error.message);
                const btn = document.getElementById('step1SaveBtn');
                btn.disabled = false;
                btn.textContent = 'Upload & Continue';
            }
        };

        window.saveStep2Complete = async function() {
            try {
                if (!uploadedAddressFile) {
                    alert('Please select a document');
                    return;
                }
                if (!currentUser) {
                    alert('Not logged in. Please log in first.');
                    return;
                }
                
                const btn = document.getElementById('uploadAddressBtn');
                btn.disabled = true;
                btn.textContent = 'Uploading...';
                
                console.log('Starting Step 2 upload for user:', currentUser.uid);
                
                // Save verification data to Firestore
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    address_verified: true,
                    addressFileName: uploadedAddressFile.name,
                    addressDocType: document.getElementById('addressDocType').value,
                    step2Completed: true,
                    step2CompletedAt: serverTimestamp()
                });
                
                console.log('Step 2 saved to Firebase');
                
                step2Completed = true;
                document.getElementById('step2Badge').style.background = 'linear-gradient(135deg, #10b981 0%, #0f9668 100%)';
                document.getElementById('step2Check').style.display = 'block';
                document.getElementById('step2Number').style.display = 'none';
                document.getElementById('uploadAddressBtn').style.display = 'none';
                
                alert('✓ Step 2 Verified! Address confirmed. Moving to Step 3...');
                
                // Update step 3 badge
                setTimeout(() => {
                    document.getElementById('step3Badge').style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    document.getElementById('step3Card').style.opacity = '1';
                    document.getElementById('step3Card').style.pointerEvents = 'auto';
                    navigateTo('upgrade');
                }, 500);
                
            } catch (error) {
                console.error('Step 2 error:', error);
                alert('Upload failed: ' + error.message);
                const btn = document.getElementById('uploadAddressBtn');
                btn.disabled = false;
                btn.textContent = 'Upload & Continue';
            }
        };

        window.showDepositMethodDialog = function() {
            const modal = document.getElementById('depositMethodModal');
            modal.style.display = 'flex';
        };

        window.closeDepositMethodDialog = function() {
            const modal = document.getElementById('depositMethodModal');
            modal.style.display = 'none';
        };

        window.selectDepositMethod = async function(method) {
            if (method === 'direct_deposit') {
                closeDepositMethodDialog();
                
                // Load user's name and generate random direct deposit number
                if (currentUser) {
                    try {
                        const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                        if (userDoc.exists()) {
                            const userData = userDoc.data();
                            const userName = userData.firstName && userData.surname 
                                ? `${userData.firstName} ${userData.surname}` 
                                : (userData.fullName || userData.name || 'User Account');
                            
                            // Generate random 12-digit direct deposit number with US prefix (14 chars total)
                            const randomDirectDepositNumber = 'US' + Math.floor(Math.random() * 999999999999).toString().padStart(12, '0');
                            
                            document.getElementById('directDepositUserName').textContent = userName;
                            document.getElementById('directDepositNumberText').textContent = randomDirectDepositNumber;
                            document.getElementById('directDepositAccountNameText').textContent = userName;
                        }
                    } catch (error) {
                        console.error('Error loading user details:', error);
                        const randomDirectDepositNumber = 'US' + Math.floor(Math.random() * 999999999999).toString().padStart(12, '0');
                        document.getElementById('directDepositUserName').textContent = 'User Account';
                        document.getElementById('directDepositNumberText').textContent = randomDirectDepositNumber;
                        document.getElementById('directDepositAccountNameText').textContent = 'User Account';
                    }
                }
                
                setTimeout(() => {
                    document.getElementById('directDepositModal').style.display = 'flex';
                }, 200);
            } else if (method === 'user_transfer') {
                closeDepositMethodDialog();
                
                // Load user's name and account number from Firebase
                if (currentUser) {
                    try {
                        const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
                        if (userDoc.exists()) {
                            const userData = userDoc.data();
                            const userName = userData.firstName && userData.surname 
                                ? `${userData.firstName} ${userData.surname}` 
                                : (userData.fullName || userData.name || 'User Account');
                            const accountNumber = userData.accountNumber 
                                ? userData.accountNumber.toString().padStart(10, '0') 
                                : 'CC-0000000000';
                            
                            document.getElementById('accountHolderNameText').textContent = userName;
                            document.getElementById('accountNumberText').textContent = accountNumber;
                            document.getElementById('modalUserName').textContent = userName;
                        }
                    } catch (error) {
                        console.error('Error loading user details:', error);
                        document.getElementById('accountHolderNameText').textContent = 'User Account';
                        document.getElementById('accountNumberText').textContent = 'CC-0000000000';
                        document.getElementById('modalUserName').textContent = 'User Account';
                    }
                }
                
                setTimeout(() => {
                    document.getElementById('accountDetailsModal').style.display = 'flex';
                }, 200);
            }
        };

        window.closeAccountDetailsModal = function() {
            const modal = document.getElementById('accountDetailsModal');
            modal.style.display = 'none';
        };

        window.showDirectDepositModal = function() {
            const modal = document.getElementById('directDepositModal');
            modal.style.display = 'flex';
        };

        window.closeDirectDepositModal = function() {
            const modal = document.getElementById('directDepositModal');
            modal.style.display = 'none';
        };

        window.copyToClipboard = function(text) {
            navigator.clipboard.writeText(text).then(() => {
                const toast = document.createElement('div');
                toast.textContent = 'Copied to clipboard!';
                toast.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #10b981; color: white; padding: 12px 20px; border-radius: 8px; z-index: 2000; font-size: 14px;';
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 2000);
            });
        };

        window.confirmDepositReceived = async function() {
            try {
                if (!currentUser) {
                    alert('Not logged in. Please log in first.');
                    return;
                }
                
                const btn = document.querySelector('#accountDetailsModal .btn-primary');
                btn.disabled = true;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right: 8px;"></i> Processing...';
                
                console.log('Confirming Step 3 deposit for user:', currentUser.uid);
                
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    deposit_verified: true,
                    minimumDepositAmount: 150,
                    depositMethod: 'user_transfer',
                    depositDate: serverTimestamp(),
                    step3Completed: true,
                    accountVerified: true,
                    verificationCompleted: serverTimestamp()
                });
                
                console.log('Step 3 deposit confirmed in Firebase');
                
                closeAccountDetailsModal();
                
                // Update Step 3 UI
                document.getElementById('step3Badge').style.background = 'linear-gradient(135deg, #10b981 0%, #0f9668 100%)';
                document.getElementById('step3Check').style.display = 'block';
                document.getElementById('step3Number').style.display = 'none';
                document.getElementById('proceedDepositBtn').style.display = 'none';
                
                alert('✓ Step 3 Verified! Deposit confirmed. Account fully activated! Welcome to LEAD!');
                
                setTimeout(() => {
                    navigateTo('upgrade');
                }, 500);
                
            } catch (error) {
                console.error('Deposit confirmation error:', error);
                alert('Error confirming deposit: ' + error.message);
                const btn = document.querySelector('#accountDetailsModal .btn-primary');
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-check" style="margin-right: 8px;"></i> I\'ve Sent the Deposit';
            }
        };

        window.completeDeposit = async function() {
            showDepositMethodDialog();
        };

        window.completeUpgradeFlow = async function() {
            try {
                showAlert('Finalizing verification...', 'info');
                
                await updateDoc(doc(db, 'users', currentUser.uid), {
                    accountVerified: true,
                    verificationCompleted: serverTimestamp()
                });
                
                showAlert('Account verification complete! Bank owner will review shortly.', 'success');
                navigateTo('dashboard');
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        };

        // Hide address bar on scroll
        window.addEventListener('load', () => {
            window.scrollTo(0, 1);
        });

        // Customer Support & Live Chat Functions
        window.openLiveChat = function() {
            const modal = document.getElementById('chatModal');
            const messages = document.getElementById('chatMessages');
            const input = document.getElementById('chatInput');
            
            if (modal) {
                modal.style.display = 'flex';
                if (messages) {
                    messages.innerHTML = '<div style="padding: 15px; background: rgba(102, 126, 234, 0.1); border-radius: 8px; margin-bottom: 10px;"><strong>Support Agent:</strong> Hi! How can we help you today?</div>';
                }
                if (input) {
                    input.value = '';
                    input.focus();
                }
            }
        }

        window.closeLiveChat = function() {
            const modal = document.getElementById('chatModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        window.sendChatMessage = function() {
            const input = document.getElementById('chatInput');
            const messagesContainer = document.getElementById('chatMessages');
            
            if (!input || !messagesContainer) return;
            
            const message = input.value.trim();
            if (!message) return;

            // Add user message
            const userMsg = document.createElement('div');
            userMsg.style.cssText = 'padding: 12px; background: #667eea; color: white; border-radius: 8px; margin-bottom: 10px; text-align: right;';
            userMsg.textContent = message;
            messagesContainer.appendChild(userMsg);

            input.value = '';

            // Simulate agent response
            setTimeout(() => {
                const agentMsg = document.createElement('div');
                agentMsg.style.cssText = 'padding: 12px; background: rgba(102, 126, 234, 0.1); border-radius: 8px; margin-bottom: 10px;';
                
                const responses = [
                    'Thanks for reaching out! How can I assist you?',
                    'That\'s a great question! Let me help you with that.',
                    'I understand. Let me look into this for you.',
                    'Our team is here to help! What else do you need?',
                    'Thank you for contacting LEAD Bank. Is there anything else I can help with?'
                ];
                
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                agentMsg.innerHTML = `<strong>Support Agent:</strong> ${randomResponse}`;
                messagesContainer.appendChild(agentMsg);
                
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 800);

            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function toggleFAQ(element) {
            const answer = element.querySelector('.faq-answer');
            answer.style.display = answer.style.display === 'none' ? 'block' : 'none';
            element.style.backgroundColor = answer.style.display === 'none' ? 'var(--bg-card)' : 'rgba(102, 126, 234, 0.1)';
        }

        // Currency Converter Functions - Using Fallback Rates
        let exchangeRates = {
            'USD': 1,
            'EUR': 0.92,
            'GBP': 0.79,
            'JPY': 149.50,
            'AUD': 1.53,
            'CAD': 1.36,
            'CHF': 0.88,
            'CNY': 7.08,
            'SEK': 10.51,
            'NZD': 1.68,
            'ILS': 3.65,
            'INR': 83.45,
            'MXN': 17.05,
            'SGD': 1.34,
            'HKD': 7.78
        };

        async function loadExchangeRates() {
            try {
                // Try to fetch fresh rates, but don't fail if unavailable
                const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD', {
                    headers: { 'Accept': 'application/json' }
                });
                if (response.ok) {
                    const data = await response.json();
                    exchangeRates = data.rates;
                }
            } catch (error) {
                console.log('Using fallback exchange rates');
            }
            
            convertCurrency();
            loadPopularRates();
        }

        window.convertCurrency = function() {
            const amountInput = document.getElementById('converterAmount');
            const fromSelect = document.getElementById('converterFromCurrency');
            const toSelect = document.getElementById('converterToCurrency');
            const resultInput = document.getElementById('converterResult');
            const rateInfo = document.getElementById('converterRate');
            const rateText = document.getElementById('rateText');
            const lastUpdated = document.getElementById('lastUpdated');

            if (!amountInput || !fromSelect || !toSelect || !resultInput) return;

            const amount = parseFloat(amountInput.value) || 1;
            const fromCurrency = fromSelect.value;
            const toCurrency = toSelect.value;

            if (exchangeRates[toCurrency] && exchangeRates[fromCurrency]) {
                const rate = exchangeRates[toCurrency] / exchangeRates[fromCurrency];
                const result = (amount * rate).toFixed(2);
                resultInput.value = result;
                
                if (rateInfo) {
                    rateInfo.style.display = 'block';
                }
                if (rateText) {
                    rateText.textContent = `1 ${fromCurrency} = ${rate.toFixed(4)} ${toCurrency}`;
                }
                if (lastUpdated) {
                    lastUpdated.textContent = 'Real-time exchange rates';
                }
            }
        }

        function swapCurrencies() {
            const temp = document.getElementById('converterFromCurrency').value;
            document.getElementById('converterFromCurrency').value = document.getElementById('converterToCurrency').value;
            document.getElementById('converterToCurrency').value = temp;
            convertCurrency();
        }

        function loadPopularRates() {
            const popularCurrencies = ['EUR', 'GBP', 'JPY', 'AUD', 'CAD', 'CHF'];
            const container = document.getElementById('popularRates');
            container.innerHTML = '';

            popularCurrencies.forEach(currency => {
                if (exchangeRates[currency]) {
                    const rate = (exchangeRates[currency] / exchangeRates['USD']).toFixed(4);
                    const div = document.createElement('div');
                    div.style.cssText = 'padding: 12px; background: #ffffff; border-radius: 8px; cursor: pointer;';
                    div.innerHTML = `
                        <div style="font-weight: 600; color: #667eea;">1 USD</div>
                        <div style="font-size: 14px; color: var(--text-secondary); margin: 5px 0;">${rate} ${currency}</div>
                    `;
                    div.onclick = () => {
                        document.getElementById('converterToCurrency').value = currency;
                        convertCurrency();
                    };
                    container.appendChild(div);
                }
            });
        }

        // Receipt Download Function
        window.downloadReceipt = function() {
            const receiptContent = document.getElementById('receiptContent');
            if (!receiptContent || !receiptContent.innerHTML.trim()) {
                showAlert('No receipt to download', 'error');
                return;
            }

            try {
                // Create a styled HTML content for download
                const now = new Date();
                const dateStr = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                const timeStr = now.toLocaleTimeString('en-US');
                
                const htmlContent = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LEAD Bank Receipt</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Arial', sans-serif; 
            background-color: #f5f5f5;
            padding: 20px;
        }
        .receipt-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .receipt-header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 20px;
        }
        .receipt-header h1 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 10px;
        }
        .receipt-header p {
            color: #666;
            font-size: 18px;
        }
        .receipt-status {
            margin-top: 15px;
            color: #10b981;
            font-weight: bold;
            font-size: 16px;
        }
        .receipt-details {
            margin: 30px 0;
        }
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        .receipt-label {
            font-weight: 600;
            color: #333;
        }
        .receipt-value {
            color: #666;
            text-align: right;
        }
        .timestamp {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            text-align: right;
            color: #999;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="receipt-container">
        <div class="receipt-header">
            <h1>LEAD BANK</h1>
            <p>Transaction Receipt</p>
            <div class="receipt-status">✓ Transaction Successful</div>
        </div>
        <div class="receipt-details">
            ${receiptContent.innerHTML}
        </div>
        <div class="timestamp">
            <p>Generated on: ${dateStr} at ${timeStr}</p>
            <p>Receipt ID: ${Math.random().toString(36).substring(2, 15).toUpperCase()}</p>
        </div>
    </div>
</body>
</html>
                `;

                // Create blob and trigger download
                const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                
                const timestamp = new Date().toISOString().slice(0, 10);
                const time = new Date().toTimeString().slice(0, 5).replace(':', '-');
                link.download = `LEAD_Bank_Receipt_${timestamp}_${time}.html`;
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Clean up the object URL
                setTimeout(() => URL.revokeObjectURL(link.href), 100);
                
                showAlert('Receipt downloaded successfully!', 'success');
            } catch (error) {
                console.error('Error downloading receipt:', error);
                showAlert('Error downloading receipt: ' + error.message, 'error');
            }
        }

        // Initialize converter when page loads
        document.addEventListener('DOMContentLoaded', () => {
            loadExchangeRates();
        });

        // Also load on window load
        window.addEventListener('load', () => {
            if (Object.keys(exchangeRates).length > 1) {
                convertCurrency();
                loadPopularRates();
            }
        });

        // Reload exchange rates periodically (every hour)
        setInterval(() => {
            loadExchangeRates();
        }, 3600000);
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</body>
</html>