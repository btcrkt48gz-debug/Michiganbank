<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CredCrypt Bank</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

<style>
/* ---------------- General Styles ---------------- */
body{margin:0;font-family:Arial,sans-serif;background:#f4f6f9;color:#333;}
.hidden{display:none;}
section{padding:20px;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,0.1);background:#fff;max-width:400px;margin:50px auto;}
button{padding:12px 20px;border:none;border-radius:10px;background:linear-gradient(135deg,#6a5af9,#8c76ff);color:#fff;font-weight:600;margin:5px;cursor:pointer;transition:0.3s;}
button:hover{transform:translateY(-3px);box-shadow:0 5px 15px rgba(106,90,249,0.5);}
input,select{width:100%;padding:12px;margin:5px 0 15px 0;border-radius:10px;border:1px solid #ccc;}
h2{text-align:center;margin-bottom:20px;}

/* ---------------- Loading ---------------- */
#loading-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;flex-direction:column;justify-content:center;align-items:center;color:#fff;font-size:18px;z-index:999;}
.loader{border:8px solid #f3f3f3;border-top:8px solid #6a5af9;border-radius:50%;width:60px;height:60px;animation:spin 1s linear infinite;margin-bottom:15px;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}

/* ---------------- Dashboard ---------------- */
#dashboard-section{max-width:500px;margin:20px auto;padding:20px;}
#balances{display:flex;justify-content:space-between;margin-bottom:15px;flex-wrap:wrap;}
.balance-card{background:#fff;padding:15px;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,0.1);text-align:center;flex:1;margin:5px;}
#quick-buttons{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:15px;}

/* ---------------- Crypto Grid ---------------- */
.crypto-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:20px;}
.crypto-card{background:linear-gradient(135deg,#6a5af9,#8c76ff);color:#fff;padding:15px;border-radius:15px;text-align:center;cursor:pointer;box-shadow:0 8px 20px rgba(106,90,249,0.3);transition:0.3s;}
.crypto-card:hover{transform:translateY(-5px);box-shadow:0 12px 25px rgba(106,90,249,0.5);}

/* ---------------- Modal ---------------- */
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);display:flex;justify-content:center;align-items:center;z-index:999;}
.modal-content{background:#fff;padding:20px;border-radius:15px;width:90%;max-width:400px;position:relative;}
#receipt-details{background:#fff;padding:15px;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,0.1);margin-bottom:15px;}
.transaction-card{background:#fff;padding:15px;margin:10px 0;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,0.1);cursor:pointer;transition:0.3s;}
.transaction-card:hover{transform:translateY(-3px);box-shadow:0 10px 20px rgba(0,0,0,0.15);}

/* ---------------- PIN Keypad ---------------- */
#pin-keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:15px;}
.pin-button{background:linear-gradient(135deg,#6a5af9,#8c76ff);padding:15px;border-radius:10px;font-size:18px;font-weight:bold;color:#fff;}
#pin-dots{text-align:center;font-size:24px;letter-spacing:10px;margin-bottom:10px;}

/* ---------------- Bottom Navigation ---------------- */
#bottom-nav{display:flex;justify-content:space-around;align-items:center;position:fixed;bottom:0;width:100%;padding:10px;background:#fff;box-shadow:0 -2px 10px rgba(0,0,0,0.1);}
#bottom-nav button{background:none;box-shadow:none;color:#6a5af9;font-size:18px;}
#nav-crypto img{height:40px;width:40px;}
@media (max-width:480px){section{margin:20px;padding:15px;width:90%;}input,select,button{font-size:16px;padding:12px;}}
</style>
</head>
<body>

<!-- Loading Screen -->
<div id="loading-screen" class="hidden"><div class="loader"></div><p>Processing...</p></div>

<!-- Signup -->
<section id="signup-section" class="hidden">
<h2>Sign Up</h2>
<input type="email" id="signup-email" placeholder="Email">
<input type="password" id="signup-password" placeholder="Password">
<button id="signup-btn">Sign Up</button>
<p style="text-align:center;">Already have an account? <button id="go-login">Login</button></p>
</section>

<!-- Login -->
<section id="login-section" class="hidden">
<h2>Login</h2>
<input type="email" id="login-email" placeholder="Email">
<input type="password" id="login-password" placeholder="Password">
<button id="login-btn">Login</button>
<p style="text-align:center;">No account? <button id="go-signup">Sign Up</button></p>
</section>

<!-- User Info -->
<section id="user-info-section" class="hidden">
<h2>User Info</h2>
<input type="text" id="first-name" placeholder="First Name">
<input type="text" id="last-name" placeholder="Last Name">
<input type="text" id="phone" placeholder="Phone Number">
<input type="number" id="age" placeholder="Age">
<select id="country"><option value="">Select Country</option><option value="USA">USA</option><option value="Nigeria">Nigeria</option><option value="UK">UK</option></select>
<select id="state"><option value="">Select State</option></select>
<input type="text" id="address-line" placeholder="Street & Address Number">
<button id="submit-user-info">Submit</button>
</section>

<!-- Dashboard -->
<section id="dashboard-section" class="hidden">
<h2 id="greeting"></h2>
<div id="balances">
<div class="balance-card"><h3>Main Balance</h3><p>$<span id="main-balance-value">0.00</span></p></div>
<div class="balance-card"><h3>Checking</h3><p>$<span id="checking-balance">0.00</span></p></div>
<div class="balance-card"><h3>Savings</h3><p>$<span id="savings-balance">0.00</span></p></div>
</div>
<div id="quick-buttons">
<button data-action="bank-transfer">Bank Transfer</button>
<button data-action="wire-transfer">Wire Transfer</button>
<button data-action="pay-bills">Pay Bills</button>
<button data-action="top-up">Top Up</button>
<button data-action="crypto">Crypto</button>
<button data-action="credit-score">Credit Score</button>
<button data-action="loan">Loan</button>
<button data-action="cards">Cards</button>
<button data-action="more">More</button>
</div>
<button id="view-transactions">Transaction History</button>

<!-- Crypto Section -->
<div id="crypto-section" class="hidden">
<h2>Crypto</h2>
<div class="crypto-grid" id="crypto-grid"></div>
<div id="crypto-detail-modal" class="modal hidden">
  <div class="modal-content">
    <h3 id="crypto-name"></h3>
    <canvas id="crypto-chart" height="150"></canvas>
    <input type="number" id="crypto-amount" placeholder="Amount to buy/sell">
    <select id="crypto-action">
      <option value="buy">Buy</option>
      <option value="sell">Sell</option>
      <option value="send">Send</option>
      <option value="receive">Receive</option>
    </select>
    <p>Converted: $<span id="crypto-converted">0.00</span></p>
    <button id="crypto-confirm-btn">Confirm</button>
    <button id="crypto-close-btn">Close</button>
  </div>
</div>
</div>
</section>

<!-- PIN Modal -->
<div id="pin-modal" class="modal hidden">
  <div class="modal-content">
    <h3>Enter Transaction PIN</h3>
    <div id="pin-dots">••••</div>
    <div id="pin-keypad">
      <button class="pin-button">1</button>
      <button class="pin-button">2</button>
      <button class="pin-button">3</button>
      <button class="pin-button">4</button>
      <button class="pin-button">5</button>
      <button class="pin-button">6</button>
      <button class="pin-button">7</button>
      <button class="pin-button">8</button>
      <button class="pin-button">9</button>
      <button class="pin-button">0</button>
      <button class="pin-button" id="pin-clear">Clear</button>
    </div>
    <button id="pin-submit">Submit</button>
  </div>
</div>

<!-- Receipt Modal -->
<div id="receipt-modal" class="modal hidden">
  <div class="modal-content">
    <h3>Transaction Receipt</h3>
    <div id="receipt-details"></div>
    <button id="receipt-close-btn">Back to Dashboard</button>
  </div>
</div>

<!-- Bottom Navigation -->
<div id="bottom-nav">
<button id="nav-dashboard"><i class="fa fa-home"></i><br>Dashboard</button>
<button id="nav-crypto"><img src="crypto-icon.svg" alt="Crypto"></button>
<button id="nav-profile"><i class="fa fa-user"></i><br>Profile</button>
</div>

<script>
// ---------------- Firebase ----------------
const firebaseConfig = {
apiKey: "AIzaSyAjy5sgZPMFsklKkSOMyC1HCvQ4-qNKP-M",
authDomain: "fir-bank-c659f.firebaseapp.com",
projectId: "fir-bank-c659f",
storageBucket: "fir-bank-c659f.firebasestorage.app",
messagingSenderId: "847611883266",
appId: "1:847611883266:web:651ecee5dfea8e0f1cdc1b",
measurementId: "G-QK7R83FC51"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ---------------- Helpers ----------------
function showSection(section){document.querySelectorAll('section').forEach(s=>s.classList.add('hidden'));section.classList.remove('hidden');}
const loadingScreen = document.getElementById('loading-screen');
function showLoading(show){loadingScreen.style.display = show?'flex':'none';}

// Sections
const signupSection=document.getElementById('signup-section');
const loginSection=document.getElementById('login-section');
const userInfoSection=document.getElementById('user-info-section');
const dashboardSection=document.getElementById('dashboard-section');
showSection(loginSection);

// Navigation
document.getElementById('go-login').onclick=()=>showSection(loginSection);
document.getElementById('go-signup').onclick=()=>showSection(signupSection);

// Signup/Login
document.getElementById('signup-btn').onclick=async()=>{
  const email=document.getElementById('signup-email').value;
  const pass=document.getElementById('signup-password').value;
  if(!email||!pass){alert('Fill all fields');return;}
  showLoading(true);
  try{await auth.createUserWithEmailAndPassword(email,pass); showSection(userInfoSection);}catch(e){alert(e.message);}
  showLoading(false);
};
document.getElementById('login-btn').onclick=async()=>{
  const email=document.getElementById('login-email').value;
  const pass=document.getElementById('login-password').value;
  if(!email||!pass){alert('Fill all fields');return;}
  showLoading(true);
  try{await auth.signInWithEmailAndPassword(email,pass); showSection(dashboardSection); updateBalances();}catch(e){alert(e.message);}
  showLoading(false);
};

// Auth State
auth.onAuthStateChanged(user=>{
  if(user){showSection(dashboardSection);updateBalances();}
  else{showSection(loginSection);}
  showLoading(false);
});

// User Info
document.getElementById('country').addEventListener('change',()=>{
  const states={'USA':['California','New York','Texas'],'Nigeria':['Lagos','Abuja','Kano'],'UK':['England','Scotland','Wales']};
  const sel=document.getElementById('state'); sel.innerHTML='<option value="">Select State</option>';
  (states[document.getElementById('country').value]||[]).forEach(s=>{const o=document.createElement('option');o.value=s;o.textContent=s;sel.appendChild(o);});
});
document.getElementById('submit-user-info').onclick=async()=>{
  const uid=auth.currentUser.uid;
  const f=document.getElementById('first-name').value; const l=document.getElementById('last-name').value;
  const p=document.getElementById('phone').value; const a=document.getElementById('age').value;
  const c=document.getElementById('country').value; const s=document.getElementById('state').value;
  const ad=document.getElementById('address-line').value;
  if(!f||!l||!p||!a||!c||!s||!ad){alert('Fill all fields'); return;}
  showLoading(true);
  await db.collection('users').doc(uid).set({firstName:f,lastName:l,phone:p,age:a,country:c,state:s,address:ad,checking:0,savings:0,crypto:{},pin:"1234"});
  showLoading(false); showSection(dashboardSection); updateBalances();
};

// Dashboard Balances
const greeting=document.getElementById('greeting');
const mainBalanceValue=document.getElementById('main-balance-value');
const checkingBalanceElem=document.getElementById('checking-balance');
const savingsBalanceElem=document.getElementById('savings-balance');
async function updateBalances(){
  const uid=auth.currentUser.uid;
  const doc=await db.collection('users').doc(uid).get();
  const data=doc.data();
  checkingBalanceElem.textContent=(data.checking||0).toFixed(2);
  savingsBalanceElem.textContent=(data.savings||0).toFixed(2);
  const cryptoTotal = Object.values(data.crypto||{}).reduce((a,b)=>a+b,0);
  mainBalanceValue.textContent=((data.checking||0)+(data.savings||0)+cryptoTotal).toFixed(2);
  greeting.textContent=`Good Morning, ${data.firstName||''}`;
}

// ---------------- Quick Buttons ----------------
document.querySelectorAll('#quick-buttons button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    const action = btn.getAttribute('data-action');
    const transaction = {
      action: action,
      amount: Math.floor(Math.random()*1000)+1,
      fee: 2,
      type: action==='crypto' || action==='top-up' ? 'internal' : 'external'
    };
    openPinModal(transaction);
  });
});

// ---------------- Bottom Nav ----------------
document.getElementById('nav-dashboard').onclick=()=>showSection(dashboardSection);
document.getElementById('nav-crypto').onclick=()=>{showSection(dashboardSection); document.getElementById('crypto-section').classList.remove('hidden');};
document.getElementById('nav-profile').onclick=()=>alert('Profile page placeholder');

// ---------------- Crypto Live ----------------
const cryptoGrid = document.getElementById('crypto-grid');
const cryptoModal = document.getElementById('crypto-detail-modal');
const cryptoNameElem = document.getElementById('crypto-name');
const cryptoChartElem = document.getElementById('crypto-chart').getContext('2d');
const cryptoAmountInput = document.getElementById('crypto-amount');
const cryptoActionSelect = document.getElementById('crypto-action');
const cryptoConverted = document.getElementById('crypto-converted');
const cryptoConfirmBtn = document.getElementById('crypto-confirm-btn');
const cryptoCloseBtn = document.getElementById('crypto-close-btn');
let cryptoData = {};
let selectedCrypto = '';
let chartInstance;
const coins = ['bitcoin','ethereum','litecoin','ripple'];
async function fetchCryptoPrices(){
  const res = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coins.join(',')}&vs_currencies=usd`);
  cryptoData = await res.json();
  cryptoGrid.innerHTML='';
  coins.forEach(c=>{
    const card = document.createElement('div');
    card.className='crypto-card';
    card.innerHTML=`<h4>${c.toUpperCase()}</h4><p>$${cryptoData[c].usd}</p>`;
    card.onclick=()=>openCryptoDetail(c);
    cryptoGrid.appendChild(card);
  });
}
async function openCryptoDetail(c){
  selectedCrypto=c;
  cryptoNameElem.textContent=c.toUpperCase();
  cryptoAmountInput.value='';
  cryptoConverted.textContent='0.00';
  cryptoModal.classList.remove('hidden');
  const chartRes = await fetch(`https://api.coingecko.com/api/v3/coins/${c}/market_chart?vs_currency=usd&days=30`);
  const chartData = await chartRes.json();
  const labels = chartData.prices.map(p=>new Date(p[0]).toLocaleDateString());
  const data = chartData.prices.map(p=>p[1]);
  if(chartInstance) chartInstance.destroy();
  chartInstance = new Chart(cryptoChartElem,{type:'line',data:{labels, datasets:[{label:c.toUpperCase(),data, borderColor:'#6a5af9',fill:false}]}});
}
cryptoAmountInput.addEventListener('input',()=>{
  const val=parseFloat(cryptoAmountInput.value)||0;
  cryptoConverted.textContent=(val*cryptoData[selectedCrypto].usd).toFixed(2);
});
cryptoCloseBtn.onclick=()=>cryptoModal.classList.add('hidden');
cryptoConfirmBtn.onclick=()=>{const transaction={action:'crypto',crypto:selectedCrypto,amount:parseFloat(cryptoAmountInput.value),type:'internal'}; openPinModal(transaction); cryptoModal.classList.add('hidden');};
fetchCryptoPrices();

// ---------------- PIN Modal ----------------
let currentTransaction = null;
let enteredPin = '';
const pinModal = document.getElementById('pin-modal');
const pinDots = document.getElementById('pin-dots');
document.querySelectorAll('.pin-button').forEach(btn=>{
  btn.addEventListener('click',()=>{
    if(btn.id==='pin-clear'){enteredPin='';updatePinDots();return;}
    if(enteredPin.length<4){enteredPin+=btn.textContent;updatePinDots();}
  });
});
function updatePinDots(){pinDots.textContent=enteredPin.split('').map(()=> '•').concat('••••'.slice(enteredPin.length)).join('');}
function openPinModal(txn){currentTransaction=txn;enteredPin='';updatePinDots();pinModal.classList.remove('hidden');}
document.getElementById('pin-submit').onclick=async()=>{
  const uid = auth.currentUser.uid;
  const userDoc = await db.collection('users').doc(uid).get();
  const correctPin = userDoc.data().pin || "1234";
  if(enteredPin!==correctPin){alert('Incorrect PIN');enteredPin='';updatePinDots();return;}
  pinModal.classList.add('hidden');
  showLoading(true);
  setTimeout(async()=>{
    showLoading(false);
    const status = currentTransaction.type==='internal'?'Success':'Pending';
    const txnRef = await db.collection('users').doc(uid).collection('transactions').add({...currentTransaction,status,timestamp:new Date()});
    if(status==='Success'){
      const userData = userDoc.data();
      if(currentTransaction.action==='crypto'){
        userData.crypto = userData.crypto || {};
        userData.crypto[currentTransaction.crypto] = (userData.crypto[currentTransaction.crypto]||0) + parseFloat(currentTransaction.amount);
      } else if(currentTransaction.action==='top-up'){
        userData.checking = (userData.checking||0) + parseFloat(currentTransaction.amount);
      }
      await db.collection('users').doc(uid).update(userData);
      updateBalances();
    }
    showReceipt({...currentTransaction,status,timestamp:new Date()});
  },2000);
};

// ---------------- Receipt ----------------
const receiptModal=document.getElementById('receipt-modal');
const receiptDetailsElem=document.getElementById('receipt-details');
const receiptCloseBtn=document.getElementById('receipt-close-btn');
function showReceipt(txn){
  let html=`<p><strong>Transaction Type:</strong> ${txn.action}</p>
  <p><strong>Amount:</strong> $${txn.amount}</p>
  ${txn.fee?`<p><strong>Fee:</strong> $${txn.fee}</p>`:''}
  ${txn.crypto?`<p><strong>Crypto:</strong> ${txn.crypto.toUpperCase()}</p>`:''}
  <p><strong>Status:</strong> ${txn.status}</p>
  <p><strong>Date:</strong> ${new Date(txn.timestamp.seconds*1000 || txn.timestamp).toLocaleString()}</p>`;
  receiptDetailsElem.innerHTML=html;
  receiptModal.classList.remove('hidden');
}
receiptCloseBtn.onclick=()=>{receiptModal.classList.add('hidden');updateBalances();};

// ---------------- Notifications ----------------
auth.onAuthStateChanged(user=>{
  if(!user) return;
  const uid=user.uid;
  db.collection('users').doc(uid).collection('transactions').onSnapshot(snapshot=>{
    snapshot.docChanges().forEach(change=>{
      if(change.type==='added'){
        const data=change.doc.data();
        if(data.status==='Pending') alert(`New transaction pending: ${data.action} $${data.amount}`);
        else if(data.status==='Success') alert(`Transaction successful: ${data.action} $${data.amount}`);
      }
    });
  });
});
</script>

</body>
</html>